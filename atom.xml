<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><author><name>Kijima Daigo</name></author>
<title>Insomnia</title>
<generator>Emacs webfeeder.el</generator>
<link href="https://kijimad.github.io/roam"/>
<link href="https://kijimad.github.io/roam/atom.xml" rel="self"/>
<id>https://kijimad.github.io/roam/atom.xml</id>
<updated>2025-12-17T23:09:51+09:00</updated>
<entry>
  <title>KDOC 499: 0番ポートは動的割当に利用される</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgabf7c94" class="outline-2">
 <h2 id="orgabf7c94"> <a href="#orgabf7c94">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgabf7c94">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org126db61" class="outline-2">
 <h2 id="org126db61"> <a href="#org126db61">概要</a></h2>
 <div class="outline-text-2" id="text-org126db61">
 <p>
0番ポートは動的割当に利用される。
</p>

 <blockquote>
 <p>
0番のポートはエニーポート（any port）と呼ばれ、アプリケーションに対して、動的に別番号の空きポートを割り当てるために用意された特殊なポート番号である。
 <a href="https://ja.wikipedia.org/wiki/TCP%E3%82%84UDP%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%83%9D%E3%83%BC%E3%83%88%E7%95%AA%E5%8F%B7%E3%81%AE%E4%B8%80%E8%A6%A7">TCPやUDPにおけるポート番号の一覧 - Wikipedia</a>
</p>
</blockquote>
</div>
</div>
 <div id="outline-container-org91b91b1" class="outline-2">
 <h2 id="org91b91b1"> <a href="#org91b91b1">関連</a></h2>
 <div class="outline-text-2" id="text-org91b91b1">
 <p>
なし。
</p>

 <ul class="org-ul"> <li>追加調査: OS側のドキュメントを確認する</li>
 <li>類推:  <a href="20251029T205958--kdoc-480-route53の由来はポート番号である__essay.html#ID-20251029T205958">KDOC 480: Route53の由来はポート番号である</a>。同じくポート番号に関する話題</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251207T203931--kdoc-499-0番ポートは動的割当に利用される__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251207T203931--kdoc-499-0番ポートは動的割当に利用される__permanent.html</id>
  <updated>2025-12-18T08:09:48+09:00</updated>
</entry>
<entry>
  <title>KDOC 502: jsonとjsonbの性能を比較する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgc98ec6d" class="outline-2">
 <h2 id="orgc98ec6d"> <a href="#orgc98ec6d">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgc98ec6d">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org49c1248" class="outline-2">
 <h2 id="org49c1248"> <a href="#org49c1248">概要</a></h2>
 <div class="outline-text-2" id="text-org49c1248">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？ — Just use Postgres 読書感想文</a>でjsonとjsonbについて説明していた。じっさいに使ってみて読み書き性能を試してみる。
</p>

 <p>
ドキュメントのJSONデータ型の説明を見る。
</p>

 <blockquote>
 <p>
jsonデータ型は入力テキストの正確なコピーで格納し、処理関数を実行するたびに再解析する必要があります。jsonbデータ型では、分解されたバイナリ形式で格納されます。
格納するときには変換のオーバーヘッドのため少し遅くなりますが、処理するときには、全く再解析が必要とされないので大幅に高速化されます。 また jsonb型の重要な利点はインデックスをサポートしていることです。
 <a href="https://www.postgresql.jp/docs/9.6/datatype-json.html">8.14. JSONデータ型</a>
</p>
</blockquote>

 <p>
試す。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users1</span> (
    test JSON
);
 <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users2</span> (
    test JSONB
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">検証データ挿入 ================
</span>EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users1 (test)
 <span class="org-keyword">SELECT</span> jsonb_build_object(
     <span class="org-string">'a'</span>, md5(random()::text)::text,
     <span class="org-string">'b'</span>, md5(random()::text)::text
)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users2 (test)
 <span class="org-keyword">SELECT</span> jsonb_build_object(
     <span class="org-string">'a'</span>, md5(random()::text)::text,
     <span class="org-string">'b'</span>, md5(random()::text)::text
)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">確認
</span> <span class="org-keyword">select</span> test  <span class="org-keyword">from</span> users1  <span class="org-keyword">limit</span> 3;
 <span class="org-keyword">select</span> test  <span class="org-keyword">from</span> users2  <span class="org-keyword">limit</span> 3;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">JSON/JSONBフィールドの特定キーを取得 ================
</span>EXPLAIN ANALYZE
 <span class="org-keyword">SELECT</span> test->> <span class="org-string">'a'</span>  <span class="org-keyword">FROM</span> users1;

EXPLAIN ANALYZE
 <span class="org-keyword">SELECT</span> test->> <span class="org-string">'a'</span>  <span class="org-keyword">FROM</span> users2;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------------------------|
| > CREATE TABLE users1 (                                                                                                               |
| >     test JSON                                                                                                                       |
| > );                                                                                                                                  |
| CREATE TABLE                                                                                                                          |
|                                                                                                                                       |
| > CREATE TABLE users2 (                                                                                                               |
| >     test JSONB                                                                                                                      |
| > );                                                                                                                                  |
| CREATE TABLE                                                                                                                          |
|                                                                                                                                       |
| > EXPLAIN ANALYZE                                                                                                                     |
| > INSERT INTO users1 (test)                                                                                                           |
| > SELECT jsonb_build_object(                                                                                                          |
| >     'a', md5(random()::text)::text,                                                                                                 |
| >     'b', md5(random()::text)::text                                                                                                  |
| > )                                                                                                                                   |
| > FROM generate_series(1, 100000) i;                                                                                                  |
| QUERY PLAN                                                                                                                            |
| Insert on users1  (cost=0.00..3750.00 rows=0 width=0) (actual time=184.280..184.281 rows=0.00 loops=1)                                |
| Buffers: shared hit=102854 dirtied=1430 written=1432                                                                                  |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3750.00 rows=100000 width=32) (actual time=2.514..149.198 rows=100000.00 loops=1)          |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.508..127.342 rows=100000.00 loops=1) |
| Planning:                                                                                                                             |
| Buffers: shared hit=12                                                                                                                |
| Planning Time: 0.036 ms                                                                                                               |
| Execution Time: 184.505 ms                                                                                                            |
|                                                                                                                                       |
| > EXPLAIN ANALYZE                                                                                                                     |
| > INSERT INTO users2 (test)                                                                                                           |
| > SELECT jsonb_build_object(                                                                                                          |
| >     'a', md5(random()::text)::text,                                                                                                 |
| >     'b', md5(random()::text)::text                                                                                                  |
| > )                                                                                                                                   |
| > FROM generate_series(1, 100000) i;                                                                                                  |
| QUERY PLAN                                                                                                                            |
| Insert on users2  (cost=0.00..3250.00 rows=0 width=0) (actual time=158.466..158.467 rows=0.00 loops=1)                                |
| Buffers: shared hit=102854 dirtied=1430 written=1432                                                                                  |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.466..123.663 rows=100000.00 loops=1) |
| Planning Time: 0.025 ms                                                                                                               |
| Execution Time: 158.657 ms                                                                                                            |
|                                                                                                                                       |
| > select test from users1 limit 3;                                                                                                    |
| test                                                                                                                                  |
| {"a": "dba001dbc53fb1affecb161244d49de5", "b": "1269bcf288fab7ff8bc8810322cf72df"}                                                    |
| {"a": "f680462287f0e413535a1d1a9e08bd9c", "b": "78082ff4cf9ac36a66da115caa675057"}                                                    |
| {"a": "ddda418ccf6b8bf7e601e3eeacd57d92", "b": "e1ab4cecb9a56acad02351bcd09ab0a9"}                                                    |
|                                                                                                                                       |
| > select test from users2 limit 3;                                                                                                    |
| test                                                                                                                                  |
| {"a": "3beeada8c14e8d4b1b137899bb26ab9e", "b": "68d8babc9da1ecc0d561d54d92f2d83e"}                                                    |
| {"a": "ac5895ccaba4305066c3539ffc199525", "b": "e0ffd0cc569d1de65334dddeb0f9afe4"}                                                    |
| {"a": "4d5ca26a018345a916c55d7aca560a84", "b": "2f068f30473bcee7650760a5c5431cb8"}                                                    |
|                                                                                                                                       |
| > EXPLAIN ANALYZE                                                                                                                     |
| > SELECT test->>'a' FROM users1;                                                                                                      |
| QUERY PLAN                                                                                                                            |
| Seq Scan on users1  (cost=0.00..3858.30 rows=194344 width=32) (actual time=0.005..16.547 rows=100000.00 loops=1)                      |
| Buffers: shared hit=1429                                                                                                              |
| Planning Time: 0.004 ms                                                                                                               |
| Execution Time: 18.648 ms                                                                                                             |
|                                                                                                                                       |
| > EXPLAIN ANALYZE                                                                                                                     |
| > SELECT test->>'a' FROM users2;                                                                                                      |
| QUERY PLAN                                                                                                                            |
| Seq Scan on users2  (cost=0.00..3858.30 rows=194344 width=32) (actual time=0.004..7.037 rows=100000.00 loops=1)                       |
| Buffers: shared hit=1429                                                                                                              |
| Planning Time: 0.008 ms                                                                                                               |
| Execution Time: 9.035 ms                                                                                                              |
</pre>
</div>

 <p>
書き込み。JSONBのほうが保存時パースする分遅い想定だったのだが、なぜかJSONBのほうが少し早い。構造の複雑さによるのだろうか。
</p>

 <ul class="org-ul"> <li>JSONフィールドの書き込み(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.036 ms</li>
 <li>Execution Time: 184.505 ms</li>
</ul></li>
 <li>JSONBフィールドの書き込み(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.025 ms</li>
 <li>Execution Time: 158.657 ms</li>
</ul></li>
</ul> <p>
読み出し。JSONBのほうが読み出し時にパースがないぶん早い。
</p>

 <ul class="org-ul"> <li>JSONフィールドの読み出し(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.004 ms</li>
 <li>Execution Time: 18.648 ms</li>
</ul></li>
 <li>JSONBフィールドの読み出し(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.008 ms</li>
 <li>Execution Time: 9.035 ms</li>
</ul></li>
</ul> <blockquote>
 <p>
格納するときには変換のオーバーヘッドのため少し遅くなりますが、処理するときには、全く再解析が必要とされないので大幅に高速化されます。
 <a href="https://www.postgresql.jp/docs/9.6/datatype-json.html">8.14. JSONデータ型</a>
</p>
</blockquote>
</div>
</div>
 <div id="outline-container-org64c3f12" class="outline-2">
 <h2 id="org64c3f12"> <a href="#org64c3f12">関連</a></h2>
 <div class="outline-text-2" id="text-org64c3f12">
 <ul class="org-ul"> <li>追加調査: JSONBの書き込みのほうがなぜか早かった。複雑なJSON構造の場合はどうなるか確かめる</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251211T084518--kdoc-502-jsonとjsonbの性能を比較する__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251211T084518--kdoc-502-jsonとjsonbの性能を比較する__draft_permanent.html</id>
  <updated>2025-12-18T08:09:46+09:00</updated>
</entry>
<entry>
  <title>KDOC 507: DNSのルートサーバが13個なのはDNSのUDPのパケット上限が512バイトであるから</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org7b4093d" class="outline-2">
 <h2 id="org7b4093d"> <a href="#org7b4093d">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org7b4093d">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org66ecc90" class="outline-2">
 <h2 id="org66ecc90"> <a href="#org66ecc90">概要</a></h2>
 <div class="outline-text-2" id="text-org66ecc90">
 <p>
DNSのルートサーバは13個しかない。これはDNSにおけるUDPのパケット長の上限が512バイトであることからくる制約である(p57)。
</p>
</div>
</div>
 <div id="outline-container-orgf9b7326" class="outline-2">
 <h2 id="orgf9b7326"> <a href="#orgf9b7326">関連</a></h2>
 <div class="outline-text-2" id="text-orgf9b7326">
 <ul class="org-ul"> <li>参照:  <a href="20241102T084716--kdoc-258-『ピアリング戦記』__book.html#ID-20241102T084716">KDOC 258: 『ピアリング戦記』</a>から</li>
 <li>追加調査: なぜ13個になるのか詳細を調べる</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251217T184407--kdoc-507-dnsのルートサーバが13個なのはdnsのudpのパケット上限が512バイトであるから__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251217T184407--kdoc-507-dnsのルートサーバが13個なのはdnsのudpのパケット上限が512バイトであるから__draft_permanent.html</id>
  <updated>2025-12-18T08:09:44+09:00</updated>
</entry>
<entry>
  <title>KDOC 491: 『マイクロサービスアーキテクチャ』</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgd64cdd4" class="outline-2">
 <h2 id="orgd64cdd4"> <a href="#orgd64cdd4">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgd64cdd4">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org7798ad8" class="outline-2">
 <h2 id="org7798ad8"> <a href="#org7798ad8">概要</a></h2>
 <div class="outline-text-2" id="text-org7798ad8">
</div>
</div>
 <div id="outline-container-org638e3a9" class="outline-2">
 <h2 id="org638e3a9"> <a href="#org638e3a9">メモ</a></h2>
 <div class="outline-text-2" id="text-org638e3a9">
 <ul class="org-ul"> <li>マイクロサービスはサービス指向アーキテクチャ(SOA)の一種である。サービス境界の引き方については意見が分かれるが、独立してデプロイできるのが重要である(p3)</li>
 <li>独立デプロイ可能性を実現したい場合、データベースの共有は最悪なことの1つである(p9)</li>
 <li>システムのすべての機能をまとめてデプロイしなければならない場合、モノリス、だという(p15)</li>
 <li>モジュラモノリス: 各モジュールで独立して作業できるが、デプロイするにはすべてを結合する必要がある。多くの組織で優れた選択肢で、マイクロサービスアーキテクチャの課題を回避しながら高度な並列作業ができる(p17)
 <ul class="org-ul"> <li>課題の1つとして、コードレベルで行われるような分解が、データベースにおいては行われない傾向がある(p17)</li>
 <li>モジュラごとに分解したデータベースを使うモジュラモノリスもある</li>
</ul></li>
 <li>人々はモノリスを避けるべきもの、本質的に問題があるもの、と考えるようになっている。モノリシックアーキテクチャは1つの選択肢であり有効である(p19)</li>
 <li>100万行のモノリシックアプリケーションのうち1行を変更したら、その変更をリリースするためにアプリケーション全体をデプロイする必要があるようなデプロイは、影響が大きく危険性の高いものになる可能性がある(p26)</li>
 <li>分散システムでは複数プロセスが異なるデータベースで状態を管理する。データ一貫性の観点で課題が発生する可能性がある(p33)</li>
 <li>安定したサービス境界を定義することの重要性を考えると、マイクロサービスアーキテクチャは新製品やスタートアップにとって向いてないことが多い。開発するにつれて、作業するドメインが大きく変更されるのが一般的である。ドメインモデルがじゅうぶん安定するまで待ってからサービス境界を定義するほうが適切である(p33)</li>
 <li>凝集を説明する簡潔な定義: 一緒に変更され、一緒に存在するコード(p40)</li>
 <li>状態が正しく変更されるようにする1つの方法は有限状態機械を作成することだが、複数のマイクロサービスが状態機械を管理する責任を共有していると問題になる。単一のマイクロサービスが状態を管理するとよい(p51)</li>
 <li>データベースのCRUD操作の軽量ラッパーのようなマイクロサービスは低凝集、密結合の兆候である。そのサービスにあるべきデータを管理するロジックがシステムの別の場所に分散している(p51)</li>
 <li>マイクロサービス境界を探すためのメカニズムはドメイン自体を中心としたものであり、ドメイン駆動設計を利用してドメインモデルを作成する(p55)
 <ul class="org-ul"> <li>(感想)ドメイン駆動設計がマイクロサービスのためのものなのを知った</li>
 <li>ユビキタス言語: ユーザが使っているのと同じ用語をコード内でも使うように努めるべきであるという考え方。実世界のドメインのモデル化がより簡単になり、コミュニケーションも改善する、という考え方(55)</li>
</ul></li>
 <li>アグリゲートの意味がわからない(p62)
 <ul class="org-ul"> <li>アグリゲートはより幅広いシステムとの明確に定義されたインターフェースを備えた、凝集ユニットとなる。アグリゲートはシステム内の単一のドメイン概念に焦点を当てた自己完結型の状態機械である</li>
</ul></li>
 <li>システムに実装する変更は多くの場合、ビジネス側がシステムの振る舞いに関して行いたい変更に関するものである(p65)</li>
</ul></div>
</div>
 <div id="outline-container-orgfa9acc8" class="outline-2">
 <h2 id="orgfa9acc8"> <a href="#orgfa9acc8">関連</a></h2>
 <div class="outline-text-2" id="text-orgfa9acc8">
 <p>
なし。
</p>
</div>
</div>
 <div id="outline-container-org0accd92" class="outline-2">
 <h2 id="org0accd92"> <a href="#org0accd92">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org0accd92">
 <ul class="org-ul"> <li> <a href="./20240704T211631--kdoc-196-気乗りしない仕事に意味を見出す__essay.html">KDOC 196: 気乗りしない仕事に意味を見出す</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251129T082342--kdoc-491-『マイクロサービスアーキテクチャ』__draft_book.html"/>
  <id>https://kijimad.github.io/roam/20251129T082342--kdoc-491-『マイクロサービスアーキテクチャ』__draft_book.html</id>
  <updated>2025-12-18T08:09:44+09:00</updated>
</entry>
<entry>
  <title>KDOC 494: 日時に関する統計ではタイムゾーンが必要になる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org8a522bd" class="outline-2">
 <h2 id="org8a522bd"> <a href="#org8a522bd">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org8a522bd">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org7894363" class="outline-2">
 <h2 id="org7894363"> <a href="#org7894363">概要</a></h2>
 <div class="outline-text-2" id="text-org7894363">
 <p>
直感的でなかったことのメモ。
</p>

 <p>
たとえば、バックエンドで時間をUTCで保存するシステムがある。DBに保存されている値と、REST APIが返す時間はすべてUTCである。クライアントは各自のタイムゾーンで解釈して表示するような決まりになっている。
</p>

 <p>
点の時刻を返すだけだと単にUTCで返せばいいのだが、日/週/月ごと、などの期間ごとの統計をDBで行うときには期間の境界があるので、クエリにタイムゾーンを考慮した時刻が必要になる。日がいつ始まり終わるどうかは、タイムゾーンで異なる。
</p>
</div>
</div>
 <div id="outline-container-org5451dfa" class="outline-2">
 <h2 id="org5451dfa"> <a href="#org5451dfa">関連</a></h2>
 <div class="outline-text-2" id="text-org5451dfa">
 <ul class="org-ul"> <li>類推: ほかにUTC保存で気をつけるところはあるか</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251201T172433--kdoc-494-日時に関する統計ではタイムゾーンが必要になる__essay.html"/>
  <id>https://kijimad.github.io/roam/20251201T172433--kdoc-494-日時に関する統計ではタイムゾーンが必要になる__essay.html</id>
  <updated>2025-12-18T08:09:40+09:00</updated>
</entry>
<entry>
  <title>KDOC 505: 既存メモ側からどういった関連ができそうか考える</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org8a3bfba" class="outline-2">
 <h2 id="org8a3bfba"> <a href="#org8a3bfba">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org8a3bfba">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org87080e2" class="outline-2">
 <h2 id="org87080e2"> <a href="#org87080e2">概要</a></h2>
 <div class="outline-text-2" id="text-org87080e2">
 <p>
ツェッテルカステンライクな方法でメモしている。
</p>

 <p>
メモの関連が少なく、理解や思考を深められていないのを課題に感じてきた。単純に同じカテゴリの話題だから、という理由で関連させていることが多かったが、意味ないよな、と感じてきた。
</p>

 <p>
既存メモ側にどういった関連ができそうかの想定を書いておくと関連させやすいことに気づいた。また、それだけだと忘れやすいので先に想定する関連に対して類型をつけて抽象化しておくと、組み合わせて考えやすいのに気づいた。
</p>

 <pre class="example" id="orgeb13865">
KDOC 37: トップダウンかボトムアップ、どちらで成し遂げるか?
- 具体例: トップダウンの主張も出す

KDOC 71: KDOCエントリの書き方を考える
- 補足: 結局テンプレートファイルに含めた項目以外は忘れ去っていた。仕組みにしなければならない

KDOC 3: 『ない仕事の作り方』
- 組み合わせ: 彼のスクラップ癖と知識獲得モデルは、メモのとりかたで説明できるのではないか
</pre>

 <p>
そしてあとは、これらを見返して、この関連となるメモを追加していくわけである。
</p>

 <p>
いままでは膨大な既存メモと、ランダムに書いた新規メモがあって、その関連を考えていた。結果、深まらないメモができていた。事前に関連を考えておく方式だと、既存メモから考えた関連をもとにメモを作る。最初から関連ありきでメモを作成するので、深まっていくだろう。
</p>
</div>
</div>
 <div id="outline-container-orgde62fba" class="outline-2">
 <h2 id="orgde62fba"> <a href="#orgde62fba">関連</a></h2>
 <div class="outline-text-2" id="text-orgde62fba">
 <ul class="org-ul"> <li>動機:  <a href="20240502T172812--kdoc-153-すでにあるメモから、関連させられないか考える__essay.html#ID-20240502T172812">KDOC 153: すでにあるメモから、関連させられないか考える</a>。「時間を作る」だけでは改善しなかったので、対策を具体化した</li>
 <li>補足:  <a href="20231008T203658--kdoc-36-『take-notes』__book.html#ID-20231008T203658">KDOC 36: 『TAKE NOTES!』</a>。ツェッテルカステンで参考にしている本</li>
</ul></div>
</div>
 <div id="outline-container-orgb499cfb" class="outline-2">
 <h2 id="orgb499cfb"> <a href="#orgb499cfb">Backlinks</a></h2>
 <div class="outline-text-2" id="text-orgb499cfb">
 <ul class="org-ul"> <li> <a href="./20240504T224810--kdoc-165-メモの課題と対応策を考える__structure.html">KDOC 165: メモの課題と対応策を考える</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251214T123530--kdoc-505-既存メモ側からどういった関連ができそうか考える__essay.html"/>
  <id>https://kijimad.github.io/roam/20251214T123530--kdoc-505-既存メモ側からどういった関連ができそうか考える__essay.html</id>
  <updated>2025-12-18T08:09:38+09:00</updated>
</entry>
<entry>
  <title>KDOC 488: CookieはHTTPの仕様に含まれる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org2f8898a" class="outline-2">
 <h2 id="org2f8898a"> <a href="#org2f8898a">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org2f8898a">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-06 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-08 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org3c1c716" class="outline-2">
 <h2 id="org3c1c716"> <a href="#org3c1c716">概要</a></h2>
 <div class="outline-text-2" id="text-org3c1c716">
 <p>
HTTPの仕様のなかに、Cookieがある。HTTPリクエストとレスポンスにステートフルなセッション提供するため提案されたという。
</p>

 <ul class="org-ul"> <li> <a href="https://ja.wikipedia.org/wiki/HTTP_cookie">HTTP cookie - Wikipedia</a></li>
 <li> <a href="https://www.rfc-editor.org/rfc/rfc2109">RFC 2109: HTTP State Management Mechanism</a></li>
 <li> <a href="https://www.rfc-editor.org/rfc/rfc6265">RFC 6265: HTTP State Management Mechanism</a></li>
</ul></div>
</div>
 <div id="outline-container-org548ab64" class="outline-2">
 <h2 id="org548ab64"> <a href="#org548ab64">関連</a></h2>
 <div class="outline-text-2" id="text-org548ab64">
 <ul class="org-ul"> <li> <a href="20251120T225113--kdoc-487-cookieは自動で送る__permanent.html#ID-20251120T225113">KDOC 487: Cookieは自動で送る</a>。調べたきっかけ</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251120T225617--kdoc-488-cookieはhttpの仕様に含まれる__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251120T225617--kdoc-488-cookieはhttpの仕様に含まれる__permanent.html</id>
  <updated>2025-12-18T08:09:36+09:00</updated>
</entry>
<entry>
  <title>KDOC 504: 家電売り場で栄枯盛衰を感じる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgcc7f913" class="outline-2">
 <h2 id="orgcc7f913"> <a href="#orgcc7f913">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgcc7f913">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org7023b9b" class="outline-2">
 <h2 id="org7023b9b"> <a href="#org7023b9b">概要</a></h2>
 <div class="outline-text-2" id="text-org7023b9b">
 <p>
日曜の午後、池袋駅付近にある複数の大型家電店をぶらついた。あてもなく1フロアずつ練り歩いたところ、気づいたことがあった。
</p>

 <ul class="org-ul"> <li>どの店も1階にスマートフォン売り場があり、人で混雑している</li>
 <li>PC周辺機器などのIT・小型家電で1フロアになっていることが多い。テレビ、冷蔵庫、洗濯機などの大型家電で1フロアになっていることが多い</li>
 <li>テレビは広大な売り場面積を占めるが、閑散としていた。大量のテレビの音響が混ざり合ってガヤガヤした音だけが響いていた。数組の若いカップルと店員がテーブルに座って契約を進めているように見えた。明らかに大型家電にはシーズン性があるが、それを差し引いても人がいないのに驚いた。疲れて休憩がてら見る人さえいなかった。テレビは家電量販店の花形コーナーだと考えていた</li>
 <li>カメラコーナーは広く充実しているが、あまり人はいない</li>
 <li>PC周辺機器コーナーは人が多く、老若男女多くの人がいた</li>
</ul> <p>
ひとくちに家電量販店といっても、内部では客数に大きな違いがあり、自分の持っている直感とは異なるのを体感した <sup> <a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>。自分が何を作りたいかと、それを時代が必要としているかは別の話だ。
</p>
</div>
</div>
 <div id="outline-container-orgf532701" class="outline-2">
 <h2 id="orgf532701"> <a href="#orgf532701">関連</a></h2>
 <div class="outline-text-2" id="text-orgf532701">
 <ul class="org-ul"> <li>追加調査: 具体的に額ベースや売り場面積でジャンルごとの推移を調べる方法はあるか</li>
</ul></div>
</div>
 <div id="footnotes">
 <h2 class="footnotes">Footnotes: </h2>
 <div id="text-footnotes">

 <div class="footdef"> <sup> <a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"> <p class="footpara">
もちろん利益率が違うので、人があまり多くないように見えても利益率は高い、ということもありそうである。
</p></div></div>


</div>
</div></div>]]></content>
  <link href="https://kijimad.github.io/roam/20251213T193458--kdoc-504-家電売り場で栄枯盛衰を感じる__draft_essay.html"/>
  <id>https://kijimad.github.io/roam/20251213T193458--kdoc-504-家電売り場で栄枯盛衰を感じる__draft_essay.html</id>
  <updated>2025-12-18T08:09:34+09:00</updated>
</entry>
<entry>
  <title>KDOC 490: 301と302/307のキャッシュ動作の違い</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org97d5210" class="outline-2">
 <h2 id="org97d5210"> <a href="#org97d5210">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org97d5210">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-06 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org24be65f" class="outline-2">
 <h2 id="org24be65f"> <a href="#org24be65f">概要</a></h2>
 <div class="outline-text-2" id="text-org24be65f">
 <p>
HTTPステータスコードの301と302/307は、どれもリダイレクトということで似ているのだが、ブラウザでキャッシュの扱いに違いがある。
</p>

 <p>
301は恒久的リダイレクトで、キャッシュできる、とHTTPの仕様で言及されている。
</p>

 <blockquote>
 <p>
A 301 response is heuristically cacheable; i.e., unless otherwise indicated by the method definition or explicit cache controls (see Section 4.2.2 of [CACHING]).
 <a href="https://www.rfc-editor.org/rfc/rfc9110#status.301">RFC 9110: HTTP Semantics</a>
</p>
</blockquote>

 <p>
302/307は一時的リダイレクトなので、キャッシュについては言及していないように見える。じっさいの動作から考えて、毎回リダイレクト判断しているようである。
</p>
</div>
</div>
 <div id="outline-container-org4ea7046" class="outline-2">
 <h2 id="org4ea7046"> <a href="#org4ea7046">関連</a></h2>
 <div class="outline-text-2" id="text-org4ea7046">
 <ul class="org-ul"> <li>追加調査: ブラウザの動作をじっさいに試す</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251128T092223--kdoc-490-301と302307のキャッシュ動作の違い__wiki.html"/>
  <id>https://kijimad.github.io/roam/20251128T092223--kdoc-490-301と302307のキャッシュ動作の違い__wiki.html</id>
  <updated>2025-12-18T08:09:32+09:00</updated>
</entry>
<entry>
  <title>KDOC 506: 圧倒的な量が集まってきたから好きになる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgeb8220f" class="outline-2">
 <h2 id="orgeb8220f"> <a href="#orgeb8220f">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgeb8220f">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgffb4db8" class="outline-2">
 <h2 id="orgffb4db8"> <a href="#orgffb4db8">概要</a></h2>
 <div class="outline-text-2" id="text-orgffb4db8">
 <p>
 <a href="20221027T235104--kdoc-3-『ない仕事の作り方』__book.html#ID-20221027T235104">KDOC 3: 『ない仕事の作り方』</a>から、ないジャンルに名前をつけ、発表にいたるまでの流れを示す。
</p>

 <ol class="org-ol"> <li>こんな知識が何の役に立つのだろうかと考える暇を与えず、大量に摂取する</li>
 <li>好きだから集めるのではなく、圧倒的な量が集まってきたから好きになっていく</li>
 <li>「これだけ面白いものが流行らないわけがない」と自分の洗脳が進み、他人に興味を持ってもらえるようになっていく</li>
</ol></div>
</div>
 <div id="outline-container-orgb46734a" class="outline-2">
 <h2 id="orgb46734a"> <a href="#orgb46734a">関連</a></h2>
 <div class="outline-text-2" id="text-orgb46734a">
 <ul class="org-ul"> <li>引用:  <a href="20221027T235104--kdoc-3-『ない仕事の作り方』__book.html#ID-20221027T235104">KDOC 3: 『ない仕事の作り方』</a>。から</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251214T193935--kdoc-506-圧倒的な量が集まってきたから好きになる__essay.html"/>
  <id>https://kijimad.github.io/roam/20251214T193935--kdoc-506-圧倒的な量が集まってきたから好きになる__essay.html</id>
  <updated>2025-12-18T08:08:48+09:00</updated>
</entry>
<entry>
  <title>KDOC 496: Index (Only) Scanの様子を見る</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org7f2b572" class="outline-2">
 <h2 id="org7f2b572"> <a href="#org7f2b572">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org7f2b572">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgf14e8f6" class="outline-2">
 <h2 id="orgf14e8f6"> <a href="#orgf14e8f6">概要</a></h2>
 <div class="outline-text-2" id="text-orgf14e8f6">
 <p>
PostgreSQLで、インデックスが使われる様子を確かめる。
</p>

 <p>
まず、indexを使わないパターン。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>indexがないフィールドを条件にするのでindexは使われない</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">NAME</span>  <span class="org-type">VARCHAR</span>(255),
    num  <span class="org-type">INTEGER</span>
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">NAME</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">indexを使わない
</span>explain
 <span class="org-keyword">SELECT</span>  <span class="org-keyword">NAME</span>  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span> num = 1;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                        |
|--------------------------------------------------------|
| > CREATE TABLE users (                                 |
| >     NAME VARCHAR(255),                               |
| >     num INTEGER                                      |
| > );                                                   |
| CREATE TABLE                                           |
|                                                        |
| > CREATE INDEX idx_users_name ON users(NAME);          |
| CREATE INDEX                                           |
|                                                        |
| > explain                                              |
| > SELECT NAME FROM users WHERE num = 1;                |
| QUERY PLAN                                             |
| Seq Scan on users  (cost=0.00..11.75 rows=1 width=516) |
| Filter: (num = 1)                                      |
</pre>
</div>

 <p>
つぎに、index scan するパターン。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 2: </span>検索にインデックスidx_users_nameを使うが、結果として返すidは含まれていないのでヒープアクセスが発生し、index Only Scanにはならない</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    id serial  <span class="org-keyword">PRIMARY</span>  <span class="org-keyword">KEY</span>,
     <span class="org-keyword">NAME</span>  <span class="org-type">VARCHAR</span>(255)
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">NAME</span>);

explain
 <span class="org-keyword">SELECT</span> id  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span>  <span class="org-keyword">NAME</span> =  <span class="org-string">'a'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                            |
|----------------------------------------------------------------------------|
| > CREATE TABLE users (                                                     |
| >     id serial PRIMARY KEY,                                               |
| >     NAME VARCHAR(255)                                                    |
| > );                                                                       |
| CREATE TABLE                                                               |
|                                                                            |
| > CREATE INDEX idx_users_name ON users(NAME);                              |
| CREATE INDEX                                                               |
|                                                                            |
| > explain                                                                  |
| > SELECT id FROM users WHERE NAME = 'a';                                   |
| QUERY PLAN                                                                 |
| Index Scan using idx_users_name on users  (cost=0.14..8.16 rows=1 width=4) |
| Index Cond: ((name)::text = 'a'::text)                                     |
</pre>
</div>

 <p>
index only scan するパターン。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 3: </span>Index Only Scanする。検索にインデックスidx_users_nameを使い、結果もnameだけなので、indexだけで完結する。</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">NAME</span>  <span class="org-type">VARCHAR</span>(255),
    num  <span class="org-type">INTEGER</span>
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">NAME</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">indexを使う
</span>explain
 <span class="org-keyword">SELECT</span>  <span class="org-keyword">NAME</span>  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span>  <span class="org-keyword">NAME</span> =  <span class="org-string">'a'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                   |
|-----------------------------------------------------------------------------------|
| > CREATE TABLE users (                                                            |
| >     NAME VARCHAR(255),                                                          |
| >     num INTEGER                                                                 |
| > );                                                                              |
| CREATE TABLE                                                                      |
|                                                                                   |
| > CREATE INDEX idx_users_name ON users(NAME);                                     |
| CREATE INDEX                                                                      |
|                                                                                   |
| > explain                                                                         |
| > SELECT NAME FROM users WHERE NAME = 'a';                                        |
| QUERY PLAN                                                                        |
| Index Only Scan using idx_users_name on users  (cost=0.14..8.16 rows=1 width=516) |
| Index Cond: (name = 'a'::text)                                                    |
</pre>
</div>
</div>
</div>
 <div id="outline-container-org2ec342f" class="outline-2">
 <h2 id="org2ec342f"> <a href="#org2ec342f">関連</a></h2>
 <div class="outline-text-2" id="text-org2ec342f">
 <ul class="org-ul"> <li>具体例:  <a href="20251206T184941--kdoc-495-文芸的にdb動作を検証できるようにする__project.html#ID-20251206T184941">KDOC 495: 文芸的にDB動作を検証できるようにする</a>。を使って検証した</li>
 <li>追加調査: QUERY PLANの値の意味をよくわかってないので調べる</li>
</ul></div>
</div>
 <div id="outline-container-org06f70f2" class="outline-2">
 <h2 id="org06f70f2"> <a href="#org06f70f2">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org06f70f2">
 <ul class="org-ul"> <li> <a href="./20251207T091742--kdoc-497-複合インデックスの使用条件を試す__permanent.html">KDOC 497: 複合インデックスの使用条件を試す</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251206T213844--kdoc-496-index-only-scanの様子を見る__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251206T213844--kdoc-496-index-only-scanの様子を見る__permanent.html</id>
  <updated>2025-12-18T08:08:46+09:00</updated>
</entry>
<entry>
  <title>KDOC 495: 文芸的にDB動作を検証できるようにする</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org6861051" class="outline-2">
 <h2 id="org6861051"> <a href="#org6861051">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org6861051">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org52fa52d" class="outline-2">
 <h2 id="org52fa52d"> <a href="#org52fa52d">概要</a></h2>
 <div class="outline-text-2" id="text-org52fa52d">
 <p>
文芸的にDB動作を検証できるようにした。
</p>
</div>
</div>
 <div id="outline-container-org6eaffe5" class="outline-2">
 <h2 id="org6eaffe5"> <a href="#org6eaffe5">背景</a></h2>
 <div class="outline-text-2" id="text-org6eaffe5">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？</a>を読んで、データベースの機能について知らないことが多いのを知った。
</p>

 <p>
コンピュータのほかの事柄と同様に、じっさいに試して、挙動を仔細にみて背景にあるアイデアを理解し、自分なりのモデルを構築していくのが必要に見えた。REPLでいじるのではなく、記録しつつ試していけると、あとで見返すこともできよさそうである。
</p>

 <p>
そういうことを気軽にできるようにした。
</p>
</div>
</div>
 <div id="outline-container-org542a534" class="outline-2">
 <h2 id="org542a534"> <a href="#org542a534">要件</a></h2>
 <div class="outline-text-2" id="text-org542a534">
 <ul class="org-ul"> <li>少ない準備で気軽にデータベースを実行できる</li>
 <li>文芸的プログラミングができる。入力と標準出力をテキストに残し、そのままドキュメント化できる
 <ul class="org-ul"> <li>入力クエリを出力にエコー表示できる</li>
</ul></li>
 <li>毎回クリーンな環境で、完全に再現できる</li>
 <li>org-mode org-babelの  <code>sql</code> ブロックから直接使える</li>
 <li>完全に同等の機能が使える。インデックス、EXPLAIN、トランザクション…が使える</li>
</ul></div>
</div>
 <div id="outline-container-org200a63c" class="outline-2">
 <h2 id="org200a63c"> <a href="#org200a63c">使用例</a></h2>
 <div class="outline-text-2" id="text-org200a63c">
 <p>
リポジトリは <a href="https://github.com/kijimad/pgpg">kijimad/pgpg</a>にある。
</p>

 <p>
根本的なアイデアは、データベースのプロキシを実装し、フック処理を追加することである。プロキシで、実験に必要な処理(DB初期化と削除)を実行する。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>DBとプロキシを起動する</label> <pre class="src src-shell">docker compose up -d
</pre>
</div>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 2: </span>org-modeの見出しやファイルヘッダに接続先情報を書く</label> <pre class="src src-org-mode">:PROPERTIES:
  :header-args+: :results table
  :header-args+: :database postgres
  :header-args+: :dbhost localhost
  :header-args+: :dbport 15432
  :header-args+: :dbuser postgres
  :header-args+: :engine postgresql
:END:
</pre>
</div>

 <p>
あとは、org-babelでSQLを実行して評価する。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">select</span> 1+1  <span class="org-keyword">as</span>  <span class="org-keyword">result</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                         |
|-------------------------|
| > select 1+1 as result; |
| result                  |
| 2                       |
</pre>
</div>

 <p>
データベースは接続のたびにリセットされる。完全に再現可能で、あとで読みやすい。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 3: </span>リセットされるので実行のたびに同じ結果が出る</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255),
    tel  <span class="org-type">integer</span>
);
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>, tel)  <span class="org-keyword">VALUES</span> ( <span class="org-string">'きじま'</span>, 100);
 <span class="org-keyword">SELECT</span> *  <span class="org-keyword">FROM</span> users;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                         |     |
|---------------------------------------------------------+-----|
| > CREATE TABLE users (                                  |     |
| >     name varchar(255),                                |     |
| >     tel integer                                       |     |
| > );                                                    |     |
| CREATE TABLE                                            |     |
|                                                         |     |
| > INSERT INTO users (name, tel) VALUES ('きじま', 100); |     |
| INSERT 0 1                                              |     |
|                                                         |     |
| > SELECT * FROM users;                                  |     |
| name                                                    | tel |
| きじま                                                  | 100 |
</pre>
</div>
</div>
</div>
 <div id="outline-container-org0545c5f" class="outline-2">
 <h2 id="org0545c5f"> <a href="#org0545c5f">関連</a></h2>
 <div class="outline-text-2" id="text-org0545c5f">
 <ul class="org-ul"> <li>動機:  <a href="20240207T092747--kdoc-77-検証する方法があると理解が進む__essay.html#ID-20240207T092747">KDOC 77: 検証する方法があると理解が進む</a>。に基づいて作った</li>
</ul></div>
</div>
 <div id="outline-container-org06d0701" class="outline-2">
 <h2 id="org06d0701"> <a href="#org06d0701">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org06d0701">
 <ul class="org-ul"> <li> <a href="./20251206T213844--kdoc-496-index-only-scanの様子を見る__permanent.html">KDOC 496: Index (Only) Scanの様子を見る</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251206T184941--kdoc-495-文芸的にdb動作を検証できるようにする__project.html"/>
  <id>https://kijimad.github.io/roam/20251206T184941--kdoc-495-文芸的にdb動作を検証できるようにする__project.html</id>
  <updated>2025-12-18T08:08:46+09:00</updated>
</entry>
<entry>
  <title>KDOC 489: 『Kubernetesで実践するクラウドネイティブDevOps』</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org50936fa" class="outline-2">
 <h2 id="org50936fa"> <a href="#org50936fa">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org50936fa">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org02b1770" class="outline-2">
 <h2 id="org02b1770"> <a href="#org02b1770">概要</a></h2>
 <div class="outline-text-2" id="text-org02b1770">
 <p>
『Kubernetesで実践するクラウドネイティブDevOps』は、Kubenetesによるdevopsを解説する本である。
</p>
</div>
</div>
 <div id="outline-container-org3be7bb2" class="outline-2">
 <h2 id="org3be7bb2"> <a href="#org3be7bb2">メモ</a></h2>
 <div class="outline-text-2" id="text-org3be7bb2">
 <ul class="org-ul"> <li>DepOptsの4つの柱(p5)
 <ul class="org-ul"> <li>文化</li>
 <li>自動化</li>
 <li>測定</li>
 <li>共有</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org30bb047" class="outline-2">
 <h2 id="org30bb047"> <a href="#org30bb047">関連</a></h2>
 <div class="outline-text-2" id="text-org30bb047">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251122T144737--kdoc-489-『kubernetesで実践するクラウドネイティブdevops』__draft_book.html"/>
  <id>https://kijimad.github.io/roam/20251122T144737--kdoc-489-『kubernetesで実践するクラウドネイティブdevops』__draft_book.html</id>
  <updated>2025-12-18T08:08:41+09:00</updated>
</entry>
<entry>
  <title>KDOC 500: Covering Indexを試す</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org2c72271" class="outline-2">
 <h2 id="org2c72271"> <a href="#org2c72271">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org2c72271">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgad871a2" class="outline-2">
 <h2 id="orgad871a2"> <a href="#orgad871a2">概要</a></h2>
 <div class="outline-text-2" id="text-orgad871a2">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？</a>で、Covering Indexという見慣れない単語を見た。調べて、試す。
</p>

 <p>
インデックスにINCLUDEオプションをつけることで、内容についてもキャッシュを追加できる。
</p>

 <blockquote>
 <p>
オプションのINCLUDE句は非キー列としてインデックスに含める列のリストを指定します。 非キー列をインデックススキャンの検索条件に使うことはできません。また、インデックスで何であれ一意性制約や排他制約を強制する目的に対しても無視されます。 しかしながら、インデックスオンリースキャンは、インデックスエントリから値を直接得ることができるので、インデックスのテーブルを見に行く必要なく、非キー列の内容を返すことができます。 このように非キー列の追加は、そうでないとできないインデックスオンリースキャンを利用可能にします。
 <a href="https://www.postgresql.jp/docs/13/sql-createindex.html">CREATE INDEX</a>
</p>
</blockquote>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    tel  <span class="org-type">integer</span>,
    name1  <span class="org-type">varchar</span>(255),
    name2  <span class="org-type">varchar</span>(255)
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name1  <span class="org-keyword">ON</span> users(name1) INCLUDE (tel);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name2  <span class="org-keyword">ON</span> users(name2);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">include付き。Index Only Scan
</span>explain
 <span class="org-keyword">select</span> tel  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> name1 =  <span class="org-string">'a'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">includeなし。Index Scan
</span>explain
 <span class="org-keyword">select</span> tel  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> name2 =  <span class="org-string">'a'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                  |
|----------------------------------------------------------------------------------|
| > CREATE TABLE users (                                                           |
| >     tel integer,                                                               |
| >     name1 varchar(255),                                                        |
| >     name2 varchar(255)                                                         |
| > );                                                                             |
| CREATE TABLE                                                                     |
|                                                                                  |
| > CREATE INDEX idx_users_name1 ON users(name1) INCLUDE (tel);                    |
| CREATE INDEX                                                                     |
|                                                                                  |
| > CREATE INDEX idx_users_name2 ON users(name2);                                  |
| CREATE INDEX                                                                     |
|                                                                                  |
| > explain                                                                        |
| > select tel from users where name1 = 'a';                                       |
| QUERY PLAN                                                                       |
| Index Only Scan using idx_users_name1 on users  (cost=0.14..8.16 rows=1 width=4) |
| Index Cond: (name1 = 'a'::text)                                                  |
|                                                                                  |
| > explain                                                                        |
| > select tel from users where name2 = 'a';                                       |
| QUERY PLAN                                                                       |
| Index Scan using idx_users_name2 on users  (cost=0.14..8.16 rows=1 width=4)      |
| Index Cond: ((name2)::text = 'a'::text)                                          |
</pre>
</div>
</div>
</div>
 <div id="outline-container-orgfdc8899" class="outline-2">
 <h2 id="orgfdc8899"> <a href="#orgfdc8899">関連</a></h2>
 <div class="outline-text-2" id="text-orgfdc8899">
 <ul class="org-ul"> <li>類推:  <a href="20251207T091742--kdoc-497-複合インデックスの使用条件を試す__permanent.html#ID-20251207T091742">KDOC 497: 複合インデックスの使用条件を試す</a>。同じくインデックスの話題</li>
 <li>具体例: どういったユースケースでCovering Indexを使うべきなのか</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251208T083954--kdoc-500-covering-indexを試す__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251208T083954--kdoc-500-covering-indexを試す__permanent.html</id>
  <updated>2025-12-18T08:08:40+09:00</updated>
</entry>
<entry>
  <title>KDOC 492: 小石川植物園を観察する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org511e56f" class="outline-2">
 <h2 id="org511e56f"> <a href="#org511e56f">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org511e56f">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org3807548" class="outline-2">
 <h2 id="org3807548"> <a href="#org3807548">概要</a></h2>
 <div class="outline-text-2" id="text-org3807548">
 <p>
小石川植物園は、東京都文京区にある植物園である。
</p>

 <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7811.570390628713!2d139.74391341198717!3d35.71747657246128!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188db3e92ec1bb%3A0xb8d81a9078dce5c5!2sKoishikawa%20Botanical%20Garden!5e1!3m2!1sen!2sjp!4v1764719370847!5m2!1sen!2sjp" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
</div>
 <div id="outline-container-org8103653" class="outline-2">
 <h2 id="org8103653"> <a href="#org8103653">メモ</a></h2>
 <div class="outline-text-2" id="text-org8103653">
 <ul class="org-ul"> <li>広い。道は多くあって、特に順路などはない</li>
 <li>あまりイントロダクションはなく、自由に経路を選ぶ。解説も各所にあるのだが、植物に関する知識がないのであまりピンとこなかった</li>
 <li>博物館として細かい文章を読むというよりは、公園として目で見て楽しんでいる人が多いように見えた。広場でレクレーションをやっているグループさえあった。小さい字を読む気もあまり起きなかった。自然豊かなリラックスした雰囲気で、読んだり考えたくなかった。個別の植物を見るというより、森や公園の雰囲気を楽しんだ</li>
 <li>もともと植物を知っている人にとってはまた違った魅力を持つものだろう</li>
 <li>重厚な温室の設備があって、興味深かった。噴霧と気温でもうもうとしていて、メガネが一瞬で曇った</li>
 <li>鉢に管理番号カードを差して、1つ1つ管理しているようであった</li>
 <li>きれいな日本庭園と、大学の校舎として使われた歴史的建築物があった。こんな美しい校舎で学ぶのはいったいどのような気分なのだろうと考えた</li>
 <li>森林部分と日本庭園部分は高低差があり、崖状になっていた。それが美しい景観を生み出していたように見える</li>
</ul></div>
</div>
 <div id="outline-container-orgc076536" class="outline-2">
 <h2 id="orgc076536"> <a href="#orgc076536">関連</a></h2>
 <div class="outline-text-2" id="text-orgc076536">
 <p>
なし。
</p>
</div>
</div>
 <div id="outline-container-org2933219" class="outline-2">
 <h2 id="org2933219"> <a href="#org2933219">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org2933219">
 <ul class="org-ul"> <li> <a href="./20240908T180537--kdoc-238-他人の博物館を観察して参考にする__project.html">KDOC 238: 他人の博物館を観察して参考にする</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251130T101158--kdoc-492-小石川植物園を観察する__essay.html"/>
  <id>https://kijimad.github.io/roam/20251130T101158--kdoc-492-小石川植物園を観察する__essay.html</id>
  <updated>2025-12-18T08:08:38+09:00</updated>
</entry>
<entry>
  <title>KDOC 503: Linuxカーネルは/boot配下にあるvmlinuzファイルである</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgf4f8cf8" class="outline-2">
 <h2 id="orgf4f8cf8"> <a href="#orgf4f8cf8">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgf4f8cf8">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org5c40598" class="outline-2">
 <h2 id="org5c40598"> <a href="#org5c40598">概要</a></h2>
 <div class="outline-text-2" id="text-org5c40598">
 <p>
Linuxカーネルは  <code>/boot</code> 配下にある  <code>vmlinuz</code> ファイルである、といえる。カーネルは  <code>gzip</code> で圧縮されているので  <code>z</code> がついている。
</p>

 <p>
手元の環境で試してみると確かに  <code>vmlinuz</code> が存在する。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>確かめる</label> <pre class="src src-shell">ls /boot -al
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">total 95208
drwxr-xr-x  4 root root     4096 Feb 11  2025 .
drwxr-xr-x 24 root root     4096 Oct  5 22:04 ..
-rw-r--r--  1 root root   287413 Dec  1  2024 config-6.8.0-51-generic
drwx------  3 root root     4096 Jan  1  1970 efi
drwxr-xr-x  5 root root     4096 Feb 11  2025 grub
lrwxrwxrwx  1 root root       27 Feb 11  2025 initrd.img -> initrd.img-6.8.0-51-generic
-rw-r--r--  1 root root 73134942 Feb 11  2025 initrd.img-6.8.0-51-generic
lrwxrwxrwx  1 root root       27 Feb 11  2025 initrd.img.old -> initrd.img-6.8.0-51-generic
-rw-------  1 root root  9072978 Dec  1  2024 System.map-6.8.0-51-generic
lrwxrwxrwx  1 root root       24 Feb 11  2025 vmlinuz -> vmlinuz-6.8.0-51-generic
-rw-r--r--  1 root root 14969224 Dec  1  2024 vmlinuz-6.8.0-51-generic
</pre>
</div>
</div>
</div>
 <div id="outline-container-org0b5456e" class="outline-2">
 <h2 id="org0b5456e"> <a href="#org0b5456e">関連</a></h2>
 <div class="outline-text-2" id="text-org0b5456e">
 <ul class="org-ul"> <li>引用:  <a href="20240105T215847--kdoc-63-『私はどのようにしてlinuxカーネルを学んだか』__book.html#ID-20240105T215847">KDOC 63: 『私はどのようにしてLinuxカーネルを学んだか』</a>から。端的にどこにあたるかが示されていて面白いと感じた</li>
 <li>追加調査:  <code>/boot</code> ディレクトリのほかのファイルが何か見る</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251212T232903--kdoc-503-linuxカーネルはboot配下にあるvmlinuzファイルである__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251212T232903--kdoc-503-linuxカーネルはboot配下にあるvmlinuzファイルである__permanent.html</id>
  <updated>2025-12-18T08:08:37+09:00</updated>
</entry>
<entry>
  <title>KDOC 501: インデックスのオーバーヘッドを検証する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org466b3d6" class="outline-2">
 <h2 id="org466b3d6"> <a href="#org466b3d6">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org466b3d6">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org4dd24ad" class="outline-2">
 <h2 id="org4dd24ad"> <a href="#org4dd24ad">概要</a></h2>
 <div class="outline-text-2" id="text-org4dd24ad">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？ — Just use Postgres 読書感想文</a>のOver-Indexingを読んで、インデックスの具体的なオーバヘッドを知った。
</p>

 <blockquote>
 <ul class="org-ul"> <li>作成時にディスク容量を消費する</li>
 <li>更新時にメンテナンスコストがかかる</li>
 <li>計画時（Planning Time）にオプション評価のコストがかかる</li>
</ul></blockquote>

 <p>
これらをじっさいに試す。
</p>
</div>
 <div id="outline-container-orgdc9ec44" class="outline-3">
 <h3 id="orgdc9ec44"> <a href="#orgdc9ec44">作成時のディスク容量</a></h3>
 <div class="outline-text-3" id="text-orgdc9ec44">
 <p>
レコードを作成して、インデックスのディスク容量を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード数を確認する
</span> <span class="org-keyword">select</span>  <span class="org-builtin">count</span>(*)  <span class="org-keyword">from</span> users;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスサイズを確認する
</span> <span class="org-keyword">SELECT</span> pg_size_pretty(pg_relation_size( <span class="org-string">'idx_users_name'</span>));
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                              |   |                     |
|--------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                       |   |                     |
| >     name varchar(255)                                      |   |                     |
| > );                                                         |   |                     |
| CREATE TABLE                                                 |   |                     |
|                                                              |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                |   |                     |
| CREATE INDEX                                                 |   |                     |
|                                                              |   |                     |
| > BEGIN;                                                     |   |                     |
| BEGIN                                                        |   |                     |
|                                                              |   |                     |
| > INSERT INTO users (name)                                   |   |                     |
| > SELECT                                                     |   |                     |
| >      -- 32x2 文字                                          |   |                     |
| >      md5(random()::text)                                   |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                         |   |                     |
| INSERT 0 100000                                              |   |                     |
|                                                              |   |                     |
| > ROLLBACK;                                                  |   |                     |
| ROLLBACK                                                     |   |                     |
|                                                              |   |                     |
| > select count(*) from users;                                |   |                     |
| count                                                        |   |                     |
| 0                                                            |   |                     |
|                                                              |   |                     |
| > SELECT pg_size_pretty(pg_relation_size('idx_users_name')); |   |                     |
| pg_size_pretty                                               |   |                     |
| 12 MB                                                        |   |                     |
</pre>
</div>

 <p>
10万レコード、1レコード64バイトで、インデックスサイズは12MBある。
</p>
</div>
</div>
 <div id="outline-container-org43056ff" class="outline-3">
 <h3 id="org43056ff"> <a href="#org43056ff">更新時のコスト</a></h3>
 <div class="outline-text-3" id="text-org43056ff">
 <p>
インデックスの有無を変えてレコードを更新したときの時間を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

EXPLAIN ANALYZE
 <span class="org-keyword">UPDATE</span> users  <span class="org-keyword">SET</span>  <span class="org-keyword">name</span> =  <span class="org-string">'abc'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

EXPLAIN ANALYZE
 <span class="org-keyword">UPDATE</span> users  <span class="org-keyword">SET</span>  <span class="org-keyword">name</span> =  <span class="org-string">'def'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                                      |   |                     |
|--------------------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                               |   |                     |
| >     name varchar(255)                                                                                                              |   |                     |
| > );                                                                                                                                 |   |                     |
| CREATE TABLE                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > INSERT INTO users (name)                                                                                                           |   |                     |
| > SELECT                                                                                                                             |   |                     |
| >      -- 32x2 文字                                                                                                                  |   |                     |
| >      md5(random()::text)                                                                                                           |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                                 |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Insert on users  (cost=0.00..3500.00 rows=0 width=0) (actual time=127.862..127.863 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=102466 dirtied=1236 written=1238                                                                                 |   |                     |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3500.00 rows=100000 width=516) (actual time=2.628..92.992 rows=100000.00 loops=1)         |   |                     |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.627..88.029 rows=100000.00 loops=1) |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=6                                                                                                                |   |                     |
| Planning Time: 0.033 ms                                                                                                              |   |                     |
| Execution Time: 128.000 ms                                                                                                           |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > UPDATE users SET name = 'abc';                                                                                                     |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Update on users  (cost=0.00..1420.25 rows=0 width=0) (actual time=64.452..64.452 rows=0.00 loops=1)                                  |   |                     |
| Buffers: shared hit=304574 dirtied=437 written=437                                                                                   |   |                     |
| ->  Seq Scan on users  (cost=0.00..1420.25 rows=18525 width=522) (actual time=0.007..5.503 rows=100000.00 loops=1)                   |   |                     |
| Buffers: shared hit=1235                                                                                                             |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=22                                                                                                               |   |                     |
| Planning Time: 0.112 ms                                                                                                              |   |                     |
| Execution Time: 64.506 ms                                                                                                            |   |                     |
|                                                                                                                                      |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                                                                                        |   |                     |
| CREATE INDEX                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > UPDATE users SET name = 'def';                                                                                                     |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Update on users  (cost=0.00..2672.00 rows=0 width=0) (actual time=119.053..119.053 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=501291 read=2 dirtied=518 written=516                                                                            |   |                     |
| ->  Seq Scan on users  (cost=0.00..2672.00 rows=100000 width=522) (actual time=0.008..6.486 rows=100000.00 loops=1)                  |   |                     |
| Buffers: shared hit=1672                                                                                                             |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=15 read=1                                                                                                        |   |                     |
| Planning Time: 0.074 ms                                                                                                              |   |                     |
| Execution Time: 119.072 ms                                                                                                           |   |                     |
</pre>
</div>

 <ul class="org-ul"> <li>インデックスなしフィールドの更新(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.112 ms</li>
 <li>Execution Time: 64.506 ms</li>
</ul></li>
 <li>インデックスありフィールドの更新(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.074 ms</li>
 <li>Execution Time: 119.072 ms</li>
</ul></li>
</ul> <p>
インデックスがあると更新の計画時間は減ったが、実行時間が増加している。
</p>
</div>
</div>
 <div id="outline-container-orga521b29" class="outline-3">
 <h3 id="orga521b29"> <a href="#orga521b29">計画時間のコスト</a></h3>
 <div class="outline-text-3" id="text-orga521b29">
 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード数を確認する
</span> <span class="org-keyword">select</span>  <span class="org-builtin">count</span>(*)  <span class="org-keyword">from</span> users;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">計画の詳細を出す
</span>EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)
 <span class="org-keyword">SELECT</span> *  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span>  <span class="org-keyword">name</span> =  <span class="org-string">'NO_INDEX'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">計画の詳細を出す
</span>EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)
 <span class="org-keyword">SELECT</span> *  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span>  <span class="org-keyword">name</span> =  <span class="org-string">'WITH_INDEX'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                           |   |                     |
|---------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                    |   |                     |
| >     name varchar(255)                                                                                                   |   |                     |
| > );                                                                                                                      |   |                     |
| CREATE TABLE                                                                                                              |   |                     |
|                                                                                                                           |   |                     |
| > INSERT INTO users (name)                                                                                                |   |                     |
| > SELECT                                                                                                                  |   |                     |
| >      -- 32x2 文字                                                                                                       |   |                     |
| >      md5(random()::text)                                                                                                |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                      |   |                     |
| INSERT 0 100000                                                                                                           |   |                     |
|                                                                                                                           |   |                     |
| > select count(*) from users;                                                                                             |   |                     |
| count                                                                                                                     |   |                     |
| 100000                                                                                                                    |   |                     |
|                                                                                                                           |   |                     |
| > EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)                                                                               |   |                     |
| > SELECT * FROM users WHERE name = 'NO_INDEX';                                                                            |   |                     |
| QUERY PLAN                                                                                                                |   |                     |
| Seq Scan on public.users  (cost=0.00..1466.56 rows=93 width=516) (actual time=2.421..2.421 rows=0.00 loops=1)             |   |                     |
| Output: name                                                                                                              |   |                     |
| Filter: ((users.name)::text = 'NO_INDEX'::text)                                                                           |   |                     |
| Rows Removed by Filter: 100000                                                                                            |   |                     |
| Buffers: shared hit=1235                                                                                                  |   |                     |
| Planning:                                                                                                                 |   |                     |
| Buffers: shared hit=9                                                                                                     |   |                     |
| Planning Time: 0.038 ms                                                                                                   |   |                     |
| Execution Time: 2.426 ms                                                                                                  |   |                     |
|                                                                                                                           |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                                                                             |   |                     |
| CREATE INDEX                                                                                                              |   |                     |
|                                                                                                                           |   |                     |
| > EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)                                                                               |   |                     |
| > SELECT * FROM users WHERE name = 'WITH_INDEX';                                                                          |   |                     |
| QUERY PLAN                                                                                                                |   |                     |
| Bitmap Heap Scan on public.users  (cost=28.29..974.23 rows=500 width=516) (actual time=0.014..0.015 rows=0.00 loops=1)    |   |                     |
| Output: name                                                                                                              |   |                     |
| Recheck Cond: ((users.name)::text = 'WITH_INDEX'::text)                                                                   |   |                     |
| Buffers: shared read=3                                                                                                    |   |                     |
| ->  Bitmap Index Scan on idx_users_name  (cost=0.00..28.17 rows=500 width=0) (actual time=0.011..0.011 rows=0.00 loops=1) |   |                     |
| Index Cond: ((users.name)::text = 'WITH_INDEX'::text)                                                                     |   |                     |
| Index Searches: 1                                                                                                         |   |                     |
| Buffers: shared read=3                                                                                                    |   |                     |
| Planning:                                                                                                                 |   |                     |
| Buffers: shared hit=15 read=1                                                                                             |   |                     |
| Planning Time: 0.104 ms                                                                                                   |   |                     |
| Execution Time: 0.021 ms                                                                                                  |   |                     |
</pre>
</div>

 <ul class="org-ul"> <li>Planning Time: 0.038 ms -> 0.104 ms</li>
 <li>Execution Time: 2.426 ms -> 0.021 ms</li>
</ul> <p>
実行時間は激減したが、計画時間は増えた。この例では明らかにメリットのほうが大きいが、インデックスが増えて選択肢が増えると悪化していくのだろう。
</p>
</div>
</div>
 <div id="outline-container-orgfa7bdd5" class="outline-3">
 <h3 id="orgfa7bdd5"> <a href="#orgfa7bdd5">大量インデックスの計画コスト</a></h3>
 <div class="outline-text-3" id="text-orgfa7bdd5">
 <p>
インデックス増加による計画時間の増加を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    noindex  <span class="org-type">varchar</span>(255),
    name1  <span class="org-type">varchar</span>(255),
    name2  <span class="org-type">varchar</span>(255),
    name3  <span class="org-type">varchar</span>(255),
    name4  <span class="org-type">varchar</span>(255),
    name5  <span class="org-type">varchar</span>(255),
    name6  <span class="org-type">varchar</span>(255),
    name7  <span class="org-type">varchar</span>(255),
    name8  <span class="org-type">varchar</span>(255),
    name9  <span class="org-type">varchar</span>(255),
    name10  <span class="org-type">varchar</span>(255),
    name11  <span class="org-type">varchar</span>(255),
    name12  <span class="org-type">varchar</span>(255),
    name13  <span class="org-type">varchar</span>(255),
    name14  <span class="org-type">varchar</span>(255),
    name15  <span class="org-type">varchar</span>(255),
    name16  <span class="org-type">varchar</span>(255),
    name17  <span class="org-type">varchar</span>(255),
    name18  <span class="org-type">varchar</span>(255),
    name19  <span class="org-type">varchar</span>(255),
    name20  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users (name1)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name1  <span class="org-keyword">ON</span> users(name1);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name2  <span class="org-keyword">ON</span> users(name2);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name3  <span class="org-keyword">ON</span> users(name3);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name4  <span class="org-keyword">ON</span> users(name4);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name5  <span class="org-keyword">ON</span> users(name5);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name6  <span class="org-keyword">ON</span> users(name6);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name7  <span class="org-keyword">ON</span> users(name7);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name8  <span class="org-keyword">ON</span> users(name8);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name9  <span class="org-keyword">ON</span> users(name9);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name10  <span class="org-keyword">ON</span> users(name10);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name11  <span class="org-keyword">ON</span> users(name11);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name12  <span class="org-keyword">ON</span> users(name12);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name13  <span class="org-keyword">ON</span> users(name13);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name14  <span class="org-keyword">ON</span> users(name14);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name15  <span class="org-keyword">ON</span> users(name15);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name16  <span class="org-keyword">ON</span> users(name16);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name17  <span class="org-keyword">ON</span> users(name17);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name18  <span class="org-keyword">ON</span> users(name18);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name19  <span class="org-keyword">ON</span> users(name19);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name20  <span class="org-keyword">ON</span> users(name20);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスがないものを検索する
</span>EXPLAIN (ANALYZE)
 <span class="org-keyword">SELECT</span> noindex  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span> noindex =  <span class="org-string">'xx'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスがあるものを検索する
</span>EXPLAIN (ANALYZE)
 <span class="org-keyword">SELECT</span> name1  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span> name1 =  <span class="org-string">'xx'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                            |   |                     |
|----------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                     |   |                     |
| >     noindex varchar(255),                                                                                                |   |                     |
| >     name1 varchar(255),                                                                                                  |   |                     |
| >     name2 varchar(255),                                                                                                  |   |                     |
| >     name3 varchar(255),                                                                                                  |   |                     |
| >     name4 varchar(255),                                                                                                  |   |                     |
| >     name5 varchar(255),                                                                                                  |   |                     |
| >     name6 varchar(255),                                                                                                  |   |                     |
| >     name7 varchar(255),                                                                                                  |   |                     |
| >     name8 varchar(255),                                                                                                  |   |                     |
| >     name9 varchar(255),                                                                                                  |   |                     |
| >     name10 varchar(255),                                                                                                 |   |                     |
| >     name11 varchar(255),                                                                                                 |   |                     |
| >     name12 varchar(255),                                                                                                 |   |                     |
| >     name13 varchar(255),                                                                                                 |   |                     |
| >     name14 varchar(255),                                                                                                 |   |                     |
| >     name15 varchar(255),                                                                                                 |   |                     |
| >     name16 varchar(255),                                                                                                 |   |                     |
| >     name17 varchar(255),                                                                                                 |   |                     |
| >     name18 varchar(255),                                                                                                 |   |                     |
| >     name19 varchar(255),                                                                                                 |   |                     |
| >     name20 varchar(255)                                                                                                  |   |                     |
| > );                                                                                                                       |   |                     |
| CREATE TABLE                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > INSERT INTO users (name1)                                                                                                |   |                     |
| > SELECT                                                                                                                   |   |                     |
| >      -- 32x2 文字                                                                                                        |   |                     |
| >      md5(random()::text)                                                                                                 |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                       |   |                     |
| INSERT 0 100000                                                                                                            |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name1 ON users(name1);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name1_2 ON users(name1, name2);                                                                   |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name2 ON users(name2);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name3 ON users(name3);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name4 ON users(name4);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name5 ON users(name5);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name6 ON users(name6);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name7 ON users(name7);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name8 ON users(name8);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name9 ON users(name9);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name10 ON users(name10);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name11 ON users(name11);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name12 ON users(name12);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name13 ON users(name13);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name14 ON users(name14);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name15 ON users(name15);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name16 ON users(name16);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name17 ON users(name17);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name18 ON users(name18);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name19 ON users(name19);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name20 ON users(name20);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > EXPLAIN (ANALYZE)                                                                                                        |   |                     |
| > SELECT noindex FROM users WHERE noindex = 'xx';                                                                          |   |                     |
| QUERY PLAN                                                                                                                 |   |                     |
| Seq Scan on users  (cost=0.00..2584.00 rows=500 width=516) (actual time=1.908..1.908 rows=0.00 loops=1)                    |   |                     |
| Filter: ((noindex)::text = 'xx'::text)                                                                                     |   |                     |
| Rows Removed by Filter: 100000                                                                                             |   |                     |
| Buffers: shared hit=1334                                                                                                   |   |                     |
| Planning:                                                                                                                  |   |                     |
| Buffers: shared hit=251 read=21                                                                                            |   |                     |
| Planning Time: 0.296 ms                                                                                                    |   |                     |
| Execution Time: 1.913 ms                                                                                                   |   |                     |
|                                                                                                                            |   |                     |
| > EXPLAIN (ANALYZE)                                                                                                        |   |                     |
| > SELECT name1 FROM users WHERE name1 = 'xx';                                                                              |   |                     |
| QUERY PLAN                                                                                                                 |   |                     |
| Bitmap Heap Scan on users  (cost=28.29..1010.49 rows=500 width=516) (actual time=0.019..0.019 rows=0.00 loops=1)           |   |                     |
| Recheck Cond: ((name1)::text = 'xx'::text)                                                                                 |   |                     |
| Buffers: shared read=3                                                                                                     |   |                     |
| ->  Bitmap Index Scan on idx_users_name1  (cost=0.00..28.17 rows=500 width=0) (actual time=0.017..0.017 rows=0.00 loops=1) |   |                     |
| Index Cond: ((name1)::text = 'xx'::text)                                                                                   |   |                     |
| Index Searches: 1                                                                                                          |   |                     |
| Buffers: shared read=3                                                                                                     |   |                     |
| Planning Time: 0.037 ms                                                                                                    |   |                     |
| Execution Time: 0.023 ms                                                                                                   |   |                     |
</pre>
</div>

 <ul class="org-ul"> <li>index使用時の計画時間が、indexが1つだけのときに比べて3倍になった</li>
 <li>index使用時の実行時間は、indexが1つだけのときと変わらない</li>
 <li>index不使用時の計画時間は増加していない</li>
</ul></div>
</div>
 <div id="outline-container-orgf27371f" class="outline-3">
 <h3 id="orgf27371f"> <a href="#orgf27371f">挿入時のコスト</a></h3>
 <div class="outline-text-3" id="text-orgf27371f">
 <p>
インデックスの有無を変えてレコードを挿入したときの時間を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスなしで挿入する
</span> <span class="org-keyword">BEGIN</span>;
EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;
 <span class="org-keyword">ROLLBACK</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスありで挿入する
</span> <span class="org-keyword">BEGIN</span>;
EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;
 <span class="org-keyword">ROLLBACK</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                                      |   |                     |
|--------------------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                               |   |                     |
| >     name varchar(255)                                                                                                              |   |                     |
| > );                                                                                                                                 |   |                     |
| CREATE TABLE                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > BEGIN;                                                                                                                             |   |                     |
| BEGIN                                                                                                                                |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > INSERT INTO users (name)                                                                                                           |   |                     |
| > SELECT                                                                                                                             |   |                     |
| >      -- 32x2 文字                                                                                                                  |   |                     |
| >      md5(random()::text)                                                                                                           |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                                 |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Insert on users  (cost=0.00..3500.00 rows=0 width=0) (actual time=118.697..118.698 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=102466 dirtied=1236 written=1238                                                                                 |   |                     |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3500.00 rows=100000 width=516) (actual time=2.688..88.235 rows=100000.00 loops=1)         |   |                     |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.687..83.525 rows=100000.00 loops=1) |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=6                                                                                                                |   |                     |
| Planning Time: 0.032 ms                                                                                                              |   |                     |
| Execution Time: 118.892 ms                                                                                                           |   |                     |
|                                                                                                                                      |   |                     |
| > ROLLBACK;                                                                                                                          |   |                     |
| ROLLBACK                                                                                                                             |   |                     |
|                                                                                                                                      |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                                                                                        |   |                     |
| CREATE INDEX                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > BEGIN;                                                                                                                             |   |                     |
| BEGIN                                                                                                                                |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > INSERT INTO users (name)                                                                                                           |   |                     |
| > SELECT                                                                                                                             |   |                     |
| >      -- 32x2 文字                                                                                                                  |   |                     |
| >      md5(random()::text)                                                                                                           |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                                 |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Insert on users  (cost=0.00..3500.00 rows=0 width=0) (actual time=267.753..267.753 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=398873 read=1 dirtied=2766 written=2765                                                                          |   |                     |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3500.00 rows=100000 width=516) (actual time=2.510..91.734 rows=100000.00 loops=1)         |   |                     |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.509..86.862 rows=100000.00 loops=1) |   |                     |
| Planning Time: 0.027 ms                                                                                                              |   |                     |
| Execution Time: 267.930 ms                                                                                                           |   |                     |
|                                                                                                                                      |   |                     |
| > ROLLBACK;                                                                                                                          |   |                     |
| ROLLBACK                                                                                                                             |   |                     |
</pre>
</div>

 <p>
Execution Time が 118.892 ms -> 267.930 ms 。
</p>

 <p>
10万レコード挿入の実行時間が2倍になった。
</p>
</div>
</div>
</div>
 <div id="outline-container-orgca8cf08" class="outline-2">
 <h2 id="orgca8cf08"> <a href="#orgca8cf08">関連</a></h2>
 <div class="outline-text-2" id="text-orgca8cf08">
 <ul class="org-ul"> <li>疑問: 計画時にオプション評価のコストがかかるというが、どのような状況で問題になるのだろうか。もっと端的に増えていくケースがあるのだろうか。調べた限りだとオーバーヘッドになっているのは確かだが、実行時間の削減量に比べてわずかで、あまり問題となるように見えない</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251210T084437--kdoc-501-インデックスのオーバーヘッドを検証する__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251210T084437--kdoc-501-インデックスのオーバーヘッドを検証する__permanent.html</id>
  <updated>2025-12-18T08:08:35+09:00</updated>
</entry>
<entry>
  <title>KDOC 497: 複合インデックスの使用条件を試す</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org4f4771b" class="outline-2">
 <h2 id="org4f4771b"> <a href="#org4f4771b">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org4f4771b">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgc485a6e" class="outline-2">
 <h2 id="orgc485a6e"> <a href="#orgc485a6e">概要</a></h2>
 <div class="outline-text-2" id="text-orgc485a6e">
 <p>
複合インデックスによるスキャン方法の変化を実験した。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>複合インデックスを使う</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    id serial  <span class="org-keyword">PRIMARY</span>  <span class="org-keyword">KEY</span>,
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255),
    tel  <span class="org-type">integer</span>,
    nonidx  <span class="org-type">varchar</span>(255)
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>, tel);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコードが空だと、すべてIndex Onlyになったため
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>, tel)
 <span class="org-keyword">SELECT</span>
     <span class="org-string">'Name'</span> || (i % 1000),
    (i % 10000)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの両方の要素を使うと、インデックスが使われる
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>  <span class="org-keyword">and</span> tel = 1;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの両方の要素を使ってインデックス要素だけだと、Index Only Scanになる
</span>explain
 <span class="org-keyword">select</span>  <span class="org-keyword">name</span>  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>  <span class="org-keyword">and</span> tel = 1;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの最初の要素を使うと、インデックスが使われる
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの順番も入れ替えても、要素があっていればインデックスが使われる
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> tel = 1  <span class="org-keyword">and</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの最初の要素 + インデックス外だとインデックスが使われる
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>  <span class="org-keyword">and</span> nonidx =  <span class="org-string">'a'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの2番めの要素を使うと、インデックスが使われない
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> tel = 1;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                   |   |             |
|-----------------------------------------------------------------------------------+---+-------------|
| > CREATE TABLE users (                                                            |   |             |
| >     id serial PRIMARY KEY,                                                      |   |             |
| >     name varchar(255),                                                          |   |             |
| >     tel integer,                                                                |   |             |
| >     nonidx varchar(255)                                                         |   |             |
| > );                                                                              |   |             |
| CREATE TABLE                                                                      |   |             |
|                                                                                   |   |             |
| > CREATE INDEX idx_users_name ON users(name, tel);                                |   |             |
| CREATE INDEX                                                                      |   |             |
|                                                                                   |   |             |
| > INSERT INTO users (name, tel)                                                   |   |             |
| > SELECT                                                                          |   |             |
| >     'Name'                                                                      |   | (i % 1000), |
| >     (i % 10000)                                                                 |   |             |
| > FROM generate_series(1, 100000) i;                                              |   |             |
| INSERT 0 100000                                                                   |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where name = 'a' and tel = 1;                              |   |             |
| QUERY PLAN                                                                        |   |             |
| Index Scan using idx_users_name on users  (cost=0.28..8.30 rows=1 width=4)        |   |             |
| Index Cond: (((name)::text = 'a'::text) AND (tel = 1))                            |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select name from users where name = 'a' and tel = 1;                            |   |             |
| QUERY PLAN                                                                        |   |             |
| Index Only Scan using idx_users_name on users  (cost=0.28..8.30 rows=1 width=516) |   |             |
| Index Cond: ((name = 'a'::text) AND (tel = 1))                                    |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where name = 'a';                                          |   |             |
| QUERY PLAN                                                                        |   |             |
| Bitmap Heap Scan on users  (cost=4.43..69.98 rows=19 width=4)                     |   |             |
| Recheck Cond: ((name)::text = 'a'::text)                                          |   |             |
| ->  Bitmap Index Scan on idx_users_name  (cost=0.00..4.42 rows=19 width=0)        |   |             |
| Index Cond: ((name)::text = 'a'::text)                                            |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where tel = 1 and name = 'a';                              |   |             |
| QUERY PLAN                                                                        |   |             |
| Index Scan using idx_users_name on users  (cost=0.28..8.30 rows=1 width=4)        |   |             |
| Index Cond: (((name)::text = 'a'::text) AND (tel = 1))                            |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where name = 'a' and nonidx = 'a';                         |   |             |
| QUERY PLAN                                                                        |   |             |
| Bitmap Heap Scan on users  (cost=4.42..70.03 rows=1 width=4)                      |   |             |
| Recheck Cond: ((name)::text = 'a'::text)                                          |   |             |
| Filter: ((nonidx)::text = 'a'::text)                                              |   |             |
| ->  Bitmap Index Scan on idx_users_name  (cost=0.00..4.42 rows=19 width=0)        |   |             |
| Index Cond: ((name)::text = 'a'::text)                                            |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where tel = 1;                                             |   |             |
| QUERY PLAN                                                                        |   |             |
| Seq Scan on users  (cost=0.00..588.34 rows=19 width=4)                            |   |             |
| Filter: (tel = 1)                                                                 |   |             |
</pre>
</div>

 <p>
さまざまなスキャン方法があるのを知るのだった。
</p>

 <ul class="org-ul"> <li>Seq Scan</li>
 <li>Bitmap Index Scan</li>
 <li>Bitmap Heap Scan</li>
 <li>Index Only Scan</li>
</ul></div>
</div>
 <div id="outline-container-org5e3391d" class="outline-2">
 <h2 id="org5e3391d"> <a href="#org5e3391d">関連</a></h2>
 <div class="outline-text-2" id="text-org5e3391d">
 <ul class="org-ul"> <li>動機:  <a href="20251206T213844--kdoc-496-index-only-scanの様子を見る__permanent.html#ID-20251206T213844">KDOC 496: Index (Only) Scanの様子を見る</a>。インデックスを確かめているときに考えた</li>
 <li>追加調査: 複数のスキャン方法を試す</li>
 <li>疑問: 複合でないインデックスはなんというのか</li>
 <li>疑問: 似たインデックスが複数ある場合にどのように選ばれるか</li>
 <li>疑問: 複合インデックスは技術的にどうなっているのか</li>
</ul></div>
</div>
 <div id="outline-container-org981e596" class="outline-2">
 <h2 id="org981e596"> <a href="#org981e596">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org981e596">
 <ul class="org-ul"> <li> <a href="./20251208T083954--kdoc-500-covering-indexを試す__permanent.html">KDOC 500: Covering Indexを試す</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251207T091742--kdoc-497-複合インデックスの使用条件を試す__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251207T091742--kdoc-497-複合インデックスの使用条件を試す__permanent.html</id>
  <updated>2025-12-18T08:08:35+09:00</updated>
</entry>
<entry>
  <title>KDOC 493: 明治神宮ミュージアムを観察する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org718649f" class="outline-2">
 <h2 id="org718649f"> <a href="#org718649f">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org718649f">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgfb1e39a" class="outline-2">
 <h2 id="orgfb1e39a"> <a href="#orgfb1e39a">概要</a></h2>
 <div class="outline-text-2" id="text-orgfb1e39a">
 <p>
明治神宮ミュージアムは、明治神宮を解説する博物館である。
</p>

 <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7815.993728924776!2d139.6995454119855!3d35.67233027247567!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188d3793afecc3%3A0xa43c8d324731658c!2sMeiji%20Jingu%20Museum!5e1!3m2!1sen!2sjp!4v1764547132110!5m2!1sen!2sjp" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
</div>
 <div id="outline-container-org632f51e" class="outline-2">
 <h2 id="org632f51e"> <a href="#org632f51e">メモ</a></h2>
 <div class="outline-text-2" id="text-org632f51e">
 <ul class="org-ul"> <li>神社の建築時に使用したという大きな木の模型がある。これがガラスなどで覆われていなくて見やすい。かつ台の空間に余裕があるので、台に手をついてさまざまな角度から眺めやすい。模型は上から見てもよくわからない。同じ目線で見て、その縮尺の空間に自分が立っていることを想像しながら見るとおもしろい</li>
 <li>豪華絢爛な明治天皇ゆかりのグッズが展示されている。本質的に王様であった。平成以降しか知らないので、天皇が現在の位置づけとは異なることを認識するのだった。象徴ではなく、中央集権の頂点にいた時代</li>
 <li>明治神宮がもともと荒れ地で、人工的につくられた森であることに驚いた</li>
 <li>当時撮られた昭和初期の映像があって、すべてが珍しく感じた。たしかに歴史はつながっている</li>
 <li>明治神宮があまりに巨大な森なので全貌がわからなかったのだが、社の全体像を把握すると神聖を感じた</li>
</ul></div>
</div>
 <div id="outline-container-org542c9b8" class="outline-2">
 <h2 id="org542c9b8"> <a href="#org542c9b8">関連</a></h2>
 <div class="outline-text-2" id="text-org542c9b8">
 <p>
なし。
</p>
</div>
</div>
 <div id="outline-container-org9793128" class="outline-2">
 <h2 id="org9793128"> <a href="#org9793128">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org9793128">
 <ul class="org-ul"> <li> <a href="./20240908T180537--kdoc-238-他人の博物館を観察して参考にする__project.html">KDOC 238: 他人の博物館を観察して参考にする</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251201T085907--kdoc-493-明治神宮ミュージアムを観察する__essay.html"/>
  <id>https://kijimad.github.io/roam/20251201T085907--kdoc-493-明治神宮ミュージアムを観察する__essay.html</id>
  <updated>2025-12-18T08:08:35+09:00</updated>
</entry>
<entry>
  <title>KDOC 498: 絶滅メディア博物館を観察する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orge09c7b1" class="outline-2">
 <h2 id="orge09c7b1"> <a href="#orge09c7b1">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orge09c7b1">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-15 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgcf3c163" class="outline-2">
 <h2 id="orgcf3c163"> <a href="#orgcf3c163">概要</a></h2>
 <div class="outline-text-2" id="text-orgcf3c163">
 <p>
絶滅メディア博物館は、東京都千代田区にある博物館である。
</p>

 <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d895.7287805120283!2d139.76786299441568!3d35.68951879196432!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188d7f2e9513d1%3A0x22e77b7e3001a812!2sExtinct%20Media%20Museum!5e1!3m2!1sen!2sjp!4v1765195098606!5m2!1sen!2sjp" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
</div>
 <div id="outline-container-orgd5ccd3c" class="outline-2">
 <h2 id="orgd5ccd3c"> <a href="#orgd5ccd3c">メモ</a></h2>
 <div class="outline-text-2" id="text-orgd5ccd3c">
 <ul class="org-ul"> <li>各時代のメディアが数多く展示されている。手に持ったり、手で触れてボタンを押して試せる。これがほかの博物館ともっとも異なる点である</li>
 <li>古文書を読めるコーナーがある。古い東京の写真集や雑誌が大量にあって、手にとって読めるのは面白い体験だった</li>
 <li>たくさんの種類のガラケーがあって、当時はそうだった、と思い出した。いろいろな個性ある機種があって、携帯ショップを見るのは楽しかった。今は携帯端末は基本的にすべて同じ形状で、ささやかな違いがあるにすぎない。ショップで見る面白さは少なくなった。このパターンは、多くの博物館で見てきたものに見える。ある時期に、過剰ともいえるようなさまざまな種別が生まれるが、ある時期で収束して違いはなくなっていく。自動車/自転車/カメラ…</li>
 <li>さらに興味がある人むけに、ほかの専門的な博物館へのリンクも随所にあった。たとえば <a href="20250831T135810--kdoc-433-カメラ博物館を観察する__essay.html#ID-20250831T135810">KDOC 433: カメラ博物館を観察する</a>のカメラ博物館もあった。次のアクションを示してくれるのはよいと感じた</li>
 <li>熱意のある個人の収集愛、脱力感を感じた。全国のリサイクルショップをまわって収集しているのだという。まさに目指している姿に近い、個人が運営する博物館なのではないか</li>
</ul></div>
</div>
 <div id="outline-container-org7d0d2f3" class="outline-2">
 <h2 id="org7d0d2f3"> <a href="#org7d0d2f3">関連</a></h2>
 <div class="outline-text-2" id="text-org7d0d2f3">
 <ul class="org-ul"> <li>アイデア: 人通りがあるエリアで簡単に展示できて、金まわりもやってくれるとしたら、個人的な博物館はもっと増えるのではないだろうかと考えた。本人がやるのは物を運び入れて、並べることだけである。美術館などの企画展示コーナーはあるが、そもそも人通りがなかったり煩雑だったりする。レンタルスペースや中野ブロードウェイのニュアンスだが、販売目的でなく入場料ベースなのが異なる</li>
</ul></div>
</div>
 <div id="outline-container-orgd610374" class="outline-2">
 <h2 id="orgd610374"> <a href="#orgd610374">Backlinks</a></h2>
 <div class="outline-text-2" id="text-orgd610374">
 <ul class="org-ul"> <li> <a href="./20240908T180537--kdoc-238-他人の博物館を観察して参考にする__project.html">KDOC 238: 他人の博物館を観察して参考にする</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251207T143600--kdoc-498-絶滅メディア博物館を観察する__essay.html"/>
  <id>https://kijimad.github.io/roam/20251207T143600--kdoc-498-絶滅メディア博物館を観察する__essay.html</id>
  <updated>2025-12-18T08:08:30+09:00</updated>
</entry>
</feed>
