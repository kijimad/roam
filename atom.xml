<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><author><name>Kijima Daigo</name></author>
<title>Insomnia</title>
<generator>Emacs webfeeder.el</generator>
<link href="https://kijimad.github.io/roam"/>
<link href="https://kijimad.github.io/roam/atom.xml" rel="self"/>
<id>https://kijimad.github.io/roam/atom.xml</id>
<updated>2025-12-13T19:15:34+09:00</updated>
<entry>
  <title>KDOC 500: Covering Indexを試す</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgb811319" class="outline-2">
 <h2 id="orgb811319"> <a href="#orgb811319">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgb811319">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org9657169" class="outline-2">
 <h2 id="org9657169"> <a href="#org9657169">概要</a></h2>
 <div class="outline-text-2" id="text-org9657169">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？</a>で、Covering Indexという見慣れない単語を見た。調べて、試す。
</p>

 <p>
インデックスにINCLUDEオプションをつけることで、内容についてもキャッシュを追加できる。
</p>

 <blockquote>
 <p>
オプションのINCLUDE句は非キー列としてインデックスに含める列のリストを指定します。 非キー列をインデックススキャンの検索条件に使うことはできません。また、インデックスで何であれ一意性制約や排他制約を強制する目的に対しても無視されます。 しかしながら、インデックスオンリースキャンは、インデックスエントリから値を直接得ることができるので、インデックスのテーブルを見に行く必要なく、非キー列の内容を返すことができます。 このように非キー列の追加は、そうでないとできないインデックスオンリースキャンを利用可能にします。
 <a href="https://www.postgresql.jp/docs/13/sql-createindex.html">CREATE INDEX</a>
</p>
</blockquote>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    tel  <span class="org-type">integer</span>,
    name1  <span class="org-type">varchar</span>(255),
    name2  <span class="org-type">varchar</span>(255)
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name1  <span class="org-keyword">ON</span> users(name1) INCLUDE (tel);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name2  <span class="org-keyword">ON</span> users(name2);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">include付き。Index Only Scan
</span>explain
 <span class="org-keyword">select</span> tel  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> name1 =  <span class="org-string">'a'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">includeなし。Index Scan
</span>explain
 <span class="org-keyword">select</span> tel  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> name2 =  <span class="org-string">'a'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                  |
|----------------------------------------------------------------------------------|
| > CREATE TABLE users (                                                           |
| >     tel integer,                                                               |
| >     name1 varchar(255),                                                        |
| >     name2 varchar(255)                                                         |
| > );                                                                             |
| CREATE TABLE                                                                     |
|                                                                                  |
| > CREATE INDEX idx_users_name1 ON users(name1) INCLUDE (tel);                    |
| CREATE INDEX                                                                     |
|                                                                                  |
| > CREATE INDEX idx_users_name2 ON users(name2);                                  |
| CREATE INDEX                                                                     |
|                                                                                  |
| > explain                                                                        |
| > select tel from users where name1 = 'a';                                       |
| QUERY PLAN                                                                       |
| Index Only Scan using idx_users_name1 on users  (cost=0.14..8.16 rows=1 width=4) |
| Index Cond: (name1 = 'a'::text)                                                  |
|                                                                                  |
| > explain                                                                        |
| > select tel from users where name2 = 'a';                                       |
| QUERY PLAN                                                                       |
| Index Scan using idx_users_name2 on users  (cost=0.14..8.16 rows=1 width=4)      |
| Index Cond: ((name2)::text = 'a'::text)                                          |
</pre>
</div>
</div>
</div>
 <div id="outline-container-org65d4715" class="outline-2">
 <h2 id="org65d4715"> <a href="#org65d4715">関連</a></h2>
 <div class="outline-text-2" id="text-org65d4715">
 <ul class="org-ul"> <li>類推:  <a href="20251207T091742--kdoc-497-複合インデックスの使用条件を試す__draft_permanent.html#ID-20251207T091742">KDOC 497: 複合インデックスの使用条件を試す</a>。複合インデックスの使用条件を試す</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251208T083954--kdoc-500-covering-indexを試す__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251208T083954--kdoc-500-covering-indexを試す__draft_permanent.html</id>
  <updated>2025-12-14T04:15:30+09:00</updated>
</entry>
<entry>
  <title>KDOC 502: jsonとjsonbの性能を比較する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgeaf56b2" class="outline-2">
 <h2 id="orgeaf56b2"> <a href="#orgeaf56b2">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgeaf56b2">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orge54ca6c" class="outline-2">
 <h2 id="orge54ca6c"> <a href="#orge54ca6c">概要</a></h2>
 <div class="outline-text-2" id="text-orge54ca6c">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？ — Just use Postgres 読書感想文</a>でjsonとjsonbについて説明していた。じっさいに使ってみて読み書き性能を試してみる。
</p>

 <ul class="org-ul"> <li>「キーの順序を保持する必要がある」という特殊なケースでない限り、jsonb 一択</li>
 <li>jsonbはwrite時の変換コストがあるが、readは早い</li>
</ul></div>
</div>
 <div id="outline-container-org4c0459a" class="outline-2">
 <h2 id="org4c0459a"> <a href="#org4c0459a">関連</a></h2>
 <div class="outline-text-2" id="text-org4c0459a">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251211T084518--kdoc-502-jsonとjsonbの性能を比較する__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251211T084518--kdoc-502-jsonとjsonbの性能を比較する__draft_permanent.html</id>
  <updated>2025-12-14T04:15:29+09:00</updated>
</entry>
<entry>
  <title>KDOC 501: インデックスのオーバーヘッドを検証する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgeea4676" class="outline-2">
 <h2 id="orgeea4676"> <a href="#orgeea4676">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgeea4676">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgbb682cb" class="outline-2">
 <h2 id="orgbb682cb"> <a href="#orgbb682cb">概要</a></h2>
 <div class="outline-text-2" id="text-orgbb682cb">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？ — Just use Postgres 読書感想文</a>のOver-Indexingを読んで、インデックスの具体的なオーバヘッドを知った。
</p>

 <blockquote>
 <ul class="org-ul"> <li>作成時にディスク容量を消費する</li>
 <li>更新時にメンテナンスコストがかかる</li>
 <li>計画時（Planning Time）にオプション評価のコストがかかる</li>
</ul></blockquote>

 <p>
これらをじっさいに試す。
</p>
</div>
 <div id="outline-container-org8607f15" class="outline-3">
 <h3 id="org8607f15"> <a href="#org8607f15">作成時のディスク容量</a></h3>
 <div class="outline-text-3" id="text-org8607f15">
 <p>
レコードを作成して、インデックスのディスク容量を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード数を確認する
</span> <span class="org-keyword">select</span>  <span class="org-builtin">count</span>(*)  <span class="org-keyword">from</span> users;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスサイズを確認する
</span> <span class="org-keyword">SELECT</span> pg_size_pretty(pg_relation_size( <span class="org-string">'idx_users_name'</span>));
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                              |   |                     |
|--------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                       |   |                     |
| >     name varchar(255)                                      |   |                     |
| > );                                                         |   |                     |
| CREATE TABLE                                                 |   |                     |
|                                                              |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                |   |                     |
| CREATE INDEX                                                 |   |                     |
|                                                              |   |                     |
| > BEGIN;                                                     |   |                     |
| BEGIN                                                        |   |                     |
|                                                              |   |                     |
| > INSERT INTO users (name)                                   |   |                     |
| > SELECT                                                     |   |                     |
| >      -- 32x2 文字                                          |   |                     |
| >      md5(random()::text)                                   |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                         |   |                     |
| INSERT 0 100000                                              |   |                     |
|                                                              |   |                     |
| > ROLLBACK;                                                  |   |                     |
| ROLLBACK                                                     |   |                     |
|                                                              |   |                     |
| > select count(*) from users;                                |   |                     |
| count                                                        |   |                     |
| 0                                                            |   |                     |
|                                                              |   |                     |
| > SELECT pg_size_pretty(pg_relation_size('idx_users_name')); |   |                     |
| pg_size_pretty                                               |   |                     |
| 12 MB                                                        |   |                     |
</pre>
</div>

 <p>
10万レコード、1レコード64バイトで、インデックスサイズは12MBある。
</p>
</div>
</div>
 <div id="outline-container-org973b2b6" class="outline-3">
 <h3 id="org973b2b6"> <a href="#org973b2b6">更新時のコスト</a></h3>
 <div class="outline-text-3" id="text-org973b2b6">
 <p>
インデックスの有無を変えてフィールドを更新したときの時間を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスなしで挿入する
</span> <span class="org-keyword">BEGIN</span>;
EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;
 <span class="org-keyword">ROLLBACK</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスありで挿入する
</span> <span class="org-keyword">BEGIN</span>;
EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;
 <span class="org-keyword">ROLLBACK</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                                      |   |                     |
|--------------------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                               |   |                     |
| >     name varchar(255)                                                                                                              |   |                     |
| > );                                                                                                                                 |   |                     |
| CREATE TABLE                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > BEGIN;                                                                                                                             |   |                     |
| BEGIN                                                                                                                                |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > INSERT INTO users (name)                                                                                                           |   |                     |
| > SELECT                                                                                                                             |   |                     |
| >      -- 32x2 文字                                                                                                                  |   |                     |
| >      md5(random()::text)                                                                                                           |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                                 |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Insert on users  (cost=0.00..3500.00 rows=0 width=0) (actual time=118.697..118.698 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=102466 dirtied=1236 written=1238                                                                                 |   |                     |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3500.00 rows=100000 width=516) (actual time=2.688..88.235 rows=100000.00 loops=1)         |   |                     |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.687..83.525 rows=100000.00 loops=1) |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=6                                                                                                                |   |                     |
| Planning Time: 0.032 ms                                                                                                              |   |                     |
| Execution Time: 118.892 ms                                                                                                           |   |                     |
|                                                                                                                                      |   |                     |
| > ROLLBACK;                                                                                                                          |   |                     |
| ROLLBACK                                                                                                                             |   |                     |
|                                                                                                                                      |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                                                                                        |   |                     |
| CREATE INDEX                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > BEGIN;                                                                                                                             |   |                     |
| BEGIN                                                                                                                                |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > INSERT INTO users (name)                                                                                                           |   |                     |
| > SELECT                                                                                                                             |   |                     |
| >      -- 32x2 文字                                                                                                                  |   |                     |
| >      md5(random()::text)                                                                                                           |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                                 |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Insert on users  (cost=0.00..3500.00 rows=0 width=0) (actual time=267.753..267.753 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=398873 read=1 dirtied=2766 written=2765                                                                          |   |                     |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3500.00 rows=100000 width=516) (actual time=2.510..91.734 rows=100000.00 loops=1)         |   |                     |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.509..86.862 rows=100000.00 loops=1) |   |                     |
| Planning Time: 0.027 ms                                                                                                              |   |                     |
| Execution Time: 267.930 ms                                                                                                           |   |                     |
|                                                                                                                                      |   |                     |
| > ROLLBACK;                                                                                                                          |   |                     |
| ROLLBACK                                                                                                                             |   |                     |
</pre>
</div>

 <p>
Execution Time が 118.892 ms -> 267.930 ms 。
</p>

 <p>
10万レコード挿入の実行時間が2倍になった。
</p>
</div>
</div>
 <div id="outline-container-orgf12250b" class="outline-3">
 <h3 id="orgf12250b"> <a href="#orgf12250b">計画時間のコスト</a></h3>
 <div class="outline-text-3" id="text-orgf12250b">
 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード数を確認する
</span> <span class="org-keyword">select</span>  <span class="org-builtin">count</span>(*)  <span class="org-keyword">from</span> users;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">計画の詳細を出す
</span>EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)
 <span class="org-keyword">SELECT</span> *  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span>  <span class="org-keyword">name</span> =  <span class="org-string">'NO_INDEX'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">計画の詳細を出す
</span>EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)
 <span class="org-keyword">SELECT</span> *  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span>  <span class="org-keyword">name</span> =  <span class="org-string">'WITH_INDEX'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                           |   |                     |
|---------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                    |   |                     |
| >     name varchar(255)                                                                                                   |   |                     |
| > );                                                                                                                      |   |                     |
| CREATE TABLE                                                                                                              |   |                     |
|                                                                                                                           |   |                     |
| > INSERT INTO users (name)                                                                                                |   |                     |
| > SELECT                                                                                                                  |   |                     |
| >      -- 32x2 文字                                                                                                       |   |                     |
| >      md5(random()::text)                                                                                                |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                      |   |                     |
| INSERT 0 100000                                                                                                           |   |                     |
|                                                                                                                           |   |                     |
| > select count(*) from users;                                                                                             |   |                     |
| count                                                                                                                     |   |                     |
| 100000                                                                                                                    |   |                     |
|                                                                                                                           |   |                     |
| > EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)                                                                               |   |                     |
| > SELECT * FROM users WHERE name = 'NO_INDEX';                                                                            |   |                     |
| QUERY PLAN                                                                                                                |   |                     |
| Seq Scan on public.users  (cost=0.00..1466.56 rows=93 width=516) (actual time=2.421..2.421 rows=0.00 loops=1)             |   |                     |
| Output: name                                                                                                              |   |                     |
| Filter: ((users.name)::text = 'NO_INDEX'::text)                                                                           |   |                     |
| Rows Removed by Filter: 100000                                                                                            |   |                     |
| Buffers: shared hit=1235                                                                                                  |   |                     |
| Planning:                                                                                                                 |   |                     |
| Buffers: shared hit=9                                                                                                     |   |                     |
| Planning Time: 0.038 ms                                                                                                   |   |                     |
| Execution Time: 2.426 ms                                                                                                  |   |                     |
|                                                                                                                           |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                                                                             |   |                     |
| CREATE INDEX                                                                                                              |   |                     |
|                                                                                                                           |   |                     |
| > EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)                                                                               |   |                     |
| > SELECT * FROM users WHERE name = 'WITH_INDEX';                                                                          |   |                     |
| QUERY PLAN                                                                                                                |   |                     |
| Bitmap Heap Scan on public.users  (cost=28.29..974.23 rows=500 width=516) (actual time=0.014..0.015 rows=0.00 loops=1)    |   |                     |
| Output: name                                                                                                              |   |                     |
| Recheck Cond: ((users.name)::text = 'WITH_INDEX'::text)                                                                   |   |                     |
| Buffers: shared read=3                                                                                                    |   |                     |
| ->  Bitmap Index Scan on idx_users_name  (cost=0.00..28.17 rows=500 width=0) (actual time=0.011..0.011 rows=0.00 loops=1) |   |                     |
| Index Cond: ((users.name)::text = 'WITH_INDEX'::text)                                                                     |   |                     |
| Index Searches: 1                                                                                                         |   |                     |
| Buffers: shared read=3                                                                                                    |   |                     |
| Planning:                                                                                                                 |   |                     |
| Buffers: shared hit=15 read=1                                                                                             |   |                     |
| Planning Time: 0.104 ms                                                                                                   |   |                     |
| Execution Time: 0.021 ms                                                                                                  |   |                     |
</pre>
</div>

 <ul class="org-ul"> <li>Planning Time: 0.038 ms -> 0.104 ms</li>
 <li>Execution Time: 2.426 ms -> 0.021 ms</li>
</ul> <p>
実行時間は激減したが、計画時間は増えた。この例では明らかにメリットのほうが大きいが、インデックスが増えて選択肢が増えると悪化していくのだろう。
</p>
</div>
</div>
 <div id="outline-container-org0165d0a" class="outline-3">
 <h3 id="org0165d0a"> <a href="#org0165d0a">大量インデックスの計画コスト</a></h3>
 <div class="outline-text-3" id="text-org0165d0a">
 <p>
インデックス増加による計画時間の増加を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    noindex  <span class="org-type">varchar</span>(255),
    name1  <span class="org-type">varchar</span>(255),
    name2  <span class="org-type">varchar</span>(255),
    name3  <span class="org-type">varchar</span>(255),
    name4  <span class="org-type">varchar</span>(255),
    name5  <span class="org-type">varchar</span>(255),
    name6  <span class="org-type">varchar</span>(255),
    name7  <span class="org-type">varchar</span>(255),
    name8  <span class="org-type">varchar</span>(255),
    name9  <span class="org-type">varchar</span>(255),
    name10  <span class="org-type">varchar</span>(255),
    name11  <span class="org-type">varchar</span>(255),
    name12  <span class="org-type">varchar</span>(255),
    name13  <span class="org-type">varchar</span>(255),
    name14  <span class="org-type">varchar</span>(255),
    name15  <span class="org-type">varchar</span>(255),
    name16  <span class="org-type">varchar</span>(255),
    name17  <span class="org-type">varchar</span>(255),
    name18  <span class="org-type">varchar</span>(255),
    name19  <span class="org-type">varchar</span>(255),
    name20  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users (name1)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name1  <span class="org-keyword">ON</span> users(name1);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name2  <span class="org-keyword">ON</span> users(name2);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name3  <span class="org-keyword">ON</span> users(name3);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name4  <span class="org-keyword">ON</span> users(name4);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name5  <span class="org-keyword">ON</span> users(name5);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name6  <span class="org-keyword">ON</span> users(name6);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name7  <span class="org-keyword">ON</span> users(name7);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name8  <span class="org-keyword">ON</span> users(name8);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name9  <span class="org-keyword">ON</span> users(name9);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name10  <span class="org-keyword">ON</span> users(name10);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name11  <span class="org-keyword">ON</span> users(name11);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name12  <span class="org-keyword">ON</span> users(name12);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name13  <span class="org-keyword">ON</span> users(name13);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name14  <span class="org-keyword">ON</span> users(name14);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name15  <span class="org-keyword">ON</span> users(name15);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name16  <span class="org-keyword">ON</span> users(name16);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name17  <span class="org-keyword">ON</span> users(name17);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name18  <span class="org-keyword">ON</span> users(name18);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name19  <span class="org-keyword">ON</span> users(name19);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name20  <span class="org-keyword">ON</span> users(name20);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスがないものを検索する
</span>EXPLAIN (ANALYZE)
 <span class="org-keyword">SELECT</span> noindex  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span> noindex =  <span class="org-string">'xx'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスがあるものを検索する
</span>EXPLAIN (ANALYZE)
 <span class="org-keyword">SELECT</span> name1  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span> name1 =  <span class="org-string">'xx'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                            |   |                     |
|----------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                     |   |                     |
| >     noindex varchar(255),                                                                                                |   |                     |
| >     name1 varchar(255),                                                                                                  |   |                     |
| >     name2 varchar(255),                                                                                                  |   |                     |
| >     name3 varchar(255),                                                                                                  |   |                     |
| >     name4 varchar(255),                                                                                                  |   |                     |
| >     name5 varchar(255),                                                                                                  |   |                     |
| >     name6 varchar(255),                                                                                                  |   |                     |
| >     name7 varchar(255),                                                                                                  |   |                     |
| >     name8 varchar(255),                                                                                                  |   |                     |
| >     name9 varchar(255),                                                                                                  |   |                     |
| >     name10 varchar(255),                                                                                                 |   |                     |
| >     name11 varchar(255),                                                                                                 |   |                     |
| >     name12 varchar(255),                                                                                                 |   |                     |
| >     name13 varchar(255),                                                                                                 |   |                     |
| >     name14 varchar(255),                                                                                                 |   |                     |
| >     name15 varchar(255),                                                                                                 |   |                     |
| >     name16 varchar(255),                                                                                                 |   |                     |
| >     name17 varchar(255),                                                                                                 |   |                     |
| >     name18 varchar(255),                                                                                                 |   |                     |
| >     name19 varchar(255),                                                                                                 |   |                     |
| >     name20 varchar(255)                                                                                                  |   |                     |
| > );                                                                                                                       |   |                     |
| CREATE TABLE                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > INSERT INTO users (name1)                                                                                                |   |                     |
| > SELECT                                                                                                                   |   |                     |
| >      -- 32x2 文字                                                                                                        |   |                     |
| >      md5(random()::text)                                                                                                 |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                       |   |                     |
| INSERT 0 100000                                                                                                            |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name1 ON users(name1);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name1_2 ON users(name1, name2);                                                                   |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name2 ON users(name2);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name3 ON users(name3);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name4 ON users(name4);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name5 ON users(name5);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name6 ON users(name6);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name7 ON users(name7);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name8 ON users(name8);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name9 ON users(name9);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name10 ON users(name10);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name11 ON users(name11);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name12 ON users(name12);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name13 ON users(name13);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name14 ON users(name14);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name15 ON users(name15);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name16 ON users(name16);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name17 ON users(name17);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name18 ON users(name18);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name19 ON users(name19);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name20 ON users(name20);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > EXPLAIN (ANALYZE)                                                                                                        |   |                     |
| > SELECT noindex FROM users WHERE noindex = 'xx';                                                                          |   |                     |
| QUERY PLAN                                                                                                                 |   |                     |
| Seq Scan on users  (cost=0.00..2584.00 rows=500 width=516) (actual time=1.908..1.908 rows=0.00 loops=1)                    |   |                     |
| Filter: ((noindex)::text = 'xx'::text)                                                                                     |   |                     |
| Rows Removed by Filter: 100000                                                                                             |   |                     |
| Buffers: shared hit=1334                                                                                                   |   |                     |
| Planning:                                                                                                                  |   |                     |
| Buffers: shared hit=251 read=21                                                                                            |   |                     |
| Planning Time: 0.296 ms                                                                                                    |   |                     |
| Execution Time: 1.913 ms                                                                                                   |   |                     |
|                                                                                                                            |   |                     |
| > EXPLAIN (ANALYZE)                                                                                                        |   |                     |
| > SELECT name1 FROM users WHERE name1 = 'xx';                                                                              |   |                     |
| QUERY PLAN                                                                                                                 |   |                     |
| Bitmap Heap Scan on users  (cost=28.29..1010.49 rows=500 width=516) (actual time=0.019..0.019 rows=0.00 loops=1)           |   |                     |
| Recheck Cond: ((name1)::text = 'xx'::text)                                                                                 |   |                     |
| Buffers: shared read=3                                                                                                     |   |                     |
| ->  Bitmap Index Scan on idx_users_name1  (cost=0.00..28.17 rows=500 width=0) (actual time=0.017..0.017 rows=0.00 loops=1) |   |                     |
| Index Cond: ((name1)::text = 'xx'::text)                                                                                   |   |                     |
| Index Searches: 1                                                                                                          |   |                     |
| Buffers: shared read=3                                                                                                     |   |                     |
| Planning Time: 0.037 ms                                                                                                    |   |                     |
| Execution Time: 0.023 ms                                                                                                   |   |                     |
</pre>
</div>

 <ul class="org-ul"> <li>index使用時の計画時間が、indexが1つだけのときに比べて3倍になった</li>
 <li>index使用時の実行時間は、indexが1つだけのときと変わらない</li>
 <li>index不使用時の計画時間は増加していない</li>
</ul></div>
</div>
</div>
 <div id="outline-container-org39ece0c" class="outline-2">
 <h2 id="org39ece0c"> <a href="#org39ece0c">関連</a></h2>
 <div class="outline-text-2" id="text-org39ece0c">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251210T084437--kdoc-501-インデックスのオーバーヘッドを検証する__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251210T084437--kdoc-501-インデックスのオーバーヘッドを検証する__draft_permanent.html</id>
  <updated>2025-12-14T04:15:28+09:00</updated>
</entry>
<entry>
  <title>KDOC 491: 『マイクロサービスアーキテクチャ』</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgb4297fc" class="outline-2">
 <h2 id="orgb4297fc"> <a href="#orgb4297fc">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgb4297fc">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org6796668" class="outline-2">
 <h2 id="org6796668"> <a href="#org6796668">概要</a></h2>
 <div class="outline-text-2" id="text-org6796668">
</div>
</div>
 <div id="outline-container-org54de2b7" class="outline-2">
 <h2 id="org54de2b7"> <a href="#org54de2b7">メモ</a></h2>
 <div class="outline-text-2" id="text-org54de2b7">
 <ul class="org-ul"> <li>マイクロサービスはサービス指向アーキテクチャ(SOA)の一種である。サービス境界の引き方については意見が分かれるが、独立してデプロイできるのが重要である(p3)</li>
 <li>独立デプロイ可能性を実現したい場合、データベースの共有は最悪なことの1つである(p9)</li>
 <li>システムのすべての機能をまとめてデプロイしなければならない場合、モノリス、だという(p15)</li>
 <li>モジュラモノリス: 各モジュールで独立して作業できるが、デプロイするにはすべてを結合する必要がある。多くの組織で優れた選択肢で、マイクロサービスアーキテクチャの課題を回避しながら高度な並列作業ができる(p17)
 <ul class="org-ul"> <li>課題の1つとして、コードレベルで行われるような分解が、データベースにおいては行われない傾向がある(p17)</li>
 <li>モジュラごとに分解したデータベースを使うモジュラモノリスもある</li>
</ul></li>
 <li>人々はモノリスを避けるべきもの、本質的に問題があるもの、と考えるようになっている。モノリシックアーキテクチャは1つの選択肢であり有効である(p19)</li>
 <li>100万行のモノリシックアプリケーションのうち1行を変更したら、その変更をリリースするためにアプリケーション全体をデプロイする必要があるようなデプロイは、影響が大きく危険性の高いものになる可能性がある(p26)</li>
 <li>分散システムでは複数プロセスが異なるデータベースで状態を管理する。データ一貫性の観点で課題が発生する可能性がある(p33)</li>
 <li>安定したサービス境界を定義することの重要性を考えると、マイクロサービスアーキテクチャは新製品やスタートアップにとって向いてないことが多い。開発するにつれて、作業するドメインが大きく変更されるのが一般的である。ドメインモデルがじゅうぶん安定するまで待ってからサービス境界を定義するほうが適切である(p33)</li>
 <li>凝集を説明する簡潔な定義: 一緒に変更され、一緒に存在するコード(p40)</li>
 <li>状態が正しく変更されるようにする1つの方法は有限状態機械を作成することだが、複数のマイクロサービスが状態機械を管理する責任を共有していると問題になる。単一のマイクロサービスが状態を管理するとよい(p51)</li>
 <li>データベースのCRUD操作の軽量ラッパーのようなマイクロサービスは低凝集、密結合の兆候である。そのサービスにあるべきデータを管理するロジックがシステムの別の場所に分散している(p51)</li>
</ul></div>
</div>
 <div id="outline-container-orga7d6620" class="outline-2">
 <h2 id="orga7d6620"> <a href="#orga7d6620">関連</a></h2>
 <div class="outline-text-2" id="text-orga7d6620">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251129T082342--kdoc-491-『マイクロサービスアーキテクチャ』__draft_book.html"/>
  <id>https://kijimad.github.io/roam/20251129T082342--kdoc-491-『マイクロサービスアーキテクチャ』__draft_book.html</id>
  <updated>2025-12-14T04:15:27+09:00</updated>
</entry>
<entry>
  <title>KDOC 503: Linuxカーネルは/boot配下にあるvmlinuzファイルである</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgcabccdf" class="outline-2">
 <h2 id="orgcabccdf"> <a href="#orgcabccdf">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgcabccdf">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgbb7b8c8" class="outline-2">
 <h2 id="orgbb7b8c8"> <a href="#orgbb7b8c8">概要</a></h2>
 <div class="outline-text-2" id="text-orgbb7b8c8">
 <p>
Linuxカーネルは  <code>/boot</code> 配下にある  <code>vmlinuz</code> ファイルである、といえる。
</p>

 <p>
カーネルは  <code>gzip</code> で圧縮されているので  <code>z</code> がついている。
</p>
</div>
</div>
 <div id="outline-container-org2bc1969" class="outline-2">
 <h2 id="org2bc1969"> <a href="#org2bc1969">関連</a></h2>
 <div class="outline-text-2" id="text-org2bc1969">
 <ul class="org-ul"> <li>引用:  <a href="20240105T215847--kdoc-63-『私はどのようにしてlinuxカーネルを学んだか』__book.html#ID-20240105T215847">KDOC 63: 『私はどのようにしてLinuxカーネルを学んだか』</a>。から</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251212T232903--kdoc-503-linuxカーネルはboot配下にあるvmlinuzファイルである__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251212T232903--kdoc-503-linuxカーネルはboot配下にあるvmlinuzファイルである__draft_permanent.html</id>
  <updated>2025-12-14T04:15:23+09:00</updated>
</entry>
<entry>
  <title>KDOC 498: 絶滅メディア博物館を観察する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org56d1e06" class="outline-2">
 <h2 id="org56d1e06"> <a href="#org56d1e06">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org56d1e06">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org8723edc" class="outline-2">
 <h2 id="org8723edc"> <a href="#org8723edc">概要</a></h2>
 <div class="outline-text-2" id="text-org8723edc">
 <p>
絶滅メディア博物館は、東京都千代田区にある博物館である。
</p>

 <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d895.7287805120283!2d139.76786299441568!3d35.68951879196432!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188d7f2e9513d1%3A0x22e77b7e3001a812!2sExtinct%20Media%20Museum!5e1!3m2!1sen!2sjp!4v1765195098606!5m2!1sen!2sjp" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
</div>
 <div id="outline-container-orgdfd9c04" class="outline-2">
 <h2 id="orgdfd9c04"> <a href="#orgdfd9c04">メモ</a></h2>
 <div class="outline-text-2" id="text-orgdfd9c04">
 <ul class="org-ul"> <li>たくさんの種類のガラケーがあって、当時はそうだった、と思い出した。いろいろな個性ある機種があって、携帯ショップを見るのは楽しかった。今は携帯端末は基本的にすべて同じ形状で、ささやかな違いがあるにすぎない。面白くはない。このパターンは、多くの博物館で見てきたものに見える。ある時期に、過剰ともいえるようなさまざまな種別が生まれるが、ある時期で収束して違いはなくなっていく。自動車/自転車/カメラ…</li>
 <li>さらに興味がある人むけに、ほかの専門的な博物館へのリンクも随所にあった。たとえば <a href="20250831T135810--kdoc-433-カメラ博物館を観察する__essay.html#ID-20250831T135810">KDOC 433: カメラ博物館を観察する</a>のカメラ博物館など。次のアクションを示してくれるのはよいと感じた</li>
</ul></div>
</div>
 <div id="outline-container-org4cd4d0c" class="outline-2">
 <h2 id="org4cd4d0c"> <a href="#org4cd4d0c">関連</a></h2>
 <div class="outline-text-2" id="text-org4cd4d0c">
 <p>
なし。
</p>
</div>
</div>
 <div id="outline-container-orga66dfaa" class="outline-2">
 <h2 id="orga66dfaa"> <a href="#orga66dfaa">Backlinks</a></h2>
 <div class="outline-text-2" id="text-orga66dfaa">
 <ul class="org-ul"> <li> <a href="./20240908T180537--kdoc-238-他人の博物館を観察して参考にする__project.html">KDOC 238: 他人の博物館を観察して参考にする</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251207T143600--kdoc-498-絶滅メディア博物館を観察する__draft_essay.html"/>
  <id>https://kijimad.github.io/roam/20251207T143600--kdoc-498-絶滅メディア博物館を観察する__draft_essay.html</id>
  <updated>2025-12-14T04:15:21+09:00</updated>
</entry>
<entry>
  <title>KDOC 488: CookieはHTTPの仕様に含まれる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org90fbeae" class="outline-2">
 <h2 id="org90fbeae"> <a href="#org90fbeae">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org90fbeae">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-06 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-08 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgcf79940" class="outline-2">
 <h2 id="orgcf79940"> <a href="#orgcf79940">概要</a></h2>
 <div class="outline-text-2" id="text-orgcf79940">
 <p>
HTTPの仕様のなかに、Cookieがある。HTTPリクエストとレスポンスにステートフルなセッション提供するため提案されたという。
</p>

 <ul class="org-ul"> <li> <a href="https://ja.wikipedia.org/wiki/HTTP_cookie">HTTP cookie - Wikipedia</a></li>
 <li> <a href="https://www.rfc-editor.org/rfc/rfc2109">RFC 2109: HTTP State Management Mechanism</a></li>
 <li> <a href="https://www.rfc-editor.org/rfc/rfc6265">RFC 6265: HTTP State Management Mechanism</a></li>
</ul></div>
</div>
 <div id="outline-container-org2887377" class="outline-2">
 <h2 id="org2887377"> <a href="#org2887377">関連</a></h2>
 <div class="outline-text-2" id="text-org2887377">
 <ul class="org-ul"> <li> <a href="20251120T225113--kdoc-487-cookieは自動で送る__permanent.html#ID-20251120T225113">KDOC 487: Cookieは自動で送る</a>。調べたきっかけ</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251120T225617--kdoc-488-cookieはhttpの仕様に含まれる__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251120T225617--kdoc-488-cookieはhttpの仕様に含まれる__permanent.html</id>
  <updated>2025-12-14T04:15:19+09:00</updated>
</entry>
<entry>
  <title>KDOC 497: 複合インデックスの使用条件を試す</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org3cd3ac6" class="outline-2">
 <h2 id="org3cd3ac6"> <a href="#org3cd3ac6">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org3cd3ac6">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org664f2e6" class="outline-2">
 <h2 id="org664f2e6"> <a href="#org664f2e6">概要</a></h2>
 <div class="outline-text-2" id="text-org664f2e6">
 <p>
複合インデックスによるスキャン方法の変化を実験した。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>複合インデックスを使う</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    id serial  <span class="org-keyword">PRIMARY</span>  <span class="org-keyword">KEY</span>,
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255),
    tel  <span class="org-type">integer</span>,
    nonidx  <span class="org-type">varchar</span>(255)
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>, tel);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコードが空だと、すべてIndex Onlyになったため
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>, tel)
 <span class="org-keyword">SELECT</span>
     <span class="org-string">'Name'</span> || (i % 1000),
    (i % 10000)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの両方の要素を使うと、インデックスが使われる
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>  <span class="org-keyword">and</span> tel = 1;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの両方の要素を使ってインデックス要素だけだと、Index Only Scanになる
</span>explain
 <span class="org-keyword">select</span>  <span class="org-keyword">name</span>  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>  <span class="org-keyword">and</span> tel = 1;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの最初の要素を使うと、インデックスが使われる
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの順番も入れ替えても、要素があっていればインデックスが使われる
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> tel = 1  <span class="org-keyword">and</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの最初の要素 + インデックス外だとインデックスが使われる
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>  <span class="org-keyword">and</span> nonidx =  <span class="org-string">'a'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">複合インデックスの2番めの要素を使うと、インデックスが使われない
</span>explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> tel = 1;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                   |   |             |
|-----------------------------------------------------------------------------------+---+-------------|
| > CREATE TABLE users (                                                            |   |             |
| >     id serial PRIMARY KEY,                                                      |   |             |
| >     name varchar(255),                                                          |   |             |
| >     tel integer,                                                                |   |             |
| >     nonidx varchar(255)                                                         |   |             |
| > );                                                                              |   |             |
| CREATE TABLE                                                                      |   |             |
|                                                                                   |   |             |
| > CREATE INDEX idx_users_name ON users(name, tel);                                |   |             |
| CREATE INDEX                                                                      |   |             |
|                                                                                   |   |             |
| > INSERT INTO users (name, tel)                                                   |   |             |
| > SELECT                                                                          |   |             |
| >     'Name'                                                                      |   | (i % 1000), |
| >     (i % 10000)                                                                 |   |             |
| > FROM generate_series(1, 100000) i;                                              |   |             |
| INSERT 0 100000                                                                   |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where name = 'a' and tel = 1;                              |   |             |
| QUERY PLAN                                                                        |   |             |
| Index Scan using idx_users_name on users  (cost=0.28..8.30 rows=1 width=4)        |   |             |
| Index Cond: (((name)::text = 'a'::text) AND (tel = 1))                            |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select name from users where name = 'a' and tel = 1;                            |   |             |
| QUERY PLAN                                                                        |   |             |
| Index Only Scan using idx_users_name on users  (cost=0.28..8.30 rows=1 width=516) |   |             |
| Index Cond: ((name = 'a'::text) AND (tel = 1))                                    |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where name = 'a';                                          |   |             |
| QUERY PLAN                                                                        |   |             |
| Bitmap Heap Scan on users  (cost=4.43..69.98 rows=19 width=4)                     |   |             |
| Recheck Cond: ((name)::text = 'a'::text)                                          |   |             |
| ->  Bitmap Index Scan on idx_users_name  (cost=0.00..4.42 rows=19 width=0)        |   |             |
| Index Cond: ((name)::text = 'a'::text)                                            |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where tel = 1 and name = 'a';                              |   |             |
| QUERY PLAN                                                                        |   |             |
| Index Scan using idx_users_name on users  (cost=0.28..8.30 rows=1 width=4)        |   |             |
| Index Cond: (((name)::text = 'a'::text) AND (tel = 1))                            |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where name = 'a' and nonidx = 'a';                         |   |             |
| QUERY PLAN                                                                        |   |             |
| Bitmap Heap Scan on users  (cost=4.42..70.03 rows=1 width=4)                      |   |             |
| Recheck Cond: ((name)::text = 'a'::text)                                          |   |             |
| Filter: ((nonidx)::text = 'a'::text)                                              |   |             |
| ->  Bitmap Index Scan on idx_users_name  (cost=0.00..4.42 rows=19 width=0)        |   |             |
| Index Cond: ((name)::text = 'a'::text)                                            |   |             |
|                                                                                   |   |             |
| > explain                                                                         |   |             |
| > select id from users where tel = 1;                                             |   |             |
| QUERY PLAN                                                                        |   |             |
| Seq Scan on users  (cost=0.00..588.34 rows=19 width=4)                            |   |             |
| Filter: (tel = 1)                                                                 |   |             |
</pre>
</div>

 <p>
さまざまなスキャン方法があるのを知るのだった。
</p>

 <ul class="org-ul"> <li>Seq Scan</li>
 <li>Bitmap Index Scan</li>
 <li>Bitmap Heap Scan</li>
 <li>Index Only Scan</li>
</ul></div>
</div>
 <div id="outline-container-orgc058a9e" class="outline-2">
 <h2 id="orgc058a9e"> <a href="#orgc058a9e">関連</a></h2>
 <div class="outline-text-2" id="text-orgc058a9e">
 <ul class="org-ul"> <li> <a href="20251206T213844--kdoc-496-index-only-scanの様子を見る__draft_permanent.html#ID-20251206T213844">KDOC 496: Index (Only) Scanの様子を見る</a>。インデックスつながり</li>
</ul></div>
</div>
 <div id="outline-container-org048c84a" class="outline-2">
 <h2 id="org048c84a"> <a href="#org048c84a">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org048c84a">
 <ul class="org-ul"> <li> <a href="./20251208T083954--kdoc-500-covering-indexを試す__draft_permanent.html">KDOC 500: Covering Indexを試す</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251207T091742--kdoc-497-複合インデックスの使用条件を試す__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251207T091742--kdoc-497-複合インデックスの使用条件を試す__draft_permanent.html</id>
  <updated>2025-12-14T04:15:16+09:00</updated>
</entry>
<entry>
  <title>KDOC 487: Cookieは自動で送る</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgca75ff1" class="outline-2">
 <h2 id="orgca75ff1"> <a href="#orgca75ff1">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgca75ff1">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-11-22 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-06 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org09a9bee" class="outline-2">
 <h2 id="org09a9bee"> <a href="#org09a9bee">概要</a></h2>
 <div class="outline-text-2" id="text-org09a9bee">
 <p>
恥ずべきことに、Cookieの流れをよくわかっていなかった。
</p>

 <p>
 <a href="https://developer.mozilla.org/ja/docs/Web/HTTP/Guides/Cookies">HTTP Cookie の使用 - HTTP | MDN</a>。
</p>

 <ol class="org-ol"> <li>ブラウザがHTTPサーバにHTTPリクエストする</li>
 <li>ブラウザがHTTPレスポンスのSetCookieヘッダと値を受け取る</li>
 <li> <b>ブラウザが</b> 値を保存する</li>
 <li>過去Cookie保存したドメインの場合、次のリクエスト時に  <b>ブラウザが</b> CookieヘッダーにCookieを含めて送る</li>
</ol></div>
</div>
 <div id="outline-container-org0dafa7f" class="outline-2">
 <h2 id="org0dafa7f"> <a href="#org0dafa7f">関連</a></h2>
 <div class="outline-text-2" id="text-org0dafa7f">
 <ul class="org-ul"> <li>追加調査: Cookieを観察する</li>
</ul></div>
</div>
 <div id="outline-container-orge8ddc3c" class="outline-2">
 <h2 id="orge8ddc3c"> <a href="#orge8ddc3c">Backlinks</a></h2>
 <div class="outline-text-2" id="text-orge8ddc3c">
 <ul class="org-ul"> <li> <a href="./20251120T225617--kdoc-488-cookieはhttpの仕様に含まれる__permanent.html">KDOC 488: CookieはHTTPの仕様に含まれる</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251120T225113--kdoc-487-cookieは自動で送る__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251120T225113--kdoc-487-cookieは自動で送る__permanent.html</id>
  <updated>2025-12-14T04:15:15+09:00</updated>
</entry>
<entry>
  <title>KDOC 495: 文芸的にDB動作を検証できるようにする</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgd872e04" class="outline-2">
 <h2 id="orgd872e04"> <a href="#orgd872e04">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgd872e04">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org0b4a263" class="outline-2">
 <h2 id="org0b4a263"> <a href="#org0b4a263">概要</a></h2>
 <div class="outline-text-2" id="text-org0b4a263">
 <p>
文芸的にDB動作を検証できるようにした。
</p>
</div>
</div>
 <div id="outline-container-org633987b" class="outline-2">
 <h2 id="org633987b"> <a href="#org633987b">背景</a></h2>
 <div class="outline-text-2" id="text-org633987b">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？</a>を読んで、データベースの機能について知らないことが多いのを知った。
</p>

 <p>
コンピュータのほかの事柄と同様に、じっさいに試して、挙動を仔細にみて背景にあるアイデアを理解し、自分なりのモデルを構築していくのが必要に見えた。REPLでいじるだけでなく、体系立てて記録しつつ試していけるとよさそうである。
</p>

 <p>
そういうことを気軽にできるようにした。
</p>
</div>
</div>
 <div id="outline-container-orga541783" class="outline-2">
 <h2 id="orga541783"> <a href="#orga541783">要件</a></h2>
 <div class="outline-text-2" id="text-orga541783">
 <ul class="org-ul"> <li>少ない準備で気軽にデータベースを実行できる</li>
 <li>文芸的プログラミングができる。入力と標準出力をテキストに残し、そのままドキュメント化できる
 <ul class="org-ul"> <li>入力クエリを出力にエコー表示できる</li>
</ul></li>
 <li>毎回クリーンな環境で、完全に再現できる</li>
 <li>org-mode org-babelの  <code>sql</code> ブロックから直接使える</li>
 <li>完全に同等の機能が使える。インデックス、EXPLAIN、トランザクション…が使える</li>
</ul></div>
</div>
 <div id="outline-container-org1f2fd44" class="outline-2">
 <h2 id="org1f2fd44"> <a href="#org1f2fd44">使用例</a></h2>
 <div class="outline-text-2" id="text-org1f2fd44">
 <p>
リポジトリは <a href="https://github.com/kijimad/pgpg">kijimad/pgpg</a>にある。
</p>

 <p>
根本的なアイデアは、データベースのプロキシを実装し、フック処理を追加することである。プロキシで、実験に必要な処理(DB初期化と削除)を実行する。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>DBとプロキシを起動する</label> <pre class="src src-shell">docker compose up -d
</pre>
</div>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 2: </span>org-modeの見出しやファイルヘッダに接続先情報を書く</label> <pre class="src src-org-mode">:PROPERTIES:
  :header-args+: :results table
  :header-args+: :database postgres
  :header-args+: :dbhost localhost
  :header-args+: :dbport 15432
  :header-args+: :dbuser postgres
  :header-args+: :engine postgresql
:END:
</pre>
</div>

 <p>
あとは、org-babelでSQLを実行して評価する。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">select</span> 1+1  <span class="org-keyword">as</span>  <span class="org-keyword">result</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                         |
|-------------------------|
| > select 1+1 as result; |
| result                  |
| 2                       |
</pre>
</div>

 <p>
データベースは接続のたびにリセットされる。完全に再現可能で、あとで読みやすい。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 3: </span>リセットされるので実行のたびに同じ結果が出る</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255),
    tel  <span class="org-type">integer</span>
);
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>, tel)  <span class="org-keyword">VALUES</span> ( <span class="org-string">'きじま'</span>, 100);
 <span class="org-keyword">SELECT</span> *  <span class="org-keyword">FROM</span> users;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                         |     |
|---------------------------------------------------------+-----|
| > CREATE TABLE users (                                  |     |
| >     name varchar(255),                                |     |
| >     tel integer                                       |     |
| > );                                                    |     |
| CREATE TABLE                                            |     |
|                                                         |     |
| > INSERT INTO users (name, tel) VALUES ('きじま', 100); |     |
| INSERT 0 1                                              |     |
|                                                         |     |
| > SELECT * FROM users;                                  |     |
| name                                                    | tel |
| きじま                                                  | 100 |
</pre>
</div>
</div>
</div>
 <div id="outline-container-orgaee80aa" class="outline-2">
 <h2 id="orgaee80aa"> <a href="#orgaee80aa">関連</a></h2>
 <div class="outline-text-2" id="text-orgaee80aa">
 <ul class="org-ul"> <li>動機:  <a href="20240207T092747--kdoc-77-検証する方法があると理解が進む__essay.html#ID-20240207T092747">KDOC 77: 検証する方法があると理解が進む</a>。に基づいて作った</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251206T184941--kdoc-495-文芸的にdb動作を検証できるようにする__draft_project.html"/>
  <id>https://kijimad.github.io/roam/20251206T184941--kdoc-495-文芸的にdb動作を検証できるようにする__draft_project.html</id>
  <updated>2025-12-14T04:14:37+09:00</updated>
</entry>
<entry>
  <title>KDOC 486: 『ソフトウェアアーキテクチャの基礎』</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org68d4bf8" class="outline-2">
 <h2 id="org68d4bf8"> <a href="#org68d4bf8">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org68d4bf8">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org1f6d6fa" class="outline-2">
 <h2 id="org1f6d6fa"> <a href="#org1f6d6fa">概要</a></h2>
 <div class="outline-text-2" id="text-org1f6d6fa">
 <p>
『ソフトウェアアーキテクチャの基礎』は、アーキテクチャについて解説する本。
</p>
</div>
</div>
 <div id="outline-container-org50e5c44" class="outline-2">
 <h2 id="org50e5c44"> <a href="#org50e5c44">メモ</a></h2>
 <div class="outline-text-2" id="text-org50e5c44">
 <ul class="org-ul"> <li>アーキテクトは技術的な選択を指定するのではなく、ガイドしなければならない(p9)
 <ul class="org-ul"> <li>「Reactを使う」ではなく、「フロントエンドのWeb開発にリアクティブベースのフレームワークを使う」</li>
</ul></li>
 <li>アーキテクチャと設計の違い(p23)</li>
 <li>アーキテクトと開発チームを隔てている仮想的・物理的な壁を超える一方向のコミュニケーションがアーキテクチャに関するあらゆる問題を引き起こしている。アーキテクト側の決定は開発チームにうまく伝わらず、開発チームの決定はアーキテクトへはほとんど戻されない。壁を取り払い双方向の関係を築くには実質1つのチームである必要がある(p24)</li>
 <li>個人のなかにある知識のピラミッド(p26)
 <ul class="org-ul"> <li>わかっていること</li>
 <li>わかってないとわかっていること</li>
 <li>わかっていないとわかっていないこと</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org54ea8c2" class="outline-2">
 <h2 id="org54ea8c2"> <a href="#org54ea8c2">関連</a></h2>
 <div class="outline-text-2" id="text-org54ea8c2">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251118T190900--kdoc-486-『ソフトウェアアーキテクチャの基礎』__draft_book.html"/>
  <id>https://kijimad.github.io/roam/20251118T190900--kdoc-486-『ソフトウェアアーキテクチャの基礎』__draft_book.html</id>
  <updated>2025-12-14T04:14:37+09:00</updated>
</entry>
<entry>
  <title>KDOC 493: 明治神宮ミュージアムを観察する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orge3a462d" class="outline-2">
 <h2 id="orge3a462d"> <a href="#orge3a462d">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orge3a462d">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org1204c25" class="outline-2">
 <h2 id="org1204c25"> <a href="#org1204c25">概要</a></h2>
 <div class="outline-text-2" id="text-org1204c25">
 <p>
明治神宮ミュージアムは、明治神宮を解説する博物館である。
</p>

 <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7815.993728924776!2d139.6995454119855!3d35.67233027247567!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188d3793afecc3%3A0xa43c8d324731658c!2sMeiji%20Jingu%20Museum!5e1!3m2!1sen!2sjp!4v1764547132110!5m2!1sen!2sjp" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
</div>
 <div id="outline-container-org69f48ba" class="outline-2">
 <h2 id="org69f48ba"> <a href="#org69f48ba">メモ</a></h2>
 <div class="outline-text-2" id="text-org69f48ba">
 <ul class="org-ul"> <li>神社の建築時に使用したという大きな木の模型がある。これがガラスなどで覆われていなくて、かつ台の空間に余裕があるので、台に手をついてさまざまな角度から眺めやすい。個人的には、模型は上から見てもよくわからない。同じ目線で見て、その縮尺の空間に自分が立っていることを想像しながら見るとおもしろい</li>
 <li>豪華絢爛な明治天皇ゆかりのグッズが展示されている。本質的に王様であることを認識するのであった</li>
 <li>もともと荒れ地で、人工的な森であることに驚いた</li>
 <li>当時撮られた映像があって、映っているものがすべてが珍しく感じた。たしかに歴史はつながっている</li>
 <li>明治神宮があまりに巨大で森なので全貌がわからなかったのだが、社の全体像を把握すると神聖を感じた</li>
</ul></div>
</div>
 <div id="outline-container-orgcb0b4b5" class="outline-2">
 <h2 id="orgcb0b4b5"> <a href="#orgcb0b4b5">関連</a></h2>
 <div class="outline-text-2" id="text-orgcb0b4b5">
 <p>
なし。
</p>
</div>
</div>
 <div id="outline-container-org6facffe" class="outline-2">
 <h2 id="org6facffe"> <a href="#org6facffe">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org6facffe">
 <ul class="org-ul"> <li> <a href="./20240908T180537--kdoc-238-他人の博物館を観察して参考にする__project.html">KDOC 238: 他人の博物館を観察して参考にする</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251201T085907--kdoc-493-明治神宮ミュージアムを観察する__draft_essay.html"/>
  <id>https://kijimad.github.io/roam/20251201T085907--kdoc-493-明治神宮ミュージアムを観察する__draft_essay.html</id>
  <updated>2025-12-14T04:14:36+09:00</updated>
</entry>
<entry>
  <title>KDOC 494: 日時に関する統計ではタイムゾーンが必要になる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org2da859f" class="outline-2">
 <h2 id="org2da859f"> <a href="#org2da859f">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org2da859f">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgd41a725" class="outline-2">
 <h2 id="orgd41a725"> <a href="#orgd41a725">概要</a></h2>
 <div class="outline-text-2" id="text-orgd41a725">
 <p>
直感的でなかったことのメモ。
</p>

 <p>
たとえば、バックエンドで時間をUTCで保存するシステムがある。DBに保存されている値と、REST APIが返す時間はすべてUTCである。クライアントは各自のタイムゾーンで解釈して表示するような決まりになっている。
</p>

 <p>
点の時刻を返すだけだと単にUTCで返せばいいのだが、日/週/月ごと、などの期間ごとの統計をDBで行うときには期間の境界があるので、クエリにタイムゾーンを考慮した時刻が必要になる。日がいつ始まり終わるどうかは、タイムゾーンで異なる。
</p>
</div>
</div>
 <div id="outline-container-orgd767869" class="outline-2">
 <h2 id="orgd767869"> <a href="#orgd767869">関連</a></h2>
 <div class="outline-text-2" id="text-orgd767869">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251201T172433--kdoc-494-日時に関する統計ではタイムゾーンが必要になる__draft_essay.html"/>
  <id>https://kijimad.github.io/roam/20251201T172433--kdoc-494-日時に関する統計ではタイムゾーンが必要になる__draft_essay.html</id>
  <updated>2025-12-14T04:14:25+09:00</updated>
</entry>
<entry>
  <title>KDOC 492: 小石川植物園を観察する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org67b9e29" class="outline-2">
 <h2 id="org67b9e29"> <a href="#org67b9e29">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org67b9e29">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org9286334" class="outline-2">
 <h2 id="org9286334"> <a href="#org9286334">概要</a></h2>
 <div class="outline-text-2" id="text-org9286334">
 <p>
小石川植物園は、東京都文京区にある植物園である。
</p>

 <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7811.570390628713!2d139.74391341198717!3d35.71747657246128!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188db3e92ec1bb%3A0xb8d81a9078dce5c5!2sKoishikawa%20Botanical%20Garden!5e1!3m2!1sen!2sjp!4v1764719370847!5m2!1sen!2sjp" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
</div>
 <div id="outline-container-org2d271a8" class="outline-2">
 <h2 id="org2d271a8"> <a href="#org2d271a8">メモ</a></h2>
 <div class="outline-text-2" id="text-org2d271a8">
 <ul class="org-ul"> <li>広い。道は多くあって、特に順路などはない</li>
 <li>あまりイントロダクションはない。解説も各所にあるのだが、植物に関する知識がないのであまりピンとこなかった</li>
 <li>博物館として細かい文章を読むというよりは、公園として目で見て楽しんでいる人が多いように見えた。小さい字を読む気もあまり起きなかった。自然豊かなリラックスした雰囲気で、読んだり考えたくなかった。個別の植物を見るというより、森や公園の雰囲気を楽しんだ</li>
 <li>もともと植物を知っている人にとってはまた違った魅力を持つものだろう</li>
</ul></div>
</div>
 <div id="outline-container-orgb765ff5" class="outline-2">
 <h2 id="orgb765ff5"> <a href="#orgb765ff5">関連</a></h2>
 <div class="outline-text-2" id="text-orgb765ff5">
 <p>
なし。
</p>
</div>
</div>
 <div id="outline-container-org0ae1105" class="outline-2">
 <h2 id="org0ae1105"> <a href="#org0ae1105">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org0ae1105">
 <ul class="org-ul"> <li> <a href="./20240908T180537--kdoc-238-他人の博物館を観察して参考にする__project.html">KDOC 238: 他人の博物館を観察して参考にする</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251130T101158--kdoc-492-小石川植物園を観察する__draft_essay.html"/>
  <id>https://kijimad.github.io/roam/20251130T101158--kdoc-492-小石川植物園を観察する__draft_essay.html</id>
  <updated>2025-12-14T04:14:25+09:00</updated>
</entry>
<entry>
  <title>KDOC 489: 『Kubernetesで実践するクラウドネイティブDevOps』</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org48d14a3" class="outline-2">
 <h2 id="org48d14a3"> <a href="#org48d14a3">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org48d14a3">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org84dbb40" class="outline-2">
 <h2 id="org84dbb40"> <a href="#org84dbb40">概要</a></h2>
 <div class="outline-text-2" id="text-org84dbb40">
</div>
</div>
 <div id="outline-container-orgb98bc0c" class="outline-2">
 <h2 id="orgb98bc0c"> <a href="#orgb98bc0c">メモ</a></h2>
 <div class="outline-text-2" id="text-orgb98bc0c">
 <ul class="org-ul"> <li>DepOptsの4つの柱(p5)
 <ul class="org-ul"> <li>文化</li>
 <li>自動化</li>
 <li>測定</li>
 <li>共有</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgedfe039" class="outline-2">
 <h2 id="orgedfe039"> <a href="#orgedfe039">関連</a></h2>
 <div class="outline-text-2" id="text-orgedfe039">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251122T144737--kdoc-489-『kubernetesで実践するクラウドネイティブdevops』__draft_book.html"/>
  <id>https://kijimad.github.io/roam/20251122T144737--kdoc-489-『kubernetesで実践するクラウドネイティブdevops』__draft_book.html</id>
  <updated>2025-12-14T04:14:22+09:00</updated>
</entry>
<entry>
  <title>KDOC 499: 0番ポートは動的割当に利用される</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgd91aedd" class="outline-2">
 <h2 id="orgd91aedd"> <a href="#orgd91aedd">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgd91aedd">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org8f00b49" class="outline-2">
 <h2 id="org8f00b49"> <a href="#org8f00b49">概要</a></h2>
 <div class="outline-text-2" id="text-org8f00b49">
 <p>
0番ポートは動的割当に利用される。
</p>

 <blockquote>
 <p>
0番のポートはエニーポート（any port）と呼ばれ、アプリケーションに対して、動的に別番号の空きポートを割り当てるために用意された特殊なポート番号である。
 <a href="https://ja.wikipedia.org/wiki/TCP%E3%82%84UDP%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%83%9D%E3%83%BC%E3%83%88%E7%95%AA%E5%8F%B7%E3%81%AE%E4%B8%80%E8%A6%A7">TCPやUDPにおけるポート番号の一覧 - Wikipedia</a>
</p>
</blockquote>
</div>
</div>
 <div id="outline-container-org67357e0" class="outline-2">
 <h2 id="org67357e0"> <a href="#org67357e0">関連</a></h2>
 <div class="outline-text-2" id="text-org67357e0">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251207T203931--kdoc-499-0番ポートは動的割当に利用される__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251207T203931--kdoc-499-0番ポートは動的割当に利用される__draft_permanent.html</id>
  <updated>2025-12-14T04:14:19+09:00</updated>
</entry>
<entry>
  <title>KDOC 490: 301と302/307のキャッシュ動作の違い</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgecc9852" class="outline-2">
 <h2 id="orgecc9852"> <a href="#orgecc9852">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgecc9852">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-06 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgc7e5321" class="outline-2">
 <h2 id="orgc7e5321"> <a href="#orgc7e5321">概要</a></h2>
 <div class="outline-text-2" id="text-orgc7e5321">
 <p>
HTTPステータスコードの301と302/307は、どれもリダイレクトということで似ているのだが、ブラウザでキャッシュの扱いに違いがある。
</p>

 <p>
301は恒久的リダイレクトで、キャッシュできる、とHTTPの仕様で言及されている。
</p>

 <blockquote>
 <p>
A 301 response is heuristically cacheable; i.e., unless otherwise indicated by the method definition or explicit cache controls (see Section 4.2.2 of [CACHING]).
 <a href="https://www.rfc-editor.org/rfc/rfc9110#status.301">RFC 9110: HTTP Semantics</a>
</p>
</blockquote>

 <p>
302/307は一時的リダイレクトなので、キャッシュについては言及していないように見える。じっさいの動作から考えて、毎回リダイレクト判断するのだろう。
</p>
</div>
</div>
 <div id="outline-container-orgad8d53a" class="outline-2">
 <h2 id="orgad8d53a"> <a href="#orgad8d53a">関連</a></h2>
 <div class="outline-text-2" id="text-orgad8d53a">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251128T092223--kdoc-490-301と302307のキャッシュ動作の違い__draft_wiki.html"/>
  <id>https://kijimad.github.io/roam/20251128T092223--kdoc-490-301と302307のキャッシュ動作の違い__draft_wiki.html</id>
  <updated>2025-12-14T04:14:18+09:00</updated>
</entry>
<entry>
  <title>KDOC 485: asepriteでパッキングする</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orge0ee010" class="outline-2">
 <h2 id="orge0ee010"> <a href="#orge0ee010">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orge0ee010">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-11-10 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-11-10 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org382e6cb" class="outline-2">
 <h2 id="org382e6cb"> <a href="#org382e6cb">概要</a></h2>
 <div class="outline-text-2" id="text-org382e6cb">
 <p>
2Dゲームでは小さな大量の画像を使う。それらを効率的に扱うためにはスプライトの管理が重要である。1ファイルに結合することで、ファイル読み込みを減らして高速化できる。
</p>

 <p>
asepriteはゲーム用のピクセル画像やアニメーションを描くツールであるが、コマンドラインツールとしても使える。ディレクトリ内の画像をまとめて1つの画像にし、それらの対応関係をまとめたJSONを作ってくれるので、コードから読み込みやすくなる。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>tils以下のpngファイルをパッキングする。統合された1枚の画像ファイルとJSONができる</label> <pre class="src src-shell">aseprite  <span class="org-sh-escaped-newline">\</span>
    --batch ./tiles/*.png  <span class="org-sh-escaped-newline">\</span>
    --sheet ./dist/tiles.png  <span class="org-sh-escaped-newline">\</span>
    --data ./dist/tiles.json  <span class="org-sh-escaped-newline">\</span>
    --sheet-type packed  <span class="org-sh-escaped-newline">\</span>
    --format json-array  <span class="org-sh-escaped-newline">\</span>
    --filename-format  <span class="org-string">"{title}"</span>
</pre>
</div>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 2: </span>生成JSON例。ファイル名とピクセルの対応関係が出力されている</label> <pre class="src src-json">{
  "frames": [
    {
      "filename": "tree",
      "frame": {
        "x": 32,
        "y": 64,
        "w": 32,
        "h": 32
      },
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {
        "x": 0,
        "y": 0,
        "w": 32,
        "h": 32
      },
      "sourceSize": {
        "w": 32,
        "h": 32
      },
      "duration": 100
    },
    {
      "filename": "doctor",
      "frame": {
        "x": 32,
        "y": 128,
        "w": 32,
        "h": 32
      },
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {
        "x": 0,
        "y": 0,
        "w": 32,
        "h": 32
      },
      "sourceSize": {
        "w": 32,
        "h": 32
      },
      "duration": 100
    }
  ]
}
</pre>
</div>
</div>
</div>
 <div id="outline-container-org1f2c427" class="outline-2">
 <h2 id="org1f2c427"> <a href="#org1f2c427">関連</a></h2>
 <div class="outline-text-2" id="text-org1f2c427">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251106T193702--kdoc-485-asepriteでパッキングする__wiki.html"/>
  <id>https://kijimad.github.io/roam/20251106T193702--kdoc-485-asepriteでパッキングする__wiki.html</id>
  <updated>2025-12-14T04:14:15+09:00</updated>
</entry>
<entry>
  <title>KDOC 484: 『プログラミングコンテスト攻略のためのアルゴリズムとデータ構造』</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orga617249" class="outline-2">
 <h2 id="orga617249"> <a href="#orga617249">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orga617249">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgc2e8423" class="outline-2">
 <h2 id="orgc2e8423"> <a href="#orgc2e8423">概要</a></h2>
 <div class="outline-text-2" id="text-orgc2e8423">
 <p>
『プログラミングコンテスト攻略のためのアルゴリズムとデータ構造』は、コンテストを題材にして基礎的なアルゴリズムを解説する本。
</p>
</div>
</div>
 <div id="outline-container-orgd3b48d5" class="outline-2">
 <h2 id="orgd3b48d5"> <a href="#orgd3b48d5">メモ</a></h2>
 <div class="outline-text-2" id="text-orgd3b48d5">
 <ul class="org-ul"> <li>アルゴリズムの効率は主に2つの計算量で評価される。このトレードオフを考えてアルゴリズムを設計する。時間計算量のほうが問題になることが多い(p43)
 <ul class="org-ul"> <li>時間計算量</li>
 <li>領域計算量</li>
</ul></li>
 <li>重要なことは、プログラムを実装する前に、入力の上限からアルゴリズムの最悪の計算量を評価すること(p45)</li>
 <li>ソートアルゴリズムの選択の基準(p53)
 <ul class="org-ul"> <li>計算量と安定性</li>
 <li>データの列を保持する以外のメモリ</li>
 <li>入力データの特徴が計算量に影響しないか</li>
</ul></li>
 <li>選択ソートは離れた要素を交換するので安定なソートではない(p68)</li>
 <li>キューの実装方法の1つとして、headとtailのポインタを記録しておく方法がある。キューを処理するたびに先頭要素がずれていき、そのままではメモリを無駄にする。かといってheadを常に0に保つようにデータ全体移動させると、そのたびに要素長ぶんの計算が必要になる。ので、リングバッファにする方法がある(p90)</li>
</ul></div>
</div>
 <div id="outline-container-org35e658b" class="outline-2">
 <h2 id="org35e658b"> <a href="#org35e658b">関連</a></h2>
 <div class="outline-text-2" id="text-org35e658b">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251106T083403--kdoc-484-『プログラミングコンテスト攻略のためのアルゴリズムとデータ構造』__draft_book.html"/>
  <id>https://kijimad.github.io/roam/20251106T083403--kdoc-484-『プログラミングコンテスト攻略のためのアルゴリズムとデータ構造』__draft_book.html</id>
  <updated>2025-12-14T04:14:13+09:00</updated>
</entry>
<entry>
  <title>KDOC 496: Index (Only) Scanの様子を見る</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orge94bc99" class="outline-2">
 <h2 id="orge94bc99"> <a href="#orge94bc99">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orge94bc99">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org32ec12d" class="outline-2">
 <h2 id="org32ec12d"> <a href="#org32ec12d">概要</a></h2>
 <div class="outline-text-2" id="text-org32ec12d">
 <p>
indexが使われる様子を確かめる。
</p>

 <p>
まず、indexを使わないパターン。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>indexがないフィールドを条件にするのでindexは使われない</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255),
    num  <span class="org-type">integer</span>
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">indexを使わない
</span>explain
 <span class="org-keyword">select</span>  <span class="org-keyword">name</span>  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span> num = 1;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                        |
|--------------------------------------------------------|
| > CREATE TABLE users (                                 |
| >     name varchar(255),                               |
| >     num integer                                      |
| > );                                                   |
| CREATE TABLE                                           |
|                                                        |
| > CREATE INDEX idx_users_name ON users(name);          |
| CREATE INDEX                                           |
|                                                        |
| > explain                                              |
| > select name from users where num = 1;                |
| QUERY PLAN                                             |
| Seq Scan on users  (cost=0.00..11.75 rows=1 width=516) |
| Filter: (num = 1)                                      |
</pre>
</div>

 <p>
つぎに、index scan するパターン。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 2: </span>検索にインデックスidx_users_nameを使うが、結果として返すidは含まれていないのでヒープアクセスが発生し、index Only Scanにはならない</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    id serial  <span class="org-keyword">PRIMARY</span>  <span class="org-keyword">KEY</span>,
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

explain
 <span class="org-keyword">select</span> id  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                            |
|----------------------------------------------------------------------------|
| > CREATE TABLE users (                                                     |
| >     id serial PRIMARY KEY,                                               |
| >     name varchar(255)                                                    |
| > );                                                                       |
| CREATE TABLE                                                               |
|                                                                            |
| > CREATE INDEX idx_users_name ON users(name);                              |
| CREATE INDEX                                                               |
|                                                                            |
| > explain                                                                  |
| > select id from users where name = 'a';                                   |
| QUERY PLAN                                                                 |
| Index Scan using idx_users_name on users  (cost=0.14..8.16 rows=1 width=4) |
| Index Cond: ((name)::text = 'a'::text)                                     |
</pre>
</div>

 <p>
index only scan するパターン。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 3: </span>Index Only Scanする。検索にインデックスidx_users_nameを使い、結果もnameだけなので、indexだけで完結する。</label> <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255),
    num  <span class="org-type">integer</span>
);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">indexを使う
</span>explain
 <span class="org-keyword">select</span>  <span class="org-keyword">name</span>  <span class="org-keyword">from</span> users  <span class="org-keyword">where</span>  <span class="org-keyword">name</span> =  <span class="org-string">'a'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                   |
|-----------------------------------------------------------------------------------|
| > CREATE TABLE users (                                                            |
| >     name varchar(255),                                                          |
| >     num integer                                                                 |
| > );                                                                              |
| CREATE TABLE                                                                      |
|                                                                                   |
| > CREATE INDEX idx_users_name ON users(name);                                     |
| CREATE INDEX                                                                      |
|                                                                                   |
| > explain                                                                         |
| > select name from users where name = 'a';                                        |
| QUERY PLAN                                                                        |
| Index Only Scan using idx_users_name on users  (cost=0.14..8.16 rows=1 width=516) |
| Index Cond: (name = 'a'::text)                                                    |
</pre>
</div>
</div>
</div>
 <div id="outline-container-org2a619fd" class="outline-2">
 <h2 id="org2a619fd"> <a href="#org2a619fd">関連</a></h2>
 <div class="outline-text-2" id="text-org2a619fd">
 <p>
なし。
</p>
</div>
</div>
 <div id="outline-container-org2452bc4" class="outline-2">
 <h2 id="org2452bc4"> <a href="#org2452bc4">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org2452bc4">
 <ul class="org-ul"> <li> <a href="./20251207T091742--kdoc-497-複合インデックスの使用条件を試す__draft_permanent.html">KDOC 497: 複合インデックスの使用条件を試す</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251206T213844--kdoc-496-index-only-scanの様子を見る__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251206T213844--kdoc-496-index-only-scanの様子を見る__draft_permanent.html</id>
  <updated>2025-12-14T04:14:11+09:00</updated>
</entry>
</feed>
