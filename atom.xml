<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><author><name>Kijima Daigo</name></author>
<title>Insomnia</title>
<generator>Emacs webfeeder.el</generator>
<link href="https://kijimad.github.io/roam"/>
<link href="https://kijimad.github.io/roam/atom.xml" rel="self"/>
<id>https://kijimad.github.io/roam/atom.xml</id>
<updated>2025-12-24T21:48:57+09:00</updated>
<entry>
  <title>KDOC 507: DNSのルートサーバが13個なのはDNSのUDPのパケット上限が512バイトであるから</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgb8f0c89" class="outline-2">
 <h2 id="orgb8f0c89"> <a href="#orgb8f0c89">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgb8f0c89">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org69a586a" class="outline-2">
 <h2 id="org69a586a"> <a href="#org69a586a">概要</a></h2>
 <div class="outline-text-2" id="text-org69a586a">
 <p>
DNSのルートサーバは13個しかない。これはDNSにおけるUDPのパケット長の上限が512バイトであることからくる制約である(p57)。
</p>

 <p>
DNSルートサーバを得るリクエストがどのようなものかを見てみる。これが512バイトを超えないように数の制限があるのだろうか。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>ルートサーバを見てみる</label> <pre class="src src-shell">dig . NS
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">
; <<>> DiG 9.18.30-0ubuntu0.24.04.1-Ubuntu <<>> . NS
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 61072
;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;.				IN	NS

;; ANSWER SECTION:
.			7007	IN	NS	i.root-servers.net.
.			7007	IN	NS	g.root-servers.net.
.			7007	IN	NS	j.root-servers.net.
.			7007	IN	NS	b.root-servers.net.
.			7007	IN	NS	h.root-servers.net.
.			7007	IN	NS	a.root-servers.net.
.			7007	IN	NS	k.root-servers.net.
.			7007	IN	NS	d.root-servers.net.
.			7007	IN	NS	m.root-servers.net.
.			7007	IN	NS	c.root-servers.net.
.			7007	IN	NS	f.root-servers.net.
.			7007	IN	NS	l.root-servers.net.
.			7007	IN	NS	e.root-servers.net.

;; Query time: 0 msec
;; SERVER: 127.0.0.53#53(127.0.0.53) (UDP)
;; WHEN: Sun Dec 21 19:11:45 JST 2025
;; MSG SIZE  rcvd: 239

</pre>
</div>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 2: </span>.jpのネームサーバを見る</label> <pre class="src src-shell">dig jp. NS
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">
; <<>> DiG 9.18.30-0ubuntu0.24.04.1-Ubuntu <<>> jp. NS
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 57427
;; flags: qr rd ra; QUERY: 1, ANSWER: 8, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;jp.				IN	NS

;; ANSWER SECTION:
jp.			6621	IN	NS	d.dns.jp.
jp.			6621	IN	NS	g.dns.jp.
jp.			6621	IN	NS	h.dns.jp.
jp.			6621	IN	NS	c.dns.jp.
jp.			6621	IN	NS	e.dns.jp.
jp.			6621	IN	NS	b.dns.jp.
jp.			6621	IN	NS	a.dns.jp.
jp.			6621	IN	NS	f.dns.jp.

;; Query time: 0 msec
;; SERVER: 127.0.0.53#53(127.0.0.53) (UDP)
;; WHEN: Sun Dec 21 19:16:20 JST 2025
;; MSG SIZE  rcvd: 163

</pre>
</div>
</div>
</div>
 <div id="outline-container-orge0c0062" class="outline-2">
 <h2 id="orge0c0062"> <a href="#orge0c0062">関連</a></h2>
 <div class="outline-text-2" id="text-orge0c0062">
 <ul class="org-ul"> <li>参照:  <a href="20241102T084716--kdoc-258-『ピアリング戦記』__book.html#ID-20241102T084716">KDOC 258: 『ピアリング戦記』</a>から</li>
 <li>追加調査: なぜ13個になるのか詳細を調べる</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251217T184407--kdoc-507-dnsのルートサーバが13個なのはdnsのudpのパケット上限が512バイトであるから__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251217T184407--kdoc-507-dnsのルートサーバが13個なのはdnsのudpのパケット上限が512バイトであるから__draft_permanent.html</id>
  <updated>2025-12-25T06:48:50+09:00</updated>
</entry>
<entry>
  <title>KDOC 513: フレッツの利用者は10.0.0.0/8をローカルネットワーク内で使用できない</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org22338f1" class="outline-2">
 <h2 id="org22338f1"> <a href="#org22338f1">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org22338f1">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org9b2d155" class="outline-2">
 <h2 id="org9b2d155"> <a href="#org9b2d155">概要</a></h2>
 <div class="outline-text-2" id="text-org9b2d155">
 <p>
NTTのフレッツ網は内部ネットワークでプライベートアドレス 10.0.0.0/8 を使用しているため、利用者はローカルネットワーク内で 10.0.0.0/8 を使用できない。
</p>

 <p>
プライベートIP範囲のなかでも、もっともホスト部が大きな範囲を使用している。
</p>

 <ul class="org-ul"> <li>10.0.0.0/8 (クラスA)</li>
 <li>172.16.0.0/12 (クラスB)</li>
 <li>192.168.0.0/16 (クラスC)</li>
</ul></div>
</div>
 <div id="outline-container-orga2d012c" class="outline-2">
 <h2 id="orga2d012c"> <a href="#orga2d012c">関連</a></h2>
 <div class="outline-text-2" id="text-orga2d012c">
 <ul class="org-ul"> <li>参照:  <a href="https://ja.wikipedia.org/wiki/IP%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9#ISP_Shared_Address">IPアドレス - Wikipedia</a>から</li>
 <li>疑問: なぜそうなったのか。標準仕様的に問題ないのか</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251220T210824--kdoc-513-フレッツの利用者は100008をローカルネットワーク内で使用できない__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251220T210824--kdoc-513-フレッツの利用者は100008をローカルネットワーク内で使用できない__draft_permanent.html</id>
  <updated>2025-12-25T06:48:47+09:00</updated>
</entry>
<entry>
  <title>KDOC 505: 既存メモ側からどういった関連ができそうか考える</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org6a205e0" class="outline-2">
 <h2 id="org6a205e0"> <a href="#org6a205e0">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org6a205e0">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org0f913fe" class="outline-2">
 <h2 id="org0f913fe"> <a href="#org0f913fe">概要</a></h2>
 <div class="outline-text-2" id="text-org0f913fe">
 <p>
ツェッテルカステンライクな方法でメモしている。
</p>

 <p>
メモの関連が少なく、理解や思考を深められていないのを課題に感じてきた。単純に同じカテゴリの話題だから、という理由で関連させていることが多かったが、意味ないよな、と感じてきた。
</p>

 <p>
既存メモ側にどういった関連ができそうかの想定を書いておくと関連させやすいことに気づいた。また、それだけだと忘れやすいので先に想定する関連に対して類型をつけて抽象化しておくと、組み合わせて考えやすいのに気づいた。
</p>

 <pre class="example" id="org79108dd">
KDOC 37: トップダウンかボトムアップ、どちらで成し遂げるか?
- 具体例: トップダウンの主張も出す

KDOC 71: KDOCエントリの書き方を考える
- 補足: 結局テンプレートファイルに含めた項目以外は忘れ去っていた。仕組みにしなければならない

KDOC 3: 『ない仕事の作り方』
- 組み合わせ: 彼のスクラップ癖と知識獲得モデルは、メモのとりかたで説明できるのではないか
</pre>

 <p>
そしてあとは、これらを見返して、この関連となるメモを追加していくわけである。
</p>

 <p>
いままでは膨大な既存メモと、ランダムに書いた新規メモがあって、その関連を考えていた。結果、深まらないメモができていた。事前に関連を考えておく方式だと、既存メモから考えた関連をもとにメモを作る。最初から関連ありきでメモを作成するので、深まっていくだろう。
</p>
</div>
</div>
 <div id="outline-container-org2386a0d" class="outline-2">
 <h2 id="org2386a0d"> <a href="#org2386a0d">関連</a></h2>
 <div class="outline-text-2" id="text-org2386a0d">
 <ul class="org-ul"> <li>動機:  <a href="20240502T172812--kdoc-153-すでにあるメモから、関連させられないか考える__essay.html#ID-20240502T172812">KDOC 153: すでにあるメモから、関連させられないか考える</a>。「時間を作る」だけでは改善しなかったので、対策を具体化した</li>
 <li>補足:  <a href="20231008T203658--kdoc-36-『take-notes』__book.html#ID-20231008T203658">KDOC 36: 『TAKE NOTES!』</a>。ツェッテルカステンで参考にしている本</li>
</ul></div>
</div>
 <div id="outline-container-org3d1f503" class="outline-2">
 <h2 id="org3d1f503"> <a href="#org3d1f503">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org3d1f503">
 <ul class="org-ul"> <li> <a href="./20240504T224810--kdoc-165-メモの課題と対応策を考える__structure.html">KDOC 165: メモの課題と対応策を考える</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251214T123530--kdoc-505-既存メモ側からどういった関連ができそうか考える__essay.html"/>
  <id>https://kijimad.github.io/roam/20251214T123530--kdoc-505-既存メモ側からどういった関連ができそうか考える__essay.html</id>
  <updated>2025-12-25T06:48:45+09:00</updated>
</entry>
<entry>
  <title>KDOC 504: 家電売り場で栄枯盛衰を感じる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org2a47657" class="outline-2">
 <h2 id="org2a47657"> <a href="#org2a47657">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org2a47657">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-20 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgdb2aedb" class="outline-2">
 <h2 id="orgdb2aedb"> <a href="#orgdb2aedb">概要</a></h2>
 <div class="outline-text-2" id="text-orgdb2aedb">
 <p>
日曜の午後、池袋駅付近にある複数の大型家電店をぶらついた。あてもなく1フロアずつ練り歩いたところ、気づいたことがあった。
</p>

 <ul class="org-ul"> <li>どの店も1階にスマートフォン売り場があり、人で混雑している</li>
 <li>PC周辺機器などのIT・小型家電で1フロアになっていることが多い。テレビ、冷蔵庫、洗濯機などの大型家電で1フロアになっていることが多い</li>
 <li>テレビは広大な売り場面積を占めるが、閑散としていた。大量のテレビの音響が混ざり合ってガヤガヤした音だけが響いていた。数組の若いカップルと店員がテーブルに座って契約を進めているように見えた。明らかに大型家電にはシーズン性があるが、それを差し引いても人がいないのに驚いた。疲れて休憩がてら見る人さえいなかった。テレビは家電量販店の花形コーナーだと考えていた</li>
 <li>PC周辺機器コーナーは1フロアを占めていて、老若男女多くの人がいた</li>
 <li>カメラコーナーは広く充実しているが、あまり人はいない</li>
</ul> <p>
ひとくちに家電量販店といっても、内部では客数に大きな違いがあり、自分の持っている直感とは異なるのを体感した <sup> <a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>。自分が何を作りたいかと、それを時代が必要としているかは別の話だ。
</p>
</div>
</div>
 <div id="outline-container-org209f079" class="outline-2">
 <h2 id="org209f079"> <a href="#org209f079">関連</a></h2>
 <div class="outline-text-2" id="text-org209f079">
 <ul class="org-ul"> <li>追加調査: 具体的に額ベースや売り場面積でジャンルごとの推移を調べる方法はあるか</li>
</ul></div>
</div>
 <div id="footnotes">
 <h2 class="footnotes">Footnotes: </h2>
 <div id="text-footnotes">

 <div class="footdef"> <sup> <a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"> <p class="footpara">
もちろん利益率が違うので、人があまり多くないように見えても利益率は高い、ということもありそうである。
</p></div></div>


</div>
</div></div>]]></content>
  <link href="https://kijimad.github.io/roam/20251213T193458--kdoc-504-家電売り場で栄枯盛衰を感じる__essay.html"/>
  <id>https://kijimad.github.io/roam/20251213T193458--kdoc-504-家電売り場で栄枯盛衰を感じる__essay.html</id>
  <updated>2025-12-25T06:48:40+09:00</updated>
</entry>
<entry>
  <title>KDOC 517: DNS階層をたどる様子を見る</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org7629e6b" class="outline-2">
 <h2 id="org7629e6b"> <a href="#org7629e6b">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org7629e6b">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org9b17e08" class="outline-2">
 <h2 id="org9b17e08"> <a href="#org9b17e08">概要</a></h2>
 <div class="outline-text-2" id="text-org9b17e08">
 <div class="org-src-container">
 <pre class="src src-shell">dig +trace www.github.com
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">
; <<>> DiG 9.18.30-0ubuntu0.24.04.1-Ubuntu <<>> +trace www.github.com
;; global options: +cmd
.			6976	IN	NS	a.root-servers.net.
.			6976	IN	NS	l.root-servers.net.
.			6976	IN	NS	e.root-servers.net.
.			6976	IN	NS	m.root-servers.net.
.			6976	IN	NS	h.root-servers.net.
.			6976	IN	NS	i.root-servers.net.
.			6976	IN	NS	d.root-servers.net.
.			6976	IN	NS	k.root-servers.net.
.			6976	IN	NS	g.root-servers.net.
.			6976	IN	NS	b.root-servers.net.
.			6976	IN	NS	c.root-servers.net.
.			6976	IN	NS	f.root-servers.net.
.			6976	IN	NS	j.root-servers.net.
;; Received 239 bytes from 127.0.0.53#53(127.0.0.53) in 0 ms

;; UDP setup with 2001:dc3::35#53(2001:dc3::35) for www.github.com failed: network unreachable.
;; no servers could be reached
;; UDP setup with 2001:dc3::35#53(2001:dc3::35) for www.github.com failed: network unreachable.
;; no servers could be reached
;; UDP setup with 2001:dc3::35#53(2001:dc3::35) for www.github.com failed: network unreachable.
;; UDP setup with 2001:503:c27::2:30#53(2001:503:c27::2:30) for www.github.com failed: network unreachable.
com.			172800	IN	NS	l.gtld-servers.net.
com.			172800	IN	NS	c.gtld-servers.net.
com.			172800	IN	NS	k.gtld-servers.net.
com.			172800	IN	NS	m.gtld-servers.net.
com.			172800	IN	NS	i.gtld-servers.net.
com.			172800	IN	NS	b.gtld-servers.net.
com.			172800	IN	NS	h.gtld-servers.net.
com.			172800	IN	NS	e.gtld-servers.net.
com.			172800	IN	NS	d.gtld-servers.net.
com.			172800	IN	NS	f.gtld-servers.net.
com.			172800	IN	NS	a.gtld-servers.net.
com.			172800	IN	NS	g.gtld-servers.net.
com.			172800	IN	NS	j.gtld-servers.net.
com.			86400	IN	DS	19718 13 2 8ACBB0CD28F41250A80A491389424D341522D946B0DA0C0291F2D3D7 71D7805A
com.			86400	IN	RRSIG	DS 8 1 86400 20260103170000 20251221160000 61809 . LyStNQm9+1ankIVATIyU/cW7QtLvLE7NfHzzVnKqTLu6ko4/slJmY1QU bmhcRd6Z3e+u1k04++RixtKc/5N7MQ5olnze3pZ9y9VX0AdyGqnLSINP Ui3hZr5NIu3mTgjTt2PttfIEe1V0qrgaC903fIaNSdL2nISm49u5zoG6 LJ4l7rrDVt2pNvR+KiZtbSWp7ULt4jJLvQWjsvpfADnq2UqgOSVqNIvk kDQ8fXYFoNXETBHkdZ1NEQbIl/e4cj2vk0I4q5eeJReuKKamWjIxY6Zb GLnvjDVh2mAjVQcbkjde5r7oxrcJiK8z3Tx6Yd0QFns0g92/0JMukcZY r7em8g==
;; Received 1205 bytes from 192.33.4.12#53(c.root-servers.net) in 2 ms

;; UDP setup with 2001:502:7094::30#53(2001:502:7094::30) for www.github.com failed: network unreachable.
;; UDP setup with 2001:503:a83e::2:30#53(2001:503:a83e::2:30) for www.github.com failed: network unreachable.
github.com.		172800	IN	NS	ns-520.awsdns-01.net.
github.com.		172800	IN	NS	ns-421.awsdns-52.com.
github.com.		172800	IN	NS	ns-1707.awsdns-21.co.uk.
github.com.		172800	IN	NS	ns-1283.awsdns-32.org.
github.com.		172800	IN	NS	dns1.p08.nsone.net.
github.com.		172800	IN	NS	dns2.p08.nsone.net.
github.com.		172800	IN	NS	dns3.p08.nsone.net.
github.com.		172800	IN	NS	dns4.p08.nsone.net.
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 900 IN NSEC3 1 1 0 - CK0Q3UDG8CEKKAE7RUKPGCT1DVSSH8LL NS SOA RRSIG DNSKEY NSEC3PARAM
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 900 IN RRSIG NSEC3 13 2 900 20251225002706 20251217231706 46539 com. gmHVJS+WmLxYXTQMDYmfFRMcTSDHtHHXgSTWPo3FbOjYVV6GmpBv4Rd3 q91lGtsv8vkur4/nrD7LolMHJ4gpqw==
4KB4M5P0V10KIBJ8HQ2VH9EMME8NV6MR.com. 900 IN NSEC3 1 1 0 - 4KB4V9IAMJL29MC1VBJ8NDO7E6SI2B8O NS DS RRSIG
4KB4M5P0V10KIBJ8HQ2VH9EMME8NV6MR.com. 900 IN RRSIG NSEC3 13 2 900 20251225021105 20251218010105 46539 com. 8mEzmw5hy48Fr2ps/fSxqKgLwBWLyLUV3RwXyj9cQshaoXLOhqhpIawj /fvfrbiMADGGEIjO7zwfrk338jhexg==
;; Received 639 bytes from 192.43.172.30#53(i.gtld-servers.net) in 112 ms

;; UDP setup with 2620:4d:4000:6259:7:8:0:3#53(2620:4d:4000:6259:7:8:0:3) for www.github.com failed: network unreachable.
www.github.com.		3600	IN	CNAME	github.com.
github.com.		60	IN	A	20.27.177.113
;; Received 73 bytes from 198.51.44.72#53(dns3.p08.nsone.net) in 113 ms

</pre>
</div>
</div>
</div>
 <div id="outline-container-org55c1956" class="outline-2">
 <h2 id="org55c1956"> <a href="#org55c1956">関連</a></h2>
 <div class="outline-text-2" id="text-org55c1956">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251222T090340--kdoc-517-dns階層をたどる様子を見る__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251222T090340--kdoc-517-dns階層をたどる様子を見る__draft_permanent.html</id>
  <updated>2025-12-25T06:48:37+09:00</updated>
</entry>
<entry>
  <title>KDOC 509: DNSフィルタリングされている様子を見る</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org774681f" class="outline-2">
 <h2 id="org774681f"> <a href="#org774681f">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org774681f">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-20 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-20 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org8008080" class="outline-2">
 <h2 id="org8008080"> <a href="#org8008080">概要</a></h2>
 <div class="outline-text-2" id="text-org8008080">
 <p>
AdGuardで、DNSフィルタリングされている様子を見る。
</p>

 <p>
最初に通常のDNSレスポンスを確認する。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>通常のレスポンス</label> <pre class="src src-shell">dig google.com
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">
; <<>> DiG 9.18.30-0ubuntu0.24.04.1-Ubuntu <<>> google.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 20568
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;google.com.			IN	A

;; ANSWER SECTION:
google.com.		272	IN	A	172.217.174.110 👈

;; Query time: 0 msec
;; SERVER: 127.0.0.53#53(127.0.0.53) (UDP)
;; WHEN: Fri Dec 19 23:15:30 JST 2025
;; MSG SIZE  rcvd: 55

</pre>
</div>

 <p>
次に、フィルタリングされているドメインへのDNSレスポンスを確認する。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 2: </span>フィルタリング設定しているドメイン。0.0.0.0に書き換えられている</label> <pre class="src src-shell">dig x.com
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">
; <<>> DiG 9.18.30-0ubuntu0.24.04.1-Ubuntu <<>> x.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 7283
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;x.com.				IN	A

;; ANSWER SECTION:
x.com.			10	IN	A	0.0.0.0 👈

;; Query time: 112 msec
;; SERVER: 127.0.0.53#53(127.0.0.53) (UDP)
;; WHEN: Fri Dec 19 08:58:38 JST 2025
;; MSG SIZE  rcvd: 50

</pre>
</div>
</div>
</div>
 <div id="outline-container-org367ec8d" class="outline-2">
 <h2 id="org367ec8d"> <a href="#org367ec8d">関連</a></h2>
 <div class="outline-text-2" id="text-org367ec8d">
 <ul class="org-ul"> <li>補足:  <a href="20241118T203644--kdoc-295-lanでdnsフィルタリングする流れを見る__permanent.html#ID-20241118T203644">KDOC 295: LANでDNSフィルタリングする流れを見る</a>。を補足する</li>
 <li>追加調査: AdGuardでAレコードを上書きしている箇所を調べる</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251219T085723--kdoc-509-dnsフィルタリングされている様子を見る__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251219T085723--kdoc-509-dnsフィルタリングされている様子を見る__permanent.html</id>
  <updated>2025-12-25T06:47:55+09:00</updated>
</entry>
<entry>
  <title>KDOC 502: jsonとjsonbの性能を比較する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org647c3be" class="outline-2">
 <h2 id="org647c3be"> <a href="#org647c3be">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org647c3be">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-20 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org4bc99ea" class="outline-2">
 <h2 id="org4bc99ea"> <a href="#org4bc99ea">概要</a></h2>
 <div class="outline-text-2" id="text-org4bc99ea">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？ — Just use Postgres 読書感想文</a>でjsonとjsonbについて説明していた。じっさいに使ってみて読み書き性能を試してみる。
</p>

 <p>
ドキュメントのJSONデータ型の説明を見る。
</p>

 <blockquote>
 <p>
jsonデータ型は入力テキストの正確なコピーで格納し、処理関数を実行するたびに再解析する必要があります。jsonbデータ型では、分解されたバイナリ形式で格納されます。
格納するときには変換のオーバーヘッドのため少し遅くなりますが、処理するときには、全く再解析が必要とされないので大幅に高速化されます。 また jsonb型の重要な利点はインデックスをサポートしていることです。
 <a href="https://www.postgresql.jp/docs/9.6/datatype-json.html">8.14. JSONデータ型</a>
</p>
</blockquote>

 <blockquote>
 <p>
格納するときには変換のオーバーヘッドのため少し遅くなりますが、処理するときには、全く再解析が必要とされないので大幅に高速化されます。
 <a href="https://www.postgresql.jp/docs/9.6/datatype-json.html">8.14. JSONデータ型</a>
</p>
</blockquote>

 <p>
試す。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users1</span> (
    test JSON
);
 <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users2</span> (
    test JSONB
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">検証データ挿入 ================
</span>EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users1 (test)
 <span class="org-keyword">SELECT</span> jsonb_build_object(
     <span class="org-string">'a'</span>, md5(random()::text)::text,
     <span class="org-string">'b'</span>, md5(random()::text)::text
)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users2 (test)
 <span class="org-keyword">SELECT</span> jsonb_build_object(
     <span class="org-string">'a'</span>, md5(random()::text)::text,
     <span class="org-string">'b'</span>, md5(random()::text)::text
)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">確認
</span> <span class="org-keyword">select</span> test  <span class="org-keyword">from</span> users1  <span class="org-keyword">limit</span> 3;
 <span class="org-keyword">select</span> test  <span class="org-keyword">from</span> users2  <span class="org-keyword">limit</span> 3;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">JSON/JSONBフィールドの特定キーを取得 ================
</span>EXPLAIN ANALYZE
 <span class="org-keyword">SELECT</span> test->> <span class="org-string">'a'</span>  <span class="org-keyword">FROM</span> users1;

EXPLAIN ANALYZE
 <span class="org-keyword">SELECT</span> test->> <span class="org-string">'a'</span>  <span class="org-keyword">FROM</span> users2;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------------------------|
| > CREATE TABLE users1 (                                                                                                               |
| >     test JSON                                                                                                                       |
| > );                                                                                                                                  |
| CREATE TABLE                                                                                                                          |
|                                                                                                                                       |
| > CREATE TABLE users2 (                                                                                                               |
| >     test JSONB                                                                                                                      |
| > );                                                                                                                                  |
| CREATE TABLE                                                                                                                          |
|                                                                                                                                       |
| > EXPLAIN ANALYZE                                                                                                                     |
| > INSERT INTO users1 (test)                                                                                                           |
| > SELECT jsonb_build_object(                                                                                                          |
| >     'a', md5(random()::text)::text,                                                                                                 |
| >     'b', md5(random()::text)::text                                                                                                  |
| > )                                                                                                                                   |
| > FROM generate_series(1, 100000) i;                                                                                                  |
| QUERY PLAN                                                                                                                            |
| Insert on users1  (cost=0.00..3750.00 rows=0 width=0) (actual time=184.280..184.281 rows=0.00 loops=1)                                |
| Buffers: shared hit=102854 dirtied=1430 written=1432                                                                                  |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3750.00 rows=100000 width=32) (actual time=2.514..149.198 rows=100000.00 loops=1)          |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.508..127.342 rows=100000.00 loops=1) |
| Planning:                                                                                                                             |
| Buffers: shared hit=12                                                                                                                |
| Planning Time: 0.036 ms                                                                                                               |
| Execution Time: 184.505 ms                                                                                                            |
|                                                                                                                                       |
| > EXPLAIN ANALYZE                                                                                                                     |
| > INSERT INTO users2 (test)                                                                                                           |
| > SELECT jsonb_build_object(                                                                                                          |
| >     'a', md5(random()::text)::text,                                                                                                 |
| >     'b', md5(random()::text)::text                                                                                                  |
| > )                                                                                                                                   |
| > FROM generate_series(1, 100000) i;                                                                                                  |
| QUERY PLAN                                                                                                                            |
| Insert on users2  (cost=0.00..3250.00 rows=0 width=0) (actual time=158.466..158.467 rows=0.00 loops=1)                                |
| Buffers: shared hit=102854 dirtied=1430 written=1432                                                                                  |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.466..123.663 rows=100000.00 loops=1) |
| Planning Time: 0.025 ms                                                                                                               |
| Execution Time: 158.657 ms                                                                                                            |
|                                                                                                                                       |
| > select test from users1 limit 3;                                                                                                    |
| test                                                                                                                                  |
| {"a": "dba001dbc53fb1affecb161244d49de5", "b": "1269bcf288fab7ff8bc8810322cf72df"}                                                    |
| {"a": "f680462287f0e413535a1d1a9e08bd9c", "b": "78082ff4cf9ac36a66da115caa675057"}                                                    |
| {"a": "ddda418ccf6b8bf7e601e3eeacd57d92", "b": "e1ab4cecb9a56acad02351bcd09ab0a9"}                                                    |
|                                                                                                                                       |
| > select test from users2 limit 3;                                                                                                    |
| test                                                                                                                                  |
| {"a": "3beeada8c14e8d4b1b137899bb26ab9e", "b": "68d8babc9da1ecc0d561d54d92f2d83e"}                                                    |
| {"a": "ac5895ccaba4305066c3539ffc199525", "b": "e0ffd0cc569d1de65334dddeb0f9afe4"}                                                    |
| {"a": "4d5ca26a018345a916c55d7aca560a84", "b": "2f068f30473bcee7650760a5c5431cb8"}                                                    |
|                                                                                                                                       |
| > EXPLAIN ANALYZE                                                                                                                     |
| > SELECT test->>'a' FROM users1;                                                                                                      |
| QUERY PLAN                                                                                                                            |
| Seq Scan on users1  (cost=0.00..3858.30 rows=194344 width=32) (actual time=0.005..16.547 rows=100000.00 loops=1)                      |
| Buffers: shared hit=1429                                                                                                              |
| Planning Time: 0.004 ms                                                                                                               |
| Execution Time: 18.648 ms                                                                                                             |
|                                                                                                                                       |
| > EXPLAIN ANALYZE                                                                                                                     |
| > SELECT test->>'a' FROM users2;                                                                                                      |
| QUERY PLAN                                                                                                                            |
| Seq Scan on users2  (cost=0.00..3858.30 rows=194344 width=32) (actual time=0.004..7.037 rows=100000.00 loops=1)                       |
| Buffers: shared hit=1429                                                                                                              |
| Planning Time: 0.008 ms                                                                                                               |
| Execution Time: 9.035 ms                                                                                                              |
</pre>
</div>

 <p>
書き込み。JSONBのほうが保存時パースする分遅い想定だったのだが、なぜかJSONBのほうが少し早い。構造の複雑さによるのだろうか。
</p>

 <ul class="org-ul"> <li>JSONフィールドの書き込み(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.036 ms</li>
 <li>Execution Time: 184.505 ms</li>
</ul></li>
 <li>JSONBフィールドの書き込み(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.025 ms</li>
 <li>Execution Time: 158.657 ms</li>
</ul></li>
</ul> <p>
読み出し。JSONBのほうが読み出し時にパースがないぶん早い。
</p>

 <ul class="org-ul"> <li>JSONフィールドの読み出し(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.004 ms</li>
 <li>Execution Time: 18.648 ms</li>
</ul></li>
 <li>JSONBフィールドの読み出し(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.008 ms</li>
 <li>Execution Time: 9.035 ms</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org1ec0fc6" class="outline-2">
 <h2 id="org1ec0fc6"> <a href="#org1ec0fc6">関連</a></h2>
 <div class="outline-text-2" id="text-org1ec0fc6">
 <ul class="org-ul"> <li>追加調査: 書き込みはJSONが早いはずだが、この例だとなぜかJSONBのほうがなぜか少し早かった。複雑なJSON構造の場合はどうなるか確かめる</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251211T084518--kdoc-502-jsonとjsonbの性能を比較する__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251211T084518--kdoc-502-jsonとjsonbの性能を比較する__permanent.html</id>
  <updated>2025-12-25T06:47:54+09:00</updated>
</entry>
<entry>
  <title>KDOC 515: DHCP OFFERではまだIPがないのにどうやってUDPで通信しているか?</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org84e6e57" class="outline-2">
 <h2 id="org84e6e57"> <a href="#org84e6e57">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org84e6e57">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org8f8511a" class="outline-2">
 <h2 id="org8f8511a"> <a href="#org8f8511a">概要</a></h2>
 <div class="outline-text-2" id="text-org8f8511a">
 <p>
DHCP OFFERは、クライアントからのDHCP DISCOVERに対して割当可能なIPアドレスを提示する。DHCPはIPアドレスを自動設定するためのプロトコルなので、クライアントはOFFERを送った時点でIPアドレスを持っていない。
</p>

 <p>
クライアント → サーバはブロードキャストで送っているので、IPアドレスがなくても動くのはわかるが、サーバ → クライアントはどうしているのだろうか。
</p>

 <blockquote>
 <p>
DHCPサーバは、基盤となるトランスポート層のハードウェアレベルのMACアドレスを参照することができる。現在のRFCでは、DHCPパケットにクライアント識別子が指定されていない場合はトランスポート層のMACアドレスを使用できる。
 <a href="https://ja.wikipedia.org/wiki/DHCP#DHCP_offer">DHCP - Wikipedia</a>
</p>
</blockquote>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>DHCPコネクションはIPアドレスとMACアドレスの両方でハンドリングできるようになっている</label> <pre class="src src-git-permalink">https://github.com/AdguardTeam/AdGuardHome/blob/59e8c8385d1bb8239b83e5a514b524cdbcd1555e/internal/dhcpd/conn_linux.go#L34-L49
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">// dhcpConn is the net.PacketConn capable of handling both net.UDPAddr and
// net.HardwareAddr.
type dhcpConn struct {
	// udpConn is the connection for UDP addresses.
	udpConn net.PacketConn
	// bcastIP is the broadcast address specific for the configured
	// interface's subnet.
	bcastIP net.IP

	// rawConn is the connection for MAC addresses.
	rawConn net.PacketConn
	// srcMAC is the hardware address of the configured network interface.
	srcMAC net.HardwareAddr
	// srcIP is the IP address  of the configured network interface.
	srcIP net.IP
}
</pre>
</div>
</div>
</div>
 <div id="outline-container-org2859383" class="outline-2">
 <h2 id="org2859383"> <a href="#org2859383">関連</a></h2>
 <div class="outline-text-2" id="text-org2859383">
 <ul class="org-ul"> <li>参照:  <a href="https://ja.wikipedia.org/wiki/DHCP#DHCP_offer">DHCP - Wikipedia</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251221T110432--kdoc-515-dhcp-offerはまだipがないのにどうやってudpで通信しているのか__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251221T110432--kdoc-515-dhcp-offerはまだipがないのにどうやってudpで通信しているのか__draft_permanent.html</id>
  <updated>2025-12-25T06:47:52+09:00</updated>
</entry>
<entry>
  <title>KDOC 510: DNSサーバでテストTDLを使用する例を示す</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgfb9cc07" class="outline-2">
 <h2 id="orgfb9cc07"> <a href="#orgfb9cc07">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgfb9cc07">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-23 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orga867fca" class="outline-2">
 <h2 id="orga867fca"> <a href="#orga867fca">概要</a></h2>
 <div class="outline-text-2" id="text-orga867fca">
 <p>
 <code>.test</code> は特別なTDLで、使われないことが保証されているので、アプリケーションの内部用として自由に使える。テスト用ドメインを使えることがどういうケースに役立つかを、AdGuardHomeのコードで示す。
</p>

 <p>
たとえば、DNSサーバ自身のヘルスチェックで使っている。
</p>

 <div class="org-src-container">
 <pre class="src src-git-permalink">https://github.com/AdguardTeam/AdGuardHome/blob/63ec09f086f62009be5f53b941e44e522b5300dd/internal/dnsforward/process.go#L140-L148
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">// healthcheckFQDN is a reserved domain-name used for healthchecking.
//
// [Section 6.2 of RFC 6761] states that DNS Registries/Registrars must not
// grant requests to register test names in the normal way to any person or
// entity, making domain names under the .test TLD free to use in internal
// purposes.
//
// [Section 6.2 of RFC 6761]: https://www.rfc-editor.org/rfc/rfc6761.html#section-6.2
const healthcheckFQDN = "healthcheck.adguardhome.test."
</pre>
</div>

 <p>
どう使われているか見る。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>processInitial()にて</label> <pre class="src src-git-permalink">https://github.com/AdguardTeam/AdGuardHome/blob/59e8c8385d1bb8239b83e5a514b524cdbcd1555e/internal/dnsforward/process.go#L175-L180
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">if q.Name == healthcheckFQDN {
	// Generate a NODATA negative response to make nslookup exit with 0.
	pctx.Res = s.replyCompressed(pctx.Req)

	return resultCodeFinish
}
</pre>
</div>

 <p>
ヘルスチェックドメイン名のときは上位ネームサーバに解決しようとせずに、DNSサーバの生存を示す空のデータを返す。  <code>.test</code> は使われないことが保証されているので、こういうことができる。
</p>
</div>
</div>
 <div id="outline-container-orgc0448c3" class="outline-2">
 <h2 id="orgc0448c3"> <a href="#orgc0448c3">関連</a></h2>
 <div class="outline-text-2" id="text-orgc0448c3">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251220T094534--kdoc-510-dnsサーバでテストtdlを使用する例を示す__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251220T094534--kdoc-510-dnsサーバでテストtdlを使用する例を示す__draft_permanent.html</id>
  <updated>2025-12-25T06:47:52+09:00</updated>
</entry>
<entry>
  <title>KDOC 506: 圧倒的な量が集まってきたから好きになる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgdeb2619" class="outline-2">
 <h2 id="orgdeb2619"> <a href="#orgdeb2619">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgdeb2619">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgea6460d" class="outline-2">
 <h2 id="orgea6460d"> <a href="#orgea6460d">概要</a></h2>
 <div class="outline-text-2" id="text-orgea6460d">
 <p>
 <a href="20221027T235104--kdoc-3-『ない仕事の作り方』__book.html#ID-20221027T235104">KDOC 3: 『ない仕事の作り方』</a>から、ないジャンルに名前をつけ、発表にいたるまでの流れを示す。
</p>

 <ol class="org-ol"> <li>こんな知識が何の役に立つのだろうかと考える暇を与えず、大量に摂取する</li>
 <li>好きだから集めるのではなく、圧倒的な量が集まってきたから好きになっていく</li>
 <li>「これだけ面白いものが流行らないわけがない」と自分の洗脳が進み、他人に興味を持ってもらえるようになっていく</li>
</ol></div>
</div>
 <div id="outline-container-orga6758f1" class="outline-2">
 <h2 id="orga6758f1"> <a href="#orga6758f1">関連</a></h2>
 <div class="outline-text-2" id="text-orga6758f1">
 <ul class="org-ul"> <li>引用:  <a href="20221027T235104--kdoc-3-『ない仕事の作り方』__book.html#ID-20221027T235104">KDOC 3: 『ない仕事の作り方』</a>。から</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251214T193935--kdoc-506-圧倒的な量が集まってきたから好きになる__essay.html"/>
  <id>https://kijimad.github.io/roam/20251214T193935--kdoc-506-圧倒的な量が集まってきたから好きになる__essay.html</id>
  <updated>2025-12-25T06:47:52+09:00</updated>
</entry>
<entry>
  <title>KDOC 520: Goコンパイラは定数除算を乗算に変換する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org2b63e8a" class="outline-2">
 <h2 id="org2b63e8a"> <a href="#org2b63e8a">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org2b63e8a">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgc402547" class="outline-2">
 <h2 id="orgc402547"> <a href="#orgc402547">概要</a></h2>
 <div class="outline-text-2" id="text-orgc402547">
 <p>
変数で除算する場合と、定数で除算する場合のアセンブリを比較する。
</p>

 <iframe width="800px" height="200px" src="https://godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:go,selection:(endColumn:2,endLineNumber:16,positionColumn:2,positionLineNumber:16,selectionStartColumn:2,selectionStartLineNumber:16,startColumn:2,startLineNumber:16),source:'//+Type+your+code+here,+or+load+an+example.%0A//+Your+function+name+should+start+with+a+capital+letter.%0Apackage+main%0A%0Afunc+main()+%7B%0A++++_+%3D+div1(1,+2)%0A++++_+%3D+div2(1,+2)%0A%7D%0A%0Afunc+div1(a,+b+int)+int+%7B%0A++++return+a+/+b%0A%7D%0A%0Afunc+div2(a,+_+int)+int%7B%0A+++return+a+/+3%0A%7D'),l:'5',n:'0',o:'Go+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:gltip,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:go,libs:!(),options:'',overrides:!(),selection:(endColumn:15,endLineNumber:22,positionColumn:15,positionLineNumber:22,selectionStartColumn:15,selectionStartLineNumber:22,startColumn:15,startLineNumber:22),source:1),l:'5',n:'0',o:'+x86-64+gc+(tip)+(Editor+%231)',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>

 <ul class="org-ul"> <li>変数で除算するコードでは除算命令  <code>IDIVQ</code> を使っている</li>
 <li>定数で除算するコードでは除算命令は登場せず乗算命令  <code>IMULQ</code> を使っている</li>
</ul> <p>
また、変数で除算する場合はゼロ除算時のチェック  <code>CALL runtime.panicdivide(SB)</code> が入っていたりする。
</p>
</div>
</div>
 <div id="outline-container-orge56424b" class="outline-2">
 <h2 id="orge56424b"> <a href="#orge56424b">関連</a></h2>
 <div class="outline-text-2" id="text-orge56424b">
 <ul class="org-ul"> <li>動機(追加調査):  <a href="20251218T232745--kdoc-508-除算の実行速度を計測する__draft_permanent.html#ID-20251218T232745">KDOC 508: 除算の実行速度を計測する</a>。調べているとき、変数か定数かで速度に違いがあることから命令に違いがありそうなことに気づいた</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251224T090149--kdoc-520-goコンパイラは定数除算を乗算に変換する__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251224T090149--kdoc-520-goコンパイラは定数除算を乗算に変換する__draft_permanent.html</id>
  <updated>2025-12-25T06:47:46+09:00</updated>
</entry>
<entry>
  <title>KDOC 511: 半蔵門ミュージアムを観察する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgec0f151" class="outline-2">
 <h2 id="orgec0f151"> <a href="#orgec0f151">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgec0f151">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org34f05b1" class="outline-2">
 <h2 id="org34f05b1"> <a href="#org34f05b1">概要</a></h2>
 <div class="outline-text-2" id="text-org34f05b1">
 <p>
半蔵門ミュージアムは、東京都千代田区にある歴史的な仏教美術品を展示する博物館である。
</p>

 <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d125215.87139745476!2d139.66005903906253!3d35.656440154172365!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188c6556d00001%3A0xcd6709c1ea4ad3e1!2sHanzomon%20Museum!5e1!3m2!1sen!2sjp!4v1766207040753!5m2!1sen!2sjp" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
</div>
 <div id="outline-container-orgc05d465" class="outline-2">
 <h2 id="orgc05d465"> <a href="#orgc05d465">メモ</a></h2>
 <div class="outline-text-2" id="text-orgc05d465">
 <ul class="org-ul"> <li>全体的に広々していて、豪勢なつくりになっている。特に地下は天井の高さが3フロアぶんくらいあって地下と感じないほど広々としている。間接照明で砂岩ふうの壁が照らされている。非常に静かで、厳かな雰囲気がする</li>
 <li>面積の割に従業員が多い。受付に2人、エレベーターに1人、売店に2人、館内をスーツで巡回する人が数人いる。半蔵門という超絶スポットにある。それにも関わらず、入館料は無料である。明らかに公立の博物館よりコストがかかっているが、成り立っているのを不思議に感じた。宗教のバックグラウンドによるトリックがあるのだろうか</li>
 <li>紀元付近につくられたというインドの本物の石彫刻は、ケースにも入っていなくて、間近に観察できる。キラキラしたものを含む岩石に掘られている。ケースの有無は全然違う。服装や顔の感じはギリシャふうの雰囲気である</li>
</ul></div>
</div>
 <div id="outline-container-org887160f" class="outline-2">
 <h2 id="org887160f"> <a href="#org887160f">感想</a></h2>
 <div class="outline-text-2" id="text-org887160f">
 <ul class="org-ul"> <li>新興宗教を興す教祖になったつもりで見た。宗教グッズやストーリーにどういう「効果」があるかという観点で見る</li>
 <li>昔の人も現代人と変わらない認識で、当時の人になりきって想像する</li>
 <li>仏像は現代のフィギュアやアイドル文化みたいなもの。寺はテーマパークである</li>
 <li>まず仔細に実物を観察、考察して、それから解説を読んで楽しんだ。地下の解説は知らない登場人物が多すぎてわからなかったが、2階に易しい解説があった。わかりやすい</li>
 <li>平安時代の造物が(過去数度の補修があったとしても)残っているのがすごいと感じる</li>
 <li>仏教はグッズが多い感じがする。精巧で美しい、さまざまなタイプの仏像がある。恐ろしいもの、落ち着いたもの。こんな感じで等身大フィギュアに特色があれば、寺に行きたくなるのもわかる気がする</li>
 <li>神社にはあまりないように見える。お守りとか販売用の小物はあるが、神社によってわかりやすく違う造作はないように見える</li>
 <li>仏教は、壮大な原作とメディアミックス、同人誌の文化と解釈できるのではないか</li>
 <li>彫刻のなかには、粘土ならギリできそうなくらいの出来のものもあった。単品で成立するわけでなく石塔についていたレリーフのようであった。このクオリティがあることに少し安心した。歴史的逸品はあまりにうますぎて人がつくったものであることが信じられない</li>
 <li>今大人になって、時間をつくるのは大変であるが、当時の人たちも石の彫刻をほる時間をとるのは大変だっただろう。ヘタウマなところも含めて趣味の熱意を感じる</li>
</ul></div>
</div>
 <div id="outline-container-org9a2b9d4" class="outline-2">
 <h2 id="org9a2b9d4"> <a href="#org9a2b9d4">関連</a></h2>
 <div class="outline-text-2" id="text-org9a2b9d4">
 <ul class="org-ul"> <li>類推:  <a href="20241027T201315--kdoc-255-『完全教祖マニュアル』__book.html#ID-20241027T201315">KDOC 255: 『完全教祖マニュアル』</a>。教祖としての宗教を解説する</li>
</ul></div>
</div>
 <div id="outline-container-orgaf2bc7e" class="outline-2">
 <h2 id="orgaf2bc7e"> <a href="#orgaf2bc7e">Backlinks</a></h2>
 <div class="outline-text-2" id="text-orgaf2bc7e">
 <ul class="org-ul"> <li> <a href="./20240908T180537--kdoc-238-他人の博物館を観察して参考にする__project.html">KDOC 238: 他人の博物館を観察して参考にする</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251220T140427--kdoc-511-半蔵門ミュージアムを観察する__draft_essay.html"/>
  <id>https://kijimad.github.io/roam/20251220T140427--kdoc-511-半蔵門ミュージアムを観察する__draft_essay.html</id>
  <updated>2025-12-25T06:47:46+09:00</updated>
</entry>
<entry>
  <title>KDOC 518: 大カプコン展を観察する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgaeb578c" class="outline-2">
 <h2 id="orgaeb578c"> <a href="#orgaeb578c">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgaeb578c">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgd94c124" class="outline-2">
 <h2 id="orgd94c124"> <a href="#orgd94c124">概要</a></h2>
 <div class="outline-text-2" id="text-orgd94c124">
</div>
</div>
 <div id="outline-container-org7956119" class="outline-2">
 <h2 id="org7956119"> <a href="#org7956119">メモ</a></h2>
 <div class="outline-text-2" id="text-org7956119">
 <ul class="org-ul"> <li>もっとも強力なコンテンツはキャラクターIPである</li>
 <li>曜日や時間帯もあってか、意外と上の年齢層の人が多かった。40~50代くらい。カプコンの長い歴史を考えると妥当にも見える。中年の夫婦、という感じのペアも多かった。男女は半々、という感じで意外に女性が多かったように見える</li>
 <li>もっとも魅力的なショップコーナー
 <ul class="org-ul"> <li>有名キャラクター</li>
 <li>限定感</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgf1ca713" class="outline-2">
 <h2 id="orgf1ca713"> <a href="#orgf1ca713">関連</a></h2>
 <div class="outline-text-2" id="text-orgf1ca713">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251222T202838--kdoc-518-大カプコン展を観察する__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251222T202838--kdoc-518-大カプコン展を観察する__draft_permanent.html</id>
  <updated>2025-12-25T06:47:45+09:00</updated>
</entry>
<entry>
  <title>KDOC 512: DNSで強制セーフサーチされている様子を見る</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org4474638" class="outline-2">
 <h2 id="org4474638"> <a href="#org4474638">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org4474638">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-21 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-23 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org954fec5" class="outline-2">
 <h2 id="org954fec5"> <a href="#org954fec5">概要</a></h2>
 <div class="outline-text-2" id="text-org954fec5">
 <p>
DNSフィルタリングツールのAdGuardで、強制セーフサーチが適用されている様子を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-shell">dig www.google.com
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">
; <<>> DiG 9.18.30-0ubuntu0.24.04.1-Ubuntu <<>> www.google.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 55983
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;www.google.com.			IN	A

;; ANSWER SECTION:
www.google.com.		3	IN	CNAME	forcesafesearch.google.com. 👈
forcesafesearch.google.com. 3	IN	A	216.239.38.120

;; Query time: 0 msec
;; SERVER: 127.0.0.53#53(127.0.0.53) (UDP)
;; WHEN: Sat Dec 20 19:54:25 JST 2025
;; MSG SIZE  rcvd: 89

</pre>
</div>

 <p>
以下の流れのように、強制されていることがわかる。
</p>

 <ul class="org-ul"> <li>www.google.com -(CNAME)→ forcesafesearch.google.com -(A)→ 216.239.38.120</li>
</ul></div>
</div>
 <div id="outline-container-orgb24abcd" class="outline-2">
 <h2 id="orgb24abcd"> <a href="#orgb24abcd">関連</a></h2>
 <div class="outline-text-2" id="text-orgb24abcd">
 <ul class="org-ul"> <li>動機:  <a href="20241118T203644--kdoc-295-lanでdnsフィルタリングする流れを見る__permanent.html#ID-20241118T203644">KDOC 295: LANでDNSフィルタリングする流れを見る</a>。使っていて気になった</li>
 <li>追加調査: www.google.com と google.com で結果が異なる。何が違うのか</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251220T195006--kdoc-512-dnsで強制セーフサーチされている様子を見る__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251220T195006--kdoc-512-dnsで強制セーフサーチされている様子を見る__permanent.html</id>
  <updated>2025-12-25T06:47:44+09:00</updated>
</entry>
<entry>
  <title>KDOC 519: Goのmapではキーの値が同じでも型情報が違えば別のものとして扱われる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org451afb9" class="outline-2">
 <h2 id="org451afb9"> <a href="#org451afb9">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org451afb9">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org67e8b52" class="outline-2">
 <h2 id="org67e8b52"> <a href="#org67e8b52">概要</a></h2>
 <div class="outline-text-2" id="text-org67e8b52">
</div>
</div>
 <div id="outline-container-org161d5ce" class="outline-2">
 <h2 id="org161d5ce"> <a href="#org161d5ce">関連</a></h2>
 <div class="outline-text-2" id="text-org161d5ce">
 <p>
なし。
</p>
</div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251223T085835--kdoc-519-goのmapではキーの値が同じでも型情報が違えば別のものとして扱われる__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251223T085835--kdoc-519-goのmapではキーの値が同じでも型情報が違えば別のものとして扱われる__draft_permanent.html</id>
  <updated>2025-12-25T06:47:43+09:00</updated>
</entry>
<entry>
  <title>KDOC 503: Linuxカーネルは/boot配下にあるvmlinuzファイルである</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgb0eafbc" class="outline-2">
 <h2 id="orgb0eafbc"> <a href="#orgb0eafbc">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgb0eafbc">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-org2b6b0ce" class="outline-2">
 <h2 id="org2b6b0ce"> <a href="#org2b6b0ce">概要</a></h2>
 <div class="outline-text-2" id="text-org2b6b0ce">
 <p>
Linuxカーネルは  <code>/boot</code> 配下にある  <code>vmlinuz</code> ファイルである、といえる。カーネルは  <code>gzip</code> で圧縮されているので  <code>z</code> がついている。
</p>

 <p>
手元の環境で試してみると確かに  <code>vmlinuz</code> が存在する。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>確かめる</label> <pre class="src src-shell">ls /boot -al
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">total 95208
drwxr-xr-x  4 root root     4096 Feb 11  2025 .
drwxr-xr-x 24 root root     4096 Oct  5 22:04 ..
-rw-r--r--  1 root root   287413 Dec  1  2024 config-6.8.0-51-generic
drwx------  3 root root     4096 Jan  1  1970 efi
drwxr-xr-x  5 root root     4096 Feb 11  2025 grub
lrwxrwxrwx  1 root root       27 Feb 11  2025 initrd.img -> initrd.img-6.8.0-51-generic
-rw-r--r--  1 root root 73134942 Feb 11  2025 initrd.img-6.8.0-51-generic
lrwxrwxrwx  1 root root       27 Feb 11  2025 initrd.img.old -> initrd.img-6.8.0-51-generic
-rw-------  1 root root  9072978 Dec  1  2024 System.map-6.8.0-51-generic
lrwxrwxrwx  1 root root       24 Feb 11  2025 vmlinuz -> vmlinuz-6.8.0-51-generic
-rw-r--r--  1 root root 14969224 Dec  1  2024 vmlinuz-6.8.0-51-generic
</pre>
</div>
</div>
</div>
 <div id="outline-container-orgc659c5d" class="outline-2">
 <h2 id="orgc659c5d"> <a href="#orgc659c5d">関連</a></h2>
 <div class="outline-text-2" id="text-orgc659c5d">
 <ul class="org-ul"> <li>引用:  <a href="20240105T215847--kdoc-63-『私はどのようにしてlinuxカーネルを学んだか』__book.html#ID-20240105T215847">KDOC 63: 『私はどのようにしてLinuxカーネルを学んだか』</a>から。端的にどこにあたるかが示されていて面白いと感じた</li>
 <li>追加調査:  <code>/boot</code> ディレクトリのほかのファイルが何か見る</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251212T232903--kdoc-503-linuxカーネルはboot配下にあるvmlinuzファイルである__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251212T232903--kdoc-503-linuxカーネルはboot配下にあるvmlinuzファイルである__permanent.html</id>
  <updated>2025-12-25T06:47:41+09:00</updated>
</entry>
<entry>
  <title>KDOC 514: ARPテーブルとMACアドレステーブルの違い</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org5ed47b7" class="outline-2">
 <h2 id="org5ed47b7"> <a href="#org5ed47b7">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org5ed47b7">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgb3ca37f" class="outline-2">
 <h2 id="orgb3ca37f"> <a href="#orgb3ca37f">概要</a></h2>
 <div class="outline-text-2" id="text-orgb3ca37f">
 <p>
ARPテーブルとMACアドレステーブルの違い。
</p>

 <ul class="org-ul"> <li>ARPテーブル: IP と MAC … 各NICデバイスごとで持つ</li>
 <li>MACアドレステーブル: MACとポート … ポート番号を引く用, ブリッジが持つ</li>
</ul></div>
</div>
 <div id="outline-container-org5925553" class="outline-2">
 <h2 id="org5925553"> <a href="#org5925553">関連</a></h2>
 <div class="outline-text-2" id="text-org5925553">
 <ul class="org-ul"> <li>動機:  <a href="20251023T173743--kdoc-477-『docker-kubernetesネットワークのしくみ』__book.html#ID-20251023T173743">KDOC 477: 『Docker-Kubernetesネットワークのしくみ』</a>を読んでいて疑問に感じて調べた</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251221T092231--kdoc-514-arpテーブルとmacアドレステーブルの違い__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251221T092231--kdoc-514-arpテーブルとmacアドレステーブルの違い__draft_permanent.html</id>
  <updated>2025-12-25T06:47:38+09:00</updated>
</entry>
<entry>
  <title>KDOC 508: 除算の実行速度を計測する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orgcec10cb" class="outline-2">
 <h2 id="orgcec10cb"> <a href="#orgcec10cb">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orgcec10cb">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgdb6e054" class="outline-2">
 <h2 id="orgdb6e054"> <a href="#orgdb6e054">概要</a></h2>
 <div class="outline-text-2" id="text-orgdb6e054">
 <p>
除算というのは負荷の大きな演算であり、加算などの演算に比べると、実行に要する時間がはるかに長い(p51)。
</p>

 <p>
アセンブリを見てみると、除算は命令数が多いのを確認できる。単純に  <code>DIV</code> 命令だけではない。
</p>

 <iframe width="800px" height="200px" src="https://godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:go,selection:(endColumn:17,endLineNumber:7,positionColumn:17,positionLineNumber:7,selectionStartColumn:17,selectionStartLineNumber:7,startColumn:17,startLineNumber:7),source:'//+Type+your+code+here,+or+load+an+example.%0A//+Your+function+name+should+start+with+a+capital+letter.%0Apackage+main%0A%0Afunc+main()+%7B%0A++++_+%3D+add(1,+2)%0A++++_+%3D+div(1,+2)%0A%7D%0A%0Afunc+add(a,+b+int)+int+%7B%0A++++return+a+%2B+b%0A%7D%0A%0Afunc+div(a,+b+int)+int%7B%0A+++return+a+/+b%0A%7D'),l:'5',n:'0',o:'Go+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:gltip,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:go,libs:!(),options:'',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:1),l:'5',n:'0',o:'+x86-64+gc+(tip)+(Editor+%231)',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>

 <p>
じっさいに計測してみる。
</p>

 <div class="org-src-container">
 <label class="org-src-name"> <span class="listing-number">Listing 1: </span>ベンチマーク</label> <pre class="src src-shell">go install golang.org/x/perf/cmd/benchstat@latest

 <span class="org-variable-name">tmpdir</span>=$(mktemp -d)
 <span class="org-builtin">cd</span> $ <span class="org-variable-name">tmpdir</span>

cat > $ <span class="org-variable-name">tmpdir</span>/bench_test.go <<EOF <span class="org-sh-heredoc">
  package main

  import "testing"

  func BenchmarkAdd(b *testing.B) {
        for i := 0; i < b.N; i++ {
                _ = add(42)
        }
  }

  func BenchmarkDiv(b *testing.B) {
        for i := 0; i < b.N; i++ {
                _ = div(42)
        }
  }

  //go:noinline
  func add(a int) int {
        return a + a
  }

  //go:noinline
  func div(a int) int {
        return a / a
  }
EOF
</span>
go mod init bench
go mod tidy
go test -bench=. -benchmem -count=10 > exec.log

benchstat exec.log 2>&1

rm -rf $ <span class="org-variable-name">tmpdir</span>
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">goos: linux
goarch: amd64
pkg: bench
cpu: AMD Ryzen 9 9900X 12-Core Processor
        │   exec.log   │
        │    sec/op    │
Add-24    0.9069n ± 1% 👈
Div-24     1.262n ± 4% 👈
geomean    1.070n

        │   exec.log   │
        │     B/op     │
Add-24    0.000 ± 0%
Div-24    0.000 ± 0%
geomean              ¹
¹ summaries must be >0 to compute geomean

        │   exec.log   │
        │  allocs/op   │
Add-24    0.000 ± 0%
Div-24    0.000 ± 0%
geomean              ¹
¹ summaries must be >0 to compute geomean
</pre>
</div>

 <p>
たしかに、除算は加算より時間がかかるのを確認できた。
</p>
</div>
</div>
 <div id="outline-container-orge748780" class="outline-2">
 <h2 id="orge748780"> <a href="#orge748780">関連</a></h2>
 <div class="outline-text-2" id="text-orge748780">
 <ul class="org-ul"> <li>参照:  <a href="20240810T122445--kdoc-217-『基礎からきっちり覚える-機械語入門』__book.html#ID-20240810T122445">KDOC 217: 『基礎からきっちり覚える 機械語入門』</a>から</li>
</ul></div>
</div>
 <div id="outline-container-org3521a98" class="outline-2">
 <h2 id="org3521a98"> <a href="#org3521a98">Backlinks</a></h2>
 <div class="outline-text-2" id="text-org3521a98">
 <ul class="org-ul"> <li> <a href="./20251224T090149--kdoc-520-goコンパイラは定数除算を乗算に変換する__draft_permanent.html">KDOC 520: Goコンパイラは定数除算を乗算に変換する</a></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251218T232745--kdoc-508-除算の実行速度を計測する__draft_permanent.html"/>
  <id>https://kijimad.github.io/roam/20251218T232745--kdoc-508-除算の実行速度を計測する__draft_permanent.html</id>
  <updated>2025-12-25T06:47:38+09:00</updated>
</entry>
<entry>
  <title>KDOC 501: インデックスのオーバーヘッドを検証する</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-org4e28867" class="outline-2">
 <h2 id="org4e28867"> <a href="#org4e28867">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-org4e28867">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
 <li>レビュー
 <ul class="org-ul"> <li class="on"> <input type="checkbox" checked="checked"></input> 2025-12-16 貴島</li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgcd7ad1c" class="outline-2">
 <h2 id="orgcd7ad1c"> <a href="#orgcd7ad1c">概要</a></h2>
 <div class="outline-text-2" id="text-orgcd7ad1c">
 <p>
 <a href="https://syu-m-5151.hatenablog.com/entry/2025/11/25/135220">「Postgres で試した？」と聞き返せるようになるまでもしくはなぜ私は雰囲気で技術を語るのか？ — Just use Postgres 読書感想文</a>のOver-Indexingを読んで、インデックスの具体的なオーバヘッドを知った。
</p>

 <blockquote>
 <ul class="org-ul"> <li>作成時にディスク容量を消費する</li>
 <li>更新時にメンテナンスコストがかかる</li>
 <li>計画時（Planning Time）にオプション評価のコストがかかる</li>
</ul></blockquote>

 <p>
これらをじっさいに試す。
</p>
</div>
 <div id="outline-container-org904ad07" class="outline-3">
 <h3 id="org904ad07"> <a href="#org904ad07">作成時のディスク容量</a></h3>
 <div class="outline-text-3" id="text-org904ad07">
 <p>
レコードを作成して、インデックスのディスク容量を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード数を確認する
</span> <span class="org-keyword">select</span>  <span class="org-builtin">count</span>(*)  <span class="org-keyword">from</span> users;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスサイズを確認する
</span> <span class="org-keyword">SELECT</span> pg_size_pretty(pg_relation_size( <span class="org-string">'idx_users_name'</span>));
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                              |   |                     |
|--------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                       |   |                     |
| >     name varchar(255)                                      |   |                     |
| > );                                                         |   |                     |
| CREATE TABLE                                                 |   |                     |
|                                                              |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                |   |                     |
| CREATE INDEX                                                 |   |                     |
|                                                              |   |                     |
| > BEGIN;                                                     |   |                     |
| BEGIN                                                        |   |                     |
|                                                              |   |                     |
| > INSERT INTO users (name)                                   |   |                     |
| > SELECT                                                     |   |                     |
| >      -- 32x2 文字                                          |   |                     |
| >      md5(random()::text)                                   |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                         |   |                     |
| INSERT 0 100000                                              |   |                     |
|                                                              |   |                     |
| > ROLLBACK;                                                  |   |                     |
| ROLLBACK                                                     |   |                     |
|                                                              |   |                     |
| > select count(*) from users;                                |   |                     |
| count                                                        |   |                     |
| 0                                                            |   |                     |
|                                                              |   |                     |
| > SELECT pg_size_pretty(pg_relation_size('idx_users_name')); |   |                     |
| pg_size_pretty                                               |   |                     |
| 12 MB                                                        |   |                     |
</pre>
</div>

 <p>
10万レコード、1レコード64バイトで、インデックスサイズは12MBある。
</p>
</div>
</div>
 <div id="outline-container-org4bbef15" class="outline-3">
 <h3 id="org4bbef15"> <a href="#org4bbef15">更新時のコスト</a></h3>
 <div class="outline-text-3" id="text-org4bbef15">
 <p>
インデックスの有無を変えてレコードを更新したときの時間を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

EXPLAIN ANALYZE
 <span class="org-keyword">UPDATE</span> users  <span class="org-keyword">SET</span>  <span class="org-keyword">name</span> =  <span class="org-string">'abc'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

EXPLAIN ANALYZE
 <span class="org-keyword">UPDATE</span> users  <span class="org-keyword">SET</span>  <span class="org-keyword">name</span> =  <span class="org-string">'def'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                                      |   |                     |
|--------------------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                               |   |                     |
| >     name varchar(255)                                                                                                              |   |                     |
| > );                                                                                                                                 |   |                     |
| CREATE TABLE                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > INSERT INTO users (name)                                                                                                           |   |                     |
| > SELECT                                                                                                                             |   |                     |
| >      -- 32x2 文字                                                                                                                  |   |                     |
| >      md5(random()::text)                                                                                                           |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                                 |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Insert on users  (cost=0.00..3500.00 rows=0 width=0) (actual time=127.862..127.863 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=102466 dirtied=1236 written=1238                                                                                 |   |                     |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3500.00 rows=100000 width=516) (actual time=2.628..92.992 rows=100000.00 loops=1)         |   |                     |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.627..88.029 rows=100000.00 loops=1) |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=6                                                                                                                |   |                     |
| Planning Time: 0.033 ms                                                                                                              |   |                     |
| Execution Time: 128.000 ms                                                                                                           |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > UPDATE users SET name = 'abc';                                                                                                     |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Update on users  (cost=0.00..1420.25 rows=0 width=0) (actual time=64.452..64.452 rows=0.00 loops=1)                                  |   |                     |
| Buffers: shared hit=304574 dirtied=437 written=437                                                                                   |   |                     |
| ->  Seq Scan on users  (cost=0.00..1420.25 rows=18525 width=522) (actual time=0.007..5.503 rows=100000.00 loops=1)                   |   |                     |
| Buffers: shared hit=1235                                                                                                             |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=22                                                                                                               |   |                     |
| Planning Time: 0.112 ms                                                                                                              |   |                     |
| Execution Time: 64.506 ms                                                                                                            |   |                     |
|                                                                                                                                      |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                                                                                        |   |                     |
| CREATE INDEX                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > UPDATE users SET name = 'def';                                                                                                     |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Update on users  (cost=0.00..2672.00 rows=0 width=0) (actual time=119.053..119.053 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=501291 read=2 dirtied=518 written=516                                                                            |   |                     |
| ->  Seq Scan on users  (cost=0.00..2672.00 rows=100000 width=522) (actual time=0.008..6.486 rows=100000.00 loops=1)                  |   |                     |
| Buffers: shared hit=1672                                                                                                             |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=15 read=1                                                                                                        |   |                     |
| Planning Time: 0.074 ms                                                                                                              |   |                     |
| Execution Time: 119.072 ms                                                                                                           |   |                     |
</pre>
</div>

 <ul class="org-ul"> <li>インデックスなしフィールドの更新(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.112 ms</li>
 <li>Execution Time: 64.506 ms</li>
</ul></li>
 <li>インデックスありフィールドの更新(10万件)
 <ul class="org-ul"> <li>Planning Time: 0.074 ms</li>
 <li>Execution Time: 119.072 ms</li>
</ul></li>
</ul> <p>
インデックスがあると更新の計画時間は減ったが、実行時間が増加している。
</p>
</div>
</div>
 <div id="outline-container-orgbad4fc2" class="outline-3">
 <h3 id="orgbad4fc2"> <a href="#orgbad4fc2">計画時間のコスト</a></h3>
 <div class="outline-text-3" id="text-orgbad4fc2">
 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード数を確認する
</span> <span class="org-keyword">select</span>  <span class="org-builtin">count</span>(*)  <span class="org-keyword">from</span> users;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">計画の詳細を出す
</span>EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)
 <span class="org-keyword">SELECT</span> *  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span>  <span class="org-keyword">name</span> =  <span class="org-string">'NO_INDEX'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">計画の詳細を出す
</span>EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)
 <span class="org-keyword">SELECT</span> *  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span>  <span class="org-keyword">name</span> =  <span class="org-string">'WITH_INDEX'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                           |   |                     |
|---------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                    |   |                     |
| >     name varchar(255)                                                                                                   |   |                     |
| > );                                                                                                                      |   |                     |
| CREATE TABLE                                                                                                              |   |                     |
|                                                                                                                           |   |                     |
| > INSERT INTO users (name)                                                                                                |   |                     |
| > SELECT                                                                                                                  |   |                     |
| >      -- 32x2 文字                                                                                                       |   |                     |
| >      md5(random()::text)                                                                                                |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                      |   |                     |
| INSERT 0 100000                                                                                                           |   |                     |
|                                                                                                                           |   |                     |
| > select count(*) from users;                                                                                             |   |                     |
| count                                                                                                                     |   |                     |
| 100000                                                                                                                    |   |                     |
|                                                                                                                           |   |                     |
| > EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)                                                                               |   |                     |
| > SELECT * FROM users WHERE name = 'NO_INDEX';                                                                            |   |                     |
| QUERY PLAN                                                                                                                |   |                     |
| Seq Scan on public.users  (cost=0.00..1466.56 rows=93 width=516) (actual time=2.421..2.421 rows=0.00 loops=1)             |   |                     |
| Output: name                                                                                                              |   |                     |
| Filter: ((users.name)::text = 'NO_INDEX'::text)                                                                           |   |                     |
| Rows Removed by Filter: 100000                                                                                            |   |                     |
| Buffers: shared hit=1235                                                                                                  |   |                     |
| Planning:                                                                                                                 |   |                     |
| Buffers: shared hit=9                                                                                                     |   |                     |
| Planning Time: 0.038 ms                                                                                                   |   |                     |
| Execution Time: 2.426 ms                                                                                                  |   |                     |
|                                                                                                                           |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                                                                             |   |                     |
| CREATE INDEX                                                                                                              |   |                     |
|                                                                                                                           |   |                     |
| > EXPLAIN (ANALYZE, VERBOSE, COSTS, TIMING)                                                                               |   |                     |
| > SELECT * FROM users WHERE name = 'WITH_INDEX';                                                                          |   |                     |
| QUERY PLAN                                                                                                                |   |                     |
| Bitmap Heap Scan on public.users  (cost=28.29..974.23 rows=500 width=516) (actual time=0.014..0.015 rows=0.00 loops=1)    |   |                     |
| Output: name                                                                                                              |   |                     |
| Recheck Cond: ((users.name)::text = 'WITH_INDEX'::text)                                                                   |   |                     |
| Buffers: shared read=3                                                                                                    |   |                     |
| ->  Bitmap Index Scan on idx_users_name  (cost=0.00..28.17 rows=500 width=0) (actual time=0.011..0.011 rows=0.00 loops=1) |   |                     |
| Index Cond: ((users.name)::text = 'WITH_INDEX'::text)                                                                     |   |                     |
| Index Searches: 1                                                                                                         |   |                     |
| Buffers: shared read=3                                                                                                    |   |                     |
| Planning:                                                                                                                 |   |                     |
| Buffers: shared hit=15 read=1                                                                                             |   |                     |
| Planning Time: 0.104 ms                                                                                                   |   |                     |
| Execution Time: 0.021 ms                                                                                                  |   |                     |
</pre>
</div>

 <ul class="org-ul"> <li>Planning Time: 0.038 ms -> 0.104 ms</li>
 <li>Execution Time: 2.426 ms -> 0.021 ms</li>
</ul> <p>
実行時間は激減したが、計画時間は増えた。この例では明らかにメリットのほうが大きいが、インデックスが増えて選択肢が増えると悪化していくのだろう。
</p>
</div>
</div>
 <div id="outline-container-org0b63bc4" class="outline-3">
 <h3 id="org0b63bc4"> <a href="#org0b63bc4">大量インデックスの計画コスト</a></h3>
 <div class="outline-text-3" id="text-org0b63bc4">
 <p>
インデックス増加による計画時間の増加を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
    noindex  <span class="org-type">varchar</span>(255),
    name1  <span class="org-type">varchar</span>(255),
    name2  <span class="org-type">varchar</span>(255),
    name3  <span class="org-type">varchar</span>(255),
    name4  <span class="org-type">varchar</span>(255),
    name5  <span class="org-type">varchar</span>(255),
    name6  <span class="org-type">varchar</span>(255),
    name7  <span class="org-type">varchar</span>(255),
    name8  <span class="org-type">varchar</span>(255),
    name9  <span class="org-type">varchar</span>(255),
    name10  <span class="org-type">varchar</span>(255),
    name11  <span class="org-type">varchar</span>(255),
    name12  <span class="org-type">varchar</span>(255),
    name13  <span class="org-type">varchar</span>(255),
    name14  <span class="org-type">varchar</span>(255),
    name15  <span class="org-type">varchar</span>(255),
    name16  <span class="org-type">varchar</span>(255),
    name17  <span class="org-type">varchar</span>(255),
    name18  <span class="org-type">varchar</span>(255),
    name19  <span class="org-type">varchar</span>(255),
    name20  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">レコード挿入する
</span> <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users (name1)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name1  <span class="org-keyword">ON</span> users(name1);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name2  <span class="org-keyword">ON</span> users(name2);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name3  <span class="org-keyword">ON</span> users(name3);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name4  <span class="org-keyword">ON</span> users(name4);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name5  <span class="org-keyword">ON</span> users(name5);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name6  <span class="org-keyword">ON</span> users(name6);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name7  <span class="org-keyword">ON</span> users(name7);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name8  <span class="org-keyword">ON</span> users(name8);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name9  <span class="org-keyword">ON</span> users(name9);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name10  <span class="org-keyword">ON</span> users(name10);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name11  <span class="org-keyword">ON</span> users(name11);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name12  <span class="org-keyword">ON</span> users(name12);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name13  <span class="org-keyword">ON</span> users(name13);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name14  <span class="org-keyword">ON</span> users(name14);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name15  <span class="org-keyword">ON</span> users(name15);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name16  <span class="org-keyword">ON</span> users(name16);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name17  <span class="org-keyword">ON</span> users(name17);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name18  <span class="org-keyword">ON</span> users(name18);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name19  <span class="org-keyword">ON</span> users(name19);
 <span class="org-keyword">CREATE</span> INDEX idx_users_name20  <span class="org-keyword">ON</span> users(name20);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスがないものを検索する
</span>EXPLAIN (ANALYZE)
 <span class="org-keyword">SELECT</span> noindex  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span> noindex =  <span class="org-string">'xx'</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスがあるものを検索する
</span>EXPLAIN (ANALYZE)
 <span class="org-keyword">SELECT</span> name1  <span class="org-keyword">FROM</span> users  <span class="org-keyword">WHERE</span> name1 =  <span class="org-string">'xx'</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                            |   |                     |
|----------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                     |   |                     |
| >     noindex varchar(255),                                                                                                |   |                     |
| >     name1 varchar(255),                                                                                                  |   |                     |
| >     name2 varchar(255),                                                                                                  |   |                     |
| >     name3 varchar(255),                                                                                                  |   |                     |
| >     name4 varchar(255),                                                                                                  |   |                     |
| >     name5 varchar(255),                                                                                                  |   |                     |
| >     name6 varchar(255),                                                                                                  |   |                     |
| >     name7 varchar(255),                                                                                                  |   |                     |
| >     name8 varchar(255),                                                                                                  |   |                     |
| >     name9 varchar(255),                                                                                                  |   |                     |
| >     name10 varchar(255),                                                                                                 |   |                     |
| >     name11 varchar(255),                                                                                                 |   |                     |
| >     name12 varchar(255),                                                                                                 |   |                     |
| >     name13 varchar(255),                                                                                                 |   |                     |
| >     name14 varchar(255),                                                                                                 |   |                     |
| >     name15 varchar(255),                                                                                                 |   |                     |
| >     name16 varchar(255),                                                                                                 |   |                     |
| >     name17 varchar(255),                                                                                                 |   |                     |
| >     name18 varchar(255),                                                                                                 |   |                     |
| >     name19 varchar(255),                                                                                                 |   |                     |
| >     name20 varchar(255)                                                                                                  |   |                     |
| > );                                                                                                                       |   |                     |
| CREATE TABLE                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > INSERT INTO users (name1)                                                                                                |   |                     |
| > SELECT                                                                                                                   |   |                     |
| >      -- 32x2 文字                                                                                                        |   |                     |
| >      md5(random()::text)                                                                                                 |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                       |   |                     |
| INSERT 0 100000                                                                                                            |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name1 ON users(name1);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name1_2 ON users(name1, name2);                                                                   |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name2 ON users(name2);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name3 ON users(name3);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name4 ON users(name4);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name5 ON users(name5);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name6 ON users(name6);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name7 ON users(name7);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name8 ON users(name8);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name9 ON users(name9);                                                                            |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name10 ON users(name10);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name11 ON users(name11);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name12 ON users(name12);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name13 ON users(name13);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name14 ON users(name14);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name15 ON users(name15);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name16 ON users(name16);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name17 ON users(name17);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name18 ON users(name18);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name19 ON users(name19);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > CREATE INDEX idx_users_name20 ON users(name20);                                                                          |   |                     |
| CREATE INDEX                                                                                                               |   |                     |
|                                                                                                                            |   |                     |
| > EXPLAIN (ANALYZE)                                                                                                        |   |                     |
| > SELECT noindex FROM users WHERE noindex = 'xx';                                                                          |   |                     |
| QUERY PLAN                                                                                                                 |   |                     |
| Seq Scan on users  (cost=0.00..2584.00 rows=500 width=516) (actual time=1.908..1.908 rows=0.00 loops=1)                    |   |                     |
| Filter: ((noindex)::text = 'xx'::text)                                                                                     |   |                     |
| Rows Removed by Filter: 100000                                                                                             |   |                     |
| Buffers: shared hit=1334                                                                                                   |   |                     |
| Planning:                                                                                                                  |   |                     |
| Buffers: shared hit=251 read=21                                                                                            |   |                     |
| Planning Time: 0.296 ms                                                                                                    |   |                     |
| Execution Time: 1.913 ms                                                                                                   |   |                     |
|                                                                                                                            |   |                     |
| > EXPLAIN (ANALYZE)                                                                                                        |   |                     |
| > SELECT name1 FROM users WHERE name1 = 'xx';                                                                              |   |                     |
| QUERY PLAN                                                                                                                 |   |                     |
| Bitmap Heap Scan on users  (cost=28.29..1010.49 rows=500 width=516) (actual time=0.019..0.019 rows=0.00 loops=1)           |   |                     |
| Recheck Cond: ((name1)::text = 'xx'::text)                                                                                 |   |                     |
| Buffers: shared read=3                                                                                                     |   |                     |
| ->  Bitmap Index Scan on idx_users_name1  (cost=0.00..28.17 rows=500 width=0) (actual time=0.017..0.017 rows=0.00 loops=1) |   |                     |
| Index Cond: ((name1)::text = 'xx'::text)                                                                                   |   |                     |
| Index Searches: 1                                                                                                          |   |                     |
| Buffers: shared read=3                                                                                                     |   |                     |
| Planning Time: 0.037 ms                                                                                                    |   |                     |
| Execution Time: 0.023 ms                                                                                                   |   |                     |
</pre>
</div>

 <ul class="org-ul"> <li>index使用時の計画時間が、indexが1つだけのときに比べて3倍になった</li>
 <li>index使用時の実行時間は、indexが1つだけのときと変わらない</li>
 <li>index不使用時の計画時間は増加していない</li>
</ul></div>
</div>
 <div id="outline-container-org8402a76" class="outline-3">
 <h3 id="org8402a76"> <a href="#org8402a76">挿入時のコスト</a></h3>
 <div class="outline-text-3" id="text-org8402a76">
 <p>
インデックスの有無を変えてレコードを挿入したときの時間を見る。
</p>

 <div class="org-src-container">
 <pre class="src src-sql"> <span class="org-keyword">CREATE</span>  <span class="org-keyword">TABLE</span>  <span class="org-function-name">users</span> (
     <span class="org-keyword">name</span>  <span class="org-type">varchar</span>(255)
);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスなしで挿入する
</span> <span class="org-keyword">BEGIN</span>;
EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;
 <span class="org-keyword">ROLLBACK</span>;

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスを追加する
</span> <span class="org-keyword">CREATE</span> INDEX idx_users_name  <span class="org-keyword">ON</span> users( <span class="org-keyword">name</span>);

 <span class="org-comment-delimiter">-- </span> <span class="org-comment">インデックスありで挿入する
</span> <span class="org-keyword">BEGIN</span>;
EXPLAIN ANALYZE
 <span class="org-keyword">INSERT</span>  <span class="org-keyword">INTO</span> users ( <span class="org-keyword">name</span>)
 <span class="org-keyword">SELECT</span>
      <span class="org-comment-delimiter">-- </span> <span class="org-comment">32x2 文字
</span>     md5(random()::text) || md5(random()::text)
 <span class="org-keyword">FROM</span> generate_series(1, 100000) i;
 <span class="org-keyword">ROLLBACK</span>;
</pre>
</div>

 <div class="org-src-container">
 <pre class="src src-nil">|                                                                                                                                      |   |                     |
|--------------------------------------------------------------------------------------------------------------------------------------+---+---------------------|
| > CREATE TABLE users (                                                                                                               |   |                     |
| >     name varchar(255)                                                                                                              |   |                     |
| > );                                                                                                                                 |   |                     |
| CREATE TABLE                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > BEGIN;                                                                                                                             |   |                     |
| BEGIN                                                                                                                                |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > INSERT INTO users (name)                                                                                                           |   |                     |
| > SELECT                                                                                                                             |   |                     |
| >      -- 32x2 文字                                                                                                                  |   |                     |
| >      md5(random()::text)                                                                                                           |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                                 |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Insert on users  (cost=0.00..3500.00 rows=0 width=0) (actual time=118.697..118.698 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=102466 dirtied=1236 written=1238                                                                                 |   |                     |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3500.00 rows=100000 width=516) (actual time=2.688..88.235 rows=100000.00 loops=1)         |   |                     |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.687..83.525 rows=100000.00 loops=1) |   |                     |
| Planning:                                                                                                                            |   |                     |
| Buffers: shared hit=6                                                                                                                |   |                     |
| Planning Time: 0.032 ms                                                                                                              |   |                     |
| Execution Time: 118.892 ms                                                                                                           |   |                     |
|                                                                                                                                      |   |                     |
| > ROLLBACK;                                                                                                                          |   |                     |
| ROLLBACK                                                                                                                             |   |                     |
|                                                                                                                                      |   |                     |
| > CREATE INDEX idx_users_name ON users(name);                                                                                        |   |                     |
| CREATE INDEX                                                                                                                         |   |                     |
|                                                                                                                                      |   |                     |
| > BEGIN;                                                                                                                             |   |                     |
| BEGIN                                                                                                                                |   |                     |
|                                                                                                                                      |   |                     |
| > EXPLAIN ANALYZE                                                                                                                    |   |                     |
| > INSERT INTO users (name)                                                                                                           |   |                     |
| > SELECT                                                                                                                             |   |                     |
| >      -- 32x2 文字                                                                                                                  |   |                     |
| >      md5(random()::text)                                                                                                           |   | md5(random()::text) |
| > FROM generate_series(1, 100000) i;                                                                                                 |   |                     |
| QUERY PLAN                                                                                                                           |   |                     |
| Insert on users  (cost=0.00..3500.00 rows=0 width=0) (actual time=267.753..267.753 rows=0.00 loops=1)                                |   |                     |
| Buffers: shared hit=398873 read=1 dirtied=2766 written=2765                                                                          |   |                     |
| ->  Subquery Scan on "*SELECT*"  (cost=0.00..3500.00 rows=100000 width=516) (actual time=2.510..91.734 rows=100000.00 loops=1)         |   |                     |
| ->  Function Scan on generate_series i  (cost=0.00..3250.00 rows=100000 width=32) (actual time=2.509..86.862 rows=100000.00 loops=1) |   |                     |
| Planning Time: 0.027 ms                                                                                                              |   |                     |
| Execution Time: 267.930 ms                                                                                                           |   |                     |
|                                                                                                                                      |   |                     |
| > ROLLBACK;                                                                                                                          |   |                     |
| ROLLBACK                                                                                                                             |   |                     |
</pre>
</div>

 <p>
Execution Time が 118.892 ms -> 267.930 ms 。
</p>

 <p>
10万レコード挿入の実行時間が2倍になった。
</p>
</div>
</div>
</div>
 <div id="outline-container-org5599d85" class="outline-2">
 <h2 id="org5599d85"> <a href="#org5599d85">関連</a></h2>
 <div class="outline-text-2" id="text-org5599d85">
 <ul class="org-ul"> <li>疑問: 計画時にオプション評価のコストがかかるというが、どのような状況で問題になるのだろうか。もっと端的に増えていくケースがあるのだろうか。調べた限りだとオーバーヘッドになっているのは確かだが、実行時間の削減量に比べてわずかで、あまり問題となるように見えない</li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251210T084437--kdoc-501-インデックスのオーバーヘッドを検証する__permanent.html"/>
  <id>https://kijimad.github.io/roam/20251210T084437--kdoc-501-インデックスのオーバーヘッドを検証する__permanent.html</id>
  <updated>2025-12-25T06:47:38+09:00</updated>
</entry>
<entry>
  <title>KDOC 516: 2025年をまとめる</title>
  <author><name>kijimaD</name></author>
  <content type="html"><![CDATA[<div id="content" class="content">

 <div id="outline-container-orga468cf7" class="outline-2">
 <h2 id="orga468cf7"> <a href="#orga468cf7">この文書のステータス</a></h2>
 <div class="outline-text-2" id="text-orga468cf7">
 <ul class="org-ul"> <li>作成
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul> <ul class="org-ul"> <li>レビュー
 <ul class="org-ul"> <li class="off"> <input type="checkbox"></input> <署名></li>
</ul></li>
</ul></div>
</div>
 <div id="outline-container-orgab8e5aa" class="outline-2">
 <h2 id="orgab8e5aa"> <a href="#orgab8e5aa">概要</a></h2>
 <div class="outline-text-2" id="text-orgab8e5aa">
 <p>
メモから思い出す。
</p>

 <ul class="org-ul"> <li>KDOC番号は 330 ~ 519</li>
 <li>ネットワークまわりの本をよく読んだ</li>
</ul> <p>
仕事。
</p>

 <ul class="org-ul"> <li>前半は自社アプリケーションの開発をやっていた。ハイライトとして、権限の内部実装の大きな変更をするのをやった。変更が巨大な割に機能的なところではないのでリリースには書きにくかった</li>
 <li>中盤から生成AIを使い始め、コードをゼロから書くことがほとんどなくなっていった</li>
 <li>9月ごろから主にインフラまわりの受託仕事をやっていた。ドメインからはじまりアプリケーションに必要なマネージドサービスを一通り扱った</li>
</ul> <p>
個人的イベント。
</p>

 <ul class="org-ul"> <li>英語でYouTubeを見るのに熱中する。いままでは外国語を文字を読むことで学ぼうとすることが多かったが、動画で見ると大変面白くて永遠に見られることに気づいた。そして動画を見るうちに、国外の場所や人により親しみを感じるようになった。外国語の堪能な人がよくいう、外国語というよりコンテンツに没頭してできるようになった、の正しさを感じた</li>
 <li>1ヶ月間アメリカに行った。英語で国外のコンテンツを見るうち、じっさいに行ってみたくなったのである。アメリカでは予約やメモをする以外はPCに全然触れず、ほとんど外にいて遊び回った。都市や自然の名所、博物館、美術館が主な行き先だった</li>
 <li>休日よく博物館に行った。あまり行ってない時期もあったが、休日の午前に行くのがベストなことに気づいて、安定していくようになった</li>
 <li>毎日5分やる習慣が完全に定着した
 <ul class="org-ul"> <li>6月ごろに <a href="20250611T180912--kdoc-385-『続ける思考』__book.html#ID-20250611T180912">KDOC 385: 『続ける思考』</a>を読んでやりはじめ、それから1日も欠かさず半年間やった</li>
 <li>去年から続く <a href="20240708T214636--kdoc-197-『プリズナー・トレーニング』__book.html#ID-20240708T214636">KDOC 197: 『プリズナー・トレーニング』</a>に続く習慣上のブレイクスルーであり、継続力に大きな改善をもたらした</li>
</ul></li>
 <li>後半からモバイル回線にもDNSフィルタリングを設定して、有害コンテンツを完全に遮断する生活をしていた</li>
</ul></div>
</div>
 <div id="outline-container-orged611f7" class="outline-2">
 <h2 id="orged611f7"> <a href="#orged611f7">関連</a></h2>
 <div class="outline-text-2" id="text-orged611f7">
 <ul class="org-ul"> <li>類推:  <a href="20240203T020208--kdoc-67-2023年をまとめる__essay.html#ID-20240203T020208">KDOC 67: 2023年をまとめる</a>。1年を振り返る
 <ul class="org-ul"> <li>2024年は抜けていることに気づいた</li>
</ul></li>
</ul></div>
</div>
</div>]]></content>
  <link href="https://kijimad.github.io/roam/20251221T163444--kdoc-516-2025年をまとめる__draft_essay.html"/>
  <id>https://kijimad.github.io/roam/20251221T163444--kdoc-516-2025年をまとめる__draft_essay.html</id>
  <updated>2025-12-25T06:47:36+09:00</updated>
</entry>
</feed>
